<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Marbrages Kawaii ‚Äî Activit√© du mois</title>

<link rel="stylesheet" href="../css/style.css">

<!-- Ic√¥nes Material -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* ===========================================
   üå∏ PALETTE KAWAII DELUXE
=========================================== */
:root{
  --kawaii-pink: #ffd7e9;
  --kawaii-blue: #dcecff;
  --kawaii-lavender: #e8d7ff;
  --kawaii-mint: #d8f7e0;
  --kawaii-cream: #fff7e6;
  --kawaii-shadow: rgba(0,0,0,0.08);
  --text-soft: #444;
}

body {
  background: linear-gradient(135deg, #fff5fb 0%, #e4f0ff 100%);
  margin: 0;
  padding: 20px;
  color: var(--text-soft);
  font-family: Inter, sans-serif;
}

/* ===========================================
   üå∏ CONTENEUR
=========================================== */
.container {
  max-width: 1100px;
  margin: 0 auto;
}

/* ===========================================
   üå∏ HEADER KAWAII
=========================================== */
.toolbar {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.btn {
  background: var(--kawaii-pink);
  border: none;
  padding: 12px 18px;
  border-radius: 16px;
  font-weight: bold;
  color: #444;
  cursor: pointer;
  box-shadow: 0 4px 10px var(--kawaii-shadow);
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: 0.2s;
}

.btn:hover {
  transform: translateY(-3px);
  background: #ffcae2;
}

input[type="text"], select {
  background: white;
  border: 2px solid var(--kawaii-blue);
  border-radius: 14px;
  padding: 10px 14px;
  height: 45px;
  font-size: 15px;
  box-shadow: 0 3px 8px var(--kawaii-shadow);
}

/* ===========================================
   üå∏ CARTES KAWAII
=========================================== */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px,1fr));
  gap: 24px;
  margin-top: 20px;
}

.card {
  background: white;
  border-radius: 25px;
  padding: 20px;
  box-shadow: 0 6px 14px var(--kawaii-shadow);
  border: 3px solid var(--kawaii-blue);
  transition: 0.2s;
}

.card:hover {
  transform: translateY(-4px);
}

.card h3 {
  font-family: "Spicy", serif;
  text-align: center;
  color: #444;
  margin-bottom: 10px;
}

/* Image kawaii */
.img-box {
  border-radius: 18px;
  overflow: hidden;
  height: 8cm;
  background: var(--kawaii-cream);
  box-shadow: inset 0 0 10px rgba(0,0,0,0.06);
}

/* √âtiquettes fa√ßon stickers */
.tag-box {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
}

.tag {
  background: var(--kawaii-mint);
  border-radius: 14px;
  padding: 8px 12px;
  font-size: 14px;
  border: 2px solid var(--kawaii-blue);
}

/* Boutons dans cartes */
.btn-small {
  background: var(--kawaii-lavender);
  border: none;
  padding: 8px 14px;
  border-radius: 14px;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px 10px var(--kawaii-shadow);
  transition: 0.2s;
}

.btn-small:hover {
  background: #dfc4ff;
  transform: translateY(-3px);
}

.status {
  background: white;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 4px 10px var(--kawaii-shadow);
  text-align: center;
}
</style>
</head>

<body>
<div class="container">

  <header class="toolbar">
    <a href="../index.html" class="btn">
      <span class="material-icons">arrow_back</span> Retour
    </a>

    <input id="searchInput" type="text" placeholder="üîç Recherche kawaii‚Ä¶" oninput="onSearchInput()">

    <select id="niveauSelect" onchange="onSearchInput()">
      <option value="">Niveau‚Ä¶</option>
      <option value="d√©butant">d√©butant</option>
      <option value="interm√©diaire">interm√©diaire</option>
      <option value="avanc√©">avanc√©</option>
    </select>

    <select id="traceSelect" onchange="onSearchInput()">
      <option value="">Trace‚Ä¶</option>
      <option value="tr√®s fine">tr√®s fine</option>
      <option value="fine">fine</option>
      <option value="moyenne">moyenne</option>
      <option value="franche">franche</option>
      <option value="√©paisse">√©paisse</option>
    </select>

    <button class="btn" onclick="doRandom()">
      <span class="material-icons">auto_awesome</span> Surprise
    </button>
  </header>

  <main id="mainArea">
    <div class="status">Chargement des marbrages kawaii‚Ä¶</div>
  </main>

</div>

<script>
/* ----- CSV ----- */
function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l => l.trim());
  const header = lines[0].split(",");
  const out = [];

  for (let i=1; i<lines.length; i++){
    const raw = lines[i];
    let cur="", q=false, arr=[];

    for (let ch of raw){
      if (ch === '"') q=!q;
      else if (ch === "," && !q){ arr.push(cur); cur=""; }
      else cur+=ch;
    }
    arr.push(cur);

    out.push({
      nom: arr[0] || "",
      description: arr[1] || "",
      trace: arr[2] || "",
      materiel: arr[3] || "",
      niveau: arr[4] || "",
      illustration: arr[5] || "",
      galerie: arr[6] || "",
      youtube: arr[7] || "",
      recettes_econo: arr[8] || "",
      recettes_premium: arr[9] || "",
      tutoriel: arr[10] || ""
    });
  }
  return out;
}

let TECHS = [];

/* ----- LOAD ----- */
async function loadData(){
  const res = await fetch("../data/marbrages.csv");
  const text = await res.text();

  TECHS = parseCSV(text);
  renderCards(TECHS);
}

/* ----- RENDER ----- */
function renderCards(list){
  const main = document.getElementById("mainArea");
  main.innerHTML = "";

  const grid = document.createElement("div");
  grid.className = "cards";

  list.forEach(t=>{
    const card=document.createElement("div");
    card.className="card";

    card.innerHTML = `
      <h3>${t.nom}</h3>

      <div class="img-box">
        <img src="${t.illustration}" alt="illustration"
             onerror="this.src='https://via.placeholder.com/600x400?text=kawaii'">
      </div>

      <div class="tag-box">
        <div class="tag"><strong>Description :</strong> ${t.description}</div>
        <div class="tag"><strong>Niveau :</strong> ${t.niveau}</div>
        <div class="tag"><strong>Trace :</strong> ${t.trace}</div>
      </div>

      <div class="buttons-row">
        ${ t.recettes_econo ? `<button class="btn-small" onclick="openUrl('${t.recettes_econo}')">üç¨ Recette</button>` : "" }
        ${ t.youtube ? `<button class="btn-small" onclick="openUrl('${t.youtube}')">üéÄ Vid√©o</button>` : "" }
      </div>
    `;
    grid.appendChild(card);
  });

  main.appendChild(grid);
}

/* ----- SEARCH ----- */
function normalize(s){ return (s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(); }

function onSearchInput(){
  const q = normalize(document.getElementById("searchInput").value);
  const nv = normalize(document.getElementById("niveauSelect").value);
  const tr = normalize(document.getElementById("traceSelect").value);

  let list = TECHS;

  if (q) list = list.filter(t => normalize(t.nom).includes(q));
  if (nv) list = list.filter(t => normalize(t.niveau) === nv);
  if (tr) list = list.filter(t => normalize(t.trace) === tr);

  renderCards(list);
}

/* ----- RANDOM ---- */
function doRandom(){
  const t = TECHS[Math.floor(Math.random()*TECHS.length)];
  renderCards([t]);
}

/* ----- OPEN ----- */
function openUrl(u){ window.open(u,"_blank"); }

/* INIT */
document.addEventListener("DOMContentLoaded", loadData);
</script>

</body>
</html>
