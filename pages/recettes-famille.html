<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Recettes de famille</title>

<!-- Police SPICY -->
<style>
@font-face {
    font-family: "Spicy";
    src: url("../assets/fonts/Spicy Sale.ttf");
}
.title-spicy { font-family: "Spicy"; }
</style>

<!-- Icônes Material -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
:root{
    --bg: #fdf7f2;
    --card: #ffffff;
    --border: #f1e6d8;
    --shadow: rgba(0,0,0,0.06);
    --text: #333;
    --muted: #777;
    --gradient-info: linear-gradient(120deg,#84fab0 0%,#8fd3f4 100%);
    --gradient-btn: linear-gradient(120deg,#e0c3fc 0%,#8ec5fc 100%);
}

body{
    margin:0;
    padding:20px;
    background:var(--bg);
    font-family:Arial, sans-serif;
    color:var(--text);
}

.container{
    max-width:1100px;
    margin:0 auto;
}

/* HEADER style marbrage */
.header{
    text-align:center;
    margin-bottom:25px;
}
.header img{
    width:110px;
    cursor:pointer;
    transition:transform .2s;
}
.header img:hover{
    transform:scale(1.05);
}
.header h1{
    font-size:2.5rem;
    margin:10px 0 5px;
    color:#000;
}
.header p{
    font-family:"Spicy";
    font-size:1.3rem;
    margin-top:-5px;
    color:#444;
}

/* Barre de recherche & filtres */
.toolbar{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:20px;
    justify-content:center;
}
.toolbar input,
.toolbar select{
    padding:10px 12px;
    border-radius:10px;
    border:1px solid var(--border);
    font-size:15px;
}

/* Cartes recettes */
.cards{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
    gap:20px;
}
.card{
    background:var(--card);
    border-radius:16px;
    padding:16px;
    border:1px solid var(--border);
    box-shadow:0 3px 8px var(--shadow);
    transition:transform .15s, box-shadow .15s;
}
.card:hover{
    transform:translateY(-4px);
    box-shadow:0 8px 16px rgba(0,0,0,0.12);
}

/* Image */
.img-box{
    width:100%;
    height:9cm;
    border-radius:12px;
    overflow:hidden;
    margin-bottom:12px;
}
.img-box img{
    width:100%;
    height:100%;
    object-fit:cover;
}

/* Tags */
.tag-section{
    margin-bottom:10px;
}
.tag-title{
    font-weight:bold;
    background:var(--gradient-info);
    padding:6px 10px;
    display:inline-block;
    border-radius:8px;
    font-size:14px;
    margin-bottom:5px;
}
.tag-content{
    white-space:pre-line;
    font-size:14px;
    margin-left:5px;
}

/* Boutons kawaii */
.buttons{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:10px;
}
.btn{
    display:flex;
    align-items:center;
    gap:6px;
    padding:8px 14px;
    border-radius:12px;
    background:var(--gradient-btn);
    border:none;
    cursor:pointer;
    font-size:14px;
    transition:transform .1s;
}
.btn:hover{
    transform:scale(1.05);
}
.btn .material-icons{
    font-size:18px;
}

/* Impression */
@media print{
    .toolbar, .header img, .btn { display:none !important; }
    .card { page-break-after:always; }
    body{ padding:0; }
}
</style>
</head>

<body>

<div class="container">

    <!-- HEADER (logo + titre + phrase) -->
    <div class="header">
        <a href="../index.html">
            <img src="../assets/images/logo.png" alt="logo">
        </a>
        <h1 class="title-spicy">Recettes de famille</h1>
        <p>cuisiné avec amour</p>
    </div>

    <!-- TOOLBAR : recherche + catégorie -->
    <div class="toolbar">
        <input id="search" type="text" placeholder="Recherche (nom ou ingrédient)…" oninput="applyFilters()">
        <select id="categorie" onchange="applyFilters()">
            <option value="">Catégorie…</option>
            <option>Petit-déjeuner</option>
            <option>Goûter</option>
            <option>Dessert</option>
            <option>Plat</option>
            <option>Hiver</option>
            <option>Boisson</option>
            <option>Léger</option>
        </select>
    </div>

    <div id="cards" class="cards"></div>

</div>

<script>
/* Lecture du CSV GitHub (avec \n transformés en vrais retours ligne) */
function parseCSV(text){
    const lines=text.split(/\r?\n/).filter(l=>l.trim()!=="");
    const header=lines[0].split(",");

    const rows=[];
    for(let i=1;i<lines.length;i++){
        const parts=[];
        let cur="", inQuotes=false;

        for(let c of lines[i]){
            if(c === '"'){ inQuotes=!inQuotes; continue; }
            if(c === "," && !inQuotes){ parts.push(cur); cur=""; continue; }
            cur+=c;
        }
        parts.push(cur);

        const obj={
            nom:parts[0],
            categorie:parts[1],
            personnes:parts[2],
            ingredients:(parts[3]||"").replace(/\\n/g,"\n"),
            recette:(parts[4]||"").replace(/\\n/g,"\n"),
            photo:parts[5]
        };
        rows.push(obj);
    }
    return rows;
}

let RECETTES=[];

async function loadData(){
    const res=await fetch("../data/recettes.csv");
    const txt=await res.text();
    RECETTES=parseCSV(txt);
    renderCards(RECETTES);
}

function renderCards(list){
    const zone=document.getElementById("cards");
    zone.innerHTML="";

    list.forEach(r=>{
        const card=document.createElement("div");
        card.className="card";

        card.innerHTML=`
            <div class="img-box">
                <img src="${r.photo}">
            </div>

            <h3 class="title-spicy" style="font-size:1.6rem;margin:0 0 10px;">${r.nom}</h3>

            <div class="tag-section">
                <span class="tag-title">Ingrédients</span>
                <div class="tag-content">${r.ingredients}</div>
            </div>

            <div class="tag-section">
                <span class="tag-title">Préparation</span>
                <div class="tag-content">${r.recette}</div>
            </div>

            <div class="tag-section">
                <span class="tag-title">Pour</span>
                <div class="tag-content">${r.personnes} personne(s)</div>
            </div>

            <div class="buttons">
                <button class="btn" onclick="window.print()">
                    <span class="material-icons">print</span> Imprimer la fiche
                </button>
            </div>
        `;
        zone.appendChild(card);
    });
}

/* Recherche + filtre */
function applyFilters(){
    const q=document.getElementById("search").value.toLowerCase();
    const cat=document.getElementById("categorie").value.toLowerCase();

    const filtered=RECETTES.filter(r=>{
        const matchName=r.nom.toLowerCase().includes(q);
        const matchIng=r.ingredients.toLowerCase().includes(q);
        const matchCat=!cat || r.categorie.toLowerCase()===cat;
        return (matchName || matchIng) && matchCat;
    });

    renderCards(filtered);
}

loadData();
</script>

</body>
</html>
