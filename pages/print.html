<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Impression recette</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    font-family: Arial, sans-serif;
    margin: 40px;
    color: #333;
}

h1 {
    text-align: center;
    margin-bottom: 25px;
    font-size: 2rem;
}

.photo-box {
    width: 100%;
    height: 280px;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 25px;
}

.photo-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.section-title {
    font-size: 1.4rem;
    margin-top: 20px;
    margin-bottom: 8px;
    font-weight: bold;
    border-bottom: 2px solid #ccc;
    padding-bottom: 5px;
}

ul, ol {
    font-size: 1.1rem;
}

@media print {
    body {
        margin: 0;
        padding: 20px;
    }
}
</style>
</head>
<body>

<h1 id="recette-title">Recette</h1>

<div class="photo-box">
    <img id="recette-photo" src="" alt="">
</div>

<div>
    <div class="section-title">Ingrédients</div>
    <ul id="ingredients-list"></ul>

    <div class="section-title">Préparation</div>
    <ol id="preparation-list"></ol>
</div>

<script>
function parseCSV(text){
    const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
    const head = lines.shift().split(",");

    return lines.map(line=>{
        const cells = parseLine(line);
        return {
            nom: cells[0]||"",
            categorie: cells[1]||"",
            personnes: cells[2]||"",
            ingredients: (cells[3]||"").replace(/\\n/g,"\n"),
            recette: (cells[4]||"").replace(/\\n/g,"\n"),
            photo: cells[5]||""
        };
    });
}

function parseLine(l){
    const out=[]; let cur=""; let q=false;
    for(let c of l){
        if(c=='"') q=!q;
        else if(c=="," && !q){ out.push(cur); cur=""; }
        else cur+=c;
    }
    out.push(cur);
    return out;
}

async function load(){
    const params = new URLSearchParams(location.search);
    const nom = decodeURIComponent(params.get("nom") || "");

    const res = await fetch("../data/recettes.csv",{cache:"no-store"});
    const text = await res.text();
    const data = parseCSV(text);

    const r = data.find(x => x.nom === nom);

    if(!r){
        document.body.innerHTML = "<p>Recette introuvable.</p>";
        return;
    }

    document.getElementById("recette-title").textContent = r.nom;
    document.getElementById("recette-photo").src = r.photo;

    /* ingrédients */
    const ingList = document.getElementById("ingredients-list");
    r.ingredients.split("\n").forEach(i=>{
        if(i.trim() !== ""){
            const li = document.createElement("li");
            li.textContent = i.trim();
            ingList.appendChild(li);
        }
    });

    /* préparation */
    const prepList = document.getElementById("preparation-list");
    r.recette.split("\n").forEach(i=>{
        if(i.trim() !== ""){
            const li = document.createElement("li");
            li.textContent = i.trim();
            prepList.appendChild(li);
        }
    });
}

load();
</script>

</body>
</html>
