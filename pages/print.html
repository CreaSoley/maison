<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Impression recette</title>

<style>
/* écran */
body {
  font-family: Arial, sans-serif;
  margin: 40px;
  color: #333;
}
h1 { text-align:center; margin-bottom:20px; font-size:2rem; }

.photo-box {
  width: 100%;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 20px;
  background:#f6f6f6;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* image par défaut écran */
.photo-box img {
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* sections */
.section-title {
  font-size:1.25rem;
  font-weight:700;
  border-bottom:2px solid #ccc;
  padding-bottom:6px;
  margin-top:18px;
}
ul, ol { font-size:1.05rem; line-height:1.5; }

/* ---------------------------
   styles spécifiques impression
   --------------------------- */
@media print {

  /* A4 portrait avec marges raisonnables */
  @page { size: A4 portrait; margin: 15mm; }

  body {
    margin:0;
    padding:0;
    color:#000;
    font-size:12pt;
  }

  h1 { font-size:22pt; margin-bottom:10px; }

  /* CONTENEUR IMAGE :
     - largeur maximale = largeur imprimable A4 (210mm - 2*15mm)
     - hauteur maximale contrôlée pour éviter qu'elle prenne toute la page
  */
  .photo-box {
    width: 100%;
    /* largeur imprimable = 210mm - 2*15mm = 180mm */
    max-width: 180mm;
    /* limite la hauteur affichée de l'image imprimée */
    max-height: 60mm !important;   /* <--- ajuste ici si tu veux plus/grand (ex: 80mm) */
    margin-bottom: 12mm;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .photo-box img {
    /* ne dépasse jamais la zone imprimable */
    max-width: 180mm !important;
    max-height: 60mm !important;
    width: auto !important;
    height: auto !important;
    object-fit: contain !important; /* affiche l'image entière sans la déformer */
    display: block;
  }

  /* lisibilité */
  .section-title { font-size:14pt; border-bottom:1px solid #000; padding-bottom:4px; }
  ul, ol { font-size:13pt; line-height:1.6; }

  /* évite de couper un LI entre deux pages */
  li { page-break-inside: avoid; }
  .section { page-break-inside: avoid; }

  /* si l'image ne charge pas, on affiche une bordure visible à l'impression */
  .photo-box:empty { border: 1px dashed #000; height: 60mm; }
}
</style>
</head>
<body>

<h1 id="recette-title">Recette</h1>

<div class="photo-box" id="photo-box">
    <img id="recette-photo" src="" alt="Photo de la recette" onerror="this.dataset.error='1'; this.style.display='none'; document.getElementById('photo-box').classList.add('noimg');" />
</div>

<div class="section">
  <div class="section-title">Ingrédients</div>
  <ul id="ingredients-list"></ul>
</div>

<div class="section">
  <div class="section-title">Préparation</div>
  <ol id="preparation-list"></ol>
</div>

<script>
/* parse CSV (identique) */
function parseCSV(text){
    const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
    if(lines.length===0) return [];
    const head = lines.shift().split(",");
    return lines.map(line=>{
        const cells = parseLine(line);
        return {
            nom: cells[0]||"",
            categorie: cells[1]||"",
            personnes: cells[2]||"",
            ingredients: (cells[3]||"").replace(/\\n/g,"\n"),
            recette: (cells[4]||"").replace(/\\n/g,"\n"),
            photo: cells[5]||""
        };
    });
}
function parseLine(l){
    const out=[]; let cur=""; let q=false;
    for(let i=0;i<l.length;i++){
        const c=l[i];
        if(c=='"') q=!q;
        else if(c=="," && !q){ out.push(cur); cur=""; }
        else cur+=c;
    }
    out.push(cur);
    return out;
}

async function load(){
    try{
        const params = new URLSearchParams(location.search);
        const nom = decodeURIComponent(params.get("nom") || "");
        const res = await fetch("../data/recettes.csv",{cache:"no-store"});
        const text = await res.text();
        const data = parseCSV(text);
        const r = data.find(x => x.nom === nom);
        if(!r){ document.body.innerHTML = "<p>Recette introuvable.</p>"; return; }

        document.getElementById("recette-title").textContent = r.nom;

        const img = document.getElementById("recette-photo");
        if(r.photo && r.photo.trim()!=="") {
            // Remplacement : si URL relative, ok ; si distante, check CORS peut empêcher affichage
            img.src = r.photo;
        } else {
            // pas d'image
            img.style.display = 'none';
            document.getElementB
