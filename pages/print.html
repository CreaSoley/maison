<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Impression recette</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* --------------------------- */
/* STYLE ÉCRAN (pré-impression) */
/* --------------------------- */
body {
    font-family: Arial, sans-serif;
    margin: 40px;
    color: #333;
}

h1 {
    text-align: center;
    margin-bottom: 25px;
    font-size: 2rem;
}

.photo-box {
    width: 100%;
    max-height: 280px;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 25px;
    background: #f0f0f0;
}

.photo-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.section-title {
    font-size: 1.4rem;
    margin-top: 25px;
    margin-bottom: 10px;
    font-weight: bold;
    border-bottom: 2px solid #ccc;
    padding-bottom: 4px;
}

ul, ol {
    font-size: 1.1rem;
    line-height: 1.5;
}

/* --------------------------- */
/* STYLE POUR IMPRESSION A4     */
/* --------------------------- */
@media print {

    @page {
        size: A4;
        margin: 15mm;
    }

    body {
        margin: 0;
        padding: 0;
        font-size: 12pt;
        color: #000;
    }

    h1 {
        font-size: 24pt;
        margin-bottom: 15px;
    }

    /* --- Image optimisée impression --- */
    .photo-box {
        width: 100%;
        max-height: 180px !important;
        margin-bottom: 15px;
    }

    .photo-box img {
        width: 100% !important;
        height: auto !important;
        object-fit: contain !important; /* montre l’image entière */
    }

    /* Renforce la lisibilité */
    .section-title {
        font-size: 16pt;
        margin-top: 15px;
        margin-bottom: 5px;
        border-bottom: 1px solid #000;
        padding-bottom: 3px;
    }

    ul, ol {
        font-size: 13pt;
        line-height: 1.6;
    }

    /* Empêche les coupures absurdes */
    li {
        page-break-inside: avoid;
    }

    /* Évite un gros espace vide en bas de page */
    .section {
        page-break-inside: avoid;
    }
}
</style>
</head>
<body>

<h1 id="recette-title">Recette</h1>

<div class="photo-box">
    <img id="recette-photo" src="" alt="">
</div>

<div class="section">
    <div class="section-title">Ingrédients</div>
    <ul id="ingredients-list"></ul>
</div>

<div class="section">
    <div class="section-title">Préparation</div>
    <ol id="preparation-list"></ol>
</div>

<script>
/* --- PARSE CSV EXACTEMENT COMME AVANT --- */
function parseCSV(text){
    const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
    const head = lines.shift().split(",");

    return lines.map(line=>{
        const cells = parseLine(line);
        return {
            nom: cells[0]||"",
            categorie: cells[1]||"",
            personnes: cells[2]||"",
            ingredients: (cells[3]||"").replace(/\\n/g,"\n"),
            recette: (cells[4]||"").replace(/\\n/g,"\n"),
            photo: cells[5]||""
        };
    });
}

function parseLine(l){
    const out=[]; let cur=""; let q=false;
    for(let c of l){
        if(c=='"') q=!q;
        else if(c=="," && !q){ out.push(cur); cur=""; }
        else cur+=c;
    }
    out.push(cur);
    return out;
}

async function load(){
    const params = new URLSearchParams(location.search);
    const nom = decodeURIComponent(params.get("nom") || "");

    const res = await fetch("../data/recettes.csv",{cache:"no-store"});
    const text = await res.text();
    const data = parseCSV(text);

    const r = data.find(x => x.nom === nom);

    if(!r){
        document.body.innerHTML = "<p>Recette introuvable.</p>";
        return;
    }

    document.getElementById("recette-title").textContent = r.nom;
    document.getElementById("recette-photo").src = r.photo;

    /* ingrédients */
    const ingList = document.getElementById("ingredients-list");
    r.ingredients.split("\n").forEach(i=>{
        if(i.trim() !== ""){
            const li = document.createElement("li");
            li.textContent = i.trim();
            ingList.appendChild(li);
        }
    });

    /* préparation */
    const prepList = document.getElementById("preparation-list");
    r.recette.split("\n").forEach(i=>{
        if(i.trim() !== ""){
            const li = document.createElement("li");
            li.textContent = i.trim();
            prepList.appendChild(li);
        }
    });
}

load();
</script>

</body>
</html>
