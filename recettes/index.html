<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recettes</title>

<link rel="stylesheet" href="style.css">

<!-- PapaParse (parseur CSV professionnel) -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
/* Style minimal int√©gr√© pour test : tu pourras remettre ton style.css ensuite */
body { font-family: Arial, sans-serif; margin: 20px; background:#fafafa; }
#controls { display:flex; gap:10px; margin-bottom:20px; }
.recette-card {
  background:white; padding:20px; border-radius:12px;
  margin-bottom:20px; 
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
.recette-img {
  width:100%; border-radius:12px; margin-bottom:10px; object-fit:cover;
  max-height:250px;
}
.recette-title { font-size:24px; margin-bottom:5px; }
.recette-buttons { margin-top:15px; display:flex; gap:10px; }
button {
  padding:8px 14px; border:none; border-radius:6px; cursor:pointer;
}
.btn-print { background:#444; color:white; }
.btn-whatsapp { background:#25D366; color:white; }
.no-img {
  width:100%; height:150px; background:#ddd; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  color:#666; font-style:italic;
}
</style>

</head>
<body>

<h1>Recettes</h1>

<div id="controls">
  <input id="quickSearch" type="text" placeholder="Recherche rapide‚Ä¶">
  <select id="filterCategory">
    <option value="">Toutes cat√©gories</option>
  </select>
  <button id="btnRandom">Recette Surprise üé≤</button>
</div>

<div id="displayArea"></div>

<script>
/* URL du CSV */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHntlP8qAseSjxxISs_fyoV12Ie8JZPXelkOWpXemy_HRCEYzs7UliTG2nTushmYjWH2gOYIknEczq/pub?gid=813880666&single=true&output=csv";

let recettes = [];

/* ----------------------------------------------------------
   CHARGEMENT AVEC PAPAPARSE
----------------------------------------------------------- */
Papa.parse(CSV_URL, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(results) {
    recettes = results.data;
    fillCategoryFilter();
    displayRecettes(recettes);
  }
});

/* ----------------------------------------------------------
   FILTRE CAT√âGORIES
----------------------------------------------------------- */
function fillCategoryFilter() {
  const select = document.getElementById("filterCategory");
  const categories = [...new Set(recettes.map(r => r["Cat√©gorie"]))];
  categories.forEach(cat => {
    if (!cat.trim()) return;
    let opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    select.appendChild(opt);
  });
}

/* ----------------------------------------------------------
   AFFICHAGE DES RECETTES
----------------------------------------------------------- */
function displayRecettes(list) {
  const area = document.getElementById("displayArea");
  area.innerHTML = "";

  if (!list.length) {
    area.innerHTML = "<p>Aucune recette trouv√©e.</p>";
    return;
  }

  list.forEach(r => {
    const card = document.createElement("div");
    card.className = "recette-card";

    const imageHTML = r["Photo"]
      ? `<img class="recette-img" src="${r["Photo"]}" alt="">`
      : `<div class="no-img">Aucune image</div>`;

    card.innerHTML = `
      ${imageHTML}
      <h2 class="recette-title">${r["Titre"]}</h2>

      <p><strong>Cat√©gorie :</strong> ${r["Cat√©gorie"] || ""}</p>
      <p><strong>Nombre de personnes :</strong> ${r["Nombre de personnes"] || ""}</p>

      <h3>Ingr√©dients</h3>
      <p>${(r["Ingr√©dients"] || "").replace(/\n/g, "<br>")}</p>

      <h3>Mat√©riel</h3>
      <p>${(r["Mat√©riel"] || "").replace(/\n/g, "<br>")}</p>

      <h3>√âtapes</h3>
      <p>${(r["√âtapes"] || "").replace(/\n/g, "<br>")}</p>

      <div class="recette-buttons">
        <button class="btn-print" onclick="print()">üñ®Ô∏è Imprimer</button>
        <button class="btn-whatsapp" onclick="shareWhatsApp('${encodeURIComponent(r["Titre"])}')">üì± WhatsApp</button>
      </div>
    `;
    area.appendChild(card);
  });
}

/* ----------------------------------------------------------
   PARTAGE
----------------------------------------------------------- */
function shareWhatsApp(txt) {
  window.open(`https://wa.me/?text=${txt}`, "_blank");
}

/* ----------------------------------------------------------
   RECHERCHE
----------------------------------------------------------- */
document.getElementById("quickSearch").addEventListener("input", (e) => {
  const q = e.target.value.toLowerCase();
  displayRecettes(recettes.filter(r =>
    (r["Titre"] || "").toLowerCase().includes(q) ||
    (r["Ingr√©dients"] || "").toLowerCase().includes(q)
  ));
});

/* ----------------------------------------------------------
   FILTRE CAT√âGORIE
----------------------------------------------------------- */
document.getElementById("filterCategory").addEventListener("change", (e) => {
  const cat = e.target.value;
  if (!cat) return displayRecettes(recettes);
  displayRecettes(recettes.filter(r => r["Cat√©gorie"] === cat));
});

/* ----------------------------------------------------------
   RECETTE SURPRISE
----------------------------------------------------------- */
document.getElementById("btnRandom").addEventListener("click", () => {
  const r = recettes[Math.floor(Math.random() * recettes.length)];
  displayRecettes([r]);
});
</script>

</body>
</html>
