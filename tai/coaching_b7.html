<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu ‚Äì S√©ance + √âvaluation</title>

<style>
body{font-family:system-ui,sans-serif;margin:0;background:linear-gradient(to right,#ffecd2,#fcb69f);}
h1{text-align:center;padding:1rem;}
.container{max-width:1100px;margin:auto;padding:1rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
.panel{background:#fff;border-radius:16px;padding:1rem;box-shadow:0 6px 14px rgba(0,0,0,.15);}
.uv{margin-bottom:1rem;}
.exercise{display:flex;justify-content:space-between;align-items:center;padding:.5rem .7rem;border-radius:10px;margin:.3rem 0;background:#f5f5f5;}
.exercise.selected{background:#d1f5d3;}
.exercise.active{background:#ffe8b3;}
.exercise.done{text-decoration:line-through;opacity:.6;}
.exercise button{border:none;border-radius:8px;padding:.3rem .6rem;cursor:pointer;}
.controls{margin-top:.8rem;display:flex;gap:.5rem;flex-wrap:wrap;}
input[type=text]{width:100%;padding:.6rem;border-radius:10px;border:1px solid #ccc;margin-bottom:.5rem;}
input[type=range]{width:120px;}
textarea{width:100%;border-radius:12px;padding:.6rem;margin-top:.5rem;}
label{font-weight:bold;}
progress{width:100%;height:14px}

/* Objectifs */
.goal-row{background:#f5f5f5;border-radius:12px;padding:.6rem;margin:.4rem 0;}
.goal-row input{width:70px;}
.goal-row progress{height:12px}

/* Overlay */
#trainingOverlay{display:none;position:fixed;inset:0;background:linear-gradient(to right,#84fab0,#8fd3f4);z-index:999;
flex-direction:column;justify-content:center;align-items:center;}
#trainingOverlay h1{font-size:3rem;}
#trainingOverlay #timer{font-size:4rem;}
#trainingOverlay button{margin-top:2rem;padding:1rem 2rem;font-size:1.2rem;border-radius:12px;}
</style>
</head>

<body>
<h1>ü•ã Coach Tai Jitsu ‚Äì S√©ance + √âvaluation</h1>

<div class="container">

  <div class="panel">
    <h2>üéØ Objectifs hebdomadaires</h2>
    <div id="weeklyGoals"></div>
  </div>

  <div class="panel">
    <h2>üìö Banque d'exercices</h2>
    <div id="bank"></div>
  </div>

  <div class="panel">
    <h2>üìù S√©ance s√©lectionn√©e</h2>
    <input type="text" id="sessionName" placeholder="Nom de la s√©ance">
    <div id="selection"></div>
    <label>Carnet de notes :</label>
    <textarea id="notes" rows="3"></textarea>
    <div class="controls">
      <button onclick="saveSelection()">üíæ Sauvegarder</button>
      <button onclick="clearSelection()">üßπ Vider</button>
      <button onclick="startSession()">‚ñ∂Ô∏è D√©marrer</button>
    </div>
    <progress id="progress" value="0" max="100"></progress>
  </div>

</div>

<div id="trainingOverlay">
  <h1 id="exerciseName"></h1>
  <div id="timer">00:00</div>
  <progress id="sessionProgress" value="0" max="100"></progress>
  <button onclick="toggleFullscreen()">‚ùå Quitter</button>
</div>

<script>
/* ------------------ BANQUE ------------------ */
const bankData=[
{uv:'ü•ã UV 1 ‚Äì Kihon',items:['Kihon simple','Encha√Ænement de kihon','Cibles']},
{uv:'üåÄ UV 2 ‚Äì D√©placements',items:['Ta√Ø sabaki','Slow ippon','Ippon kumite']},
{uv:'üìê UV 3 ‚Äì Kata',items:['Slow kata','Kata nidan','Bunka√Ø']},
{uv:'‚öôÔ∏è UV 4 ‚Äì Technique',items:['Shadow']},
{uv:'üî• UV 5 & 6 ‚Äì Randori',items:['Randori shadow']}
];

/* ------------------ √âTAT ------------------ */
let selection=JSON.parse(localStorage.getItem('tj-selection'))||[];
let weeklyGoals=JSON.parse(localStorage.getItem('tj-weekly-goals'))||{};
let weeklyProgress=JSON.parse(localStorage.getItem('tj-weekly-progress'))||{};
let seqIndex=0,timer=null,fullscreen=false;

/* ------------------ RESET HEBDO ------------------ */
function checkWeek(){
 const w=new Date().getFullYear()+"-W"+Math.ceil(new Date().getDate()/7);
 if(localStorage.getItem('tj-week')!==w){
  weeklyProgress={};
  localStorage.setItem('tj-week',w);
 }
}
checkWeek();

/* ------------------ OBJECTIFS ------------------ */
function renderWeeklyGoals(){
 const d=document.getElementById('weeklyGoals'); d.innerHTML='';
 if(selection.length===0){d.innerHTML='<em>Aucun exercice</em>';return;}
 selection.forEach(ex=>{
  if(!weeklyGoals[ex.name]) weeklyGoals[ex.name]=60;
  if(!weeklyProgress[ex.name]) weeklyProgress[ex.name]=0;
  const pct=Math.min(weeklyProgress[ex.name]/weeklyGoals[ex.name]*100,100).toFixed(0);
  d.innerHTML+=`
  <div class="goal-row">
   <strong>${ex.name}</strong><br>
   Objectif <input type="number" min="1" value="${weeklyGoals[ex.name]}"
    onchange="weeklyGoals['${ex.name}']=this.value;saveWeekly();renderWeeklyGoals()"> min
   <progress value="${pct}" max="100"></progress>
   <small>${weeklyProgress[ex.name]} / ${weeklyGoals[ex.name]} min (${pct}%)</small>
  </div>`;
 });
 saveWeekly();
}

function saveWeekly(){
 localStorage.setItem('tj-weekly-goals',JSON.stringify(weeklyGoals));
 localStorage.setItem('tj-weekly-progress',JSON.stringify(weeklyProgress));
}

/* ------------------ BANQUE ------------------ */
function renderBank(){
 const b=document.getElementById('bank'); b.innerHTML='';
 bankData.forEach(u=>{
  const div=document.createElement('div'); div.className='uv'; div.innerHTML=`<h3>${u.uv}</h3>`;
  u.items.forEach(n=>{
   const e=document.createElement('div'); e.className='exercise';
   e.innerHTML=`<span>${n}</span><button onclick="addExercise('${u.uv}','${n}')">‚ûï</button>`;
   div.appendChild(e);
  });
  b.appendChild(div);
 });
}

/* ------------------ S√âLECTION ------------------ */
function renderSelection(){
 const s=document.getElementById('selection'); s.innerHTML='';
 selection.forEach((ex,i)=>{
  const d=document.createElement('div'); d.className='exercise selected';
  d.innerHTML=`${ex.name}
   <input type="range" min="1" max="60" value="${ex.duration}"
    oninput="selection[${i}].duration=this.value;saveSelection()"> ${ex.duration} min
   <button onclick="selection.splice(${i},1);saveSelection()">‚ùå</button>`;
  s.appendChild(d);
 });
 renderWeeklyGoals();
}

function addExercise(uv,name){
 selection.push({uv,name,duration:5});
 saveSelection();
}
function saveSelection(){
 localStorage.setItem('tj-selection',JSON.stringify(selection));
 renderSelection();
}
function clearSelection(){selection=[];saveSelection();}

/* ------------------ SESSION ------------------ */
function startSession(){
 if(selection.length===0)return alert('Aucun exercice');
 seqIndex=0; toggleFullscreen(); nextExercise();
}

function toggleFullscreen(){
 fullscreen=!fullscreen;
 document.getElementById('trainingOverlay').style.display=fullscreen?'flex':'none';
}

function nextExercise(){
 if(seqIndex>=selection.length){toggleFullscreen();return;}
 const ex=selection[seqIndex];
 let t=ex.duration*60;
 document.getElementById('exerciseName').textContent=ex.name;
 document.getElementById('timer').textContent=format(t);
 timer=setInterval(()=>{
  t--;
  document.getElementById('timer').textContent=format(t);
  if(t<=0){
   clearInterval(timer);
   weeklyProgress[ex.name]=(weeklyProgress[ex.name]||0)+ex.duration;
   saveWeekly(); renderWeeklyGoals();
   seqIndex++; nextExercise();
  }
 },1000);
}

function format(s){
 return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0');
}

/* ------------------ INIT ------------------ */
renderBank();
renderSelection();
renderWeeklyGoals();
</script>
</body>
</html>
