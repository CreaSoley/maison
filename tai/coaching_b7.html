<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(to right,#ffecd2,#fcb69f);
}
h1{text-align:center;padding:1rem}

.container{
  max-width:1100px;
  margin:auto;
  padding:1rem;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:1rem;
}

.panel{
  background:#fff;
  border-radius:16px;
  padding:1rem;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
}

.exercise{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#f5f5f5;
  border-radius:10px;
  padding:.5rem;
  margin:.3rem 0;
}
.exercise.selected{background:#d1f5d3}
.exercise.active{background:#ffe8b3}
.exercise.done{text-decoration:line-through;opacity:.6}

button{
  border:none;
  border-radius:8px;
  padding:.4rem .7rem;
  cursor:pointer;
}

.controls{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}

input[type=range]{width:110px}
textarea{width:100%;border-radius:10px;padding:.5rem}

progress{width:100%;height:16px}

/* Plein √©cran */
#overlay{
  display:none;
  position:fixed;
  inset:0;
  background:linear-gradient(to right,#84fab0,#8fd3f4);
  z-index:999;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
#overlay h2{font-size:3rem}
#overlay #timer{font-size:4rem}

.emoji{font-size:1.6rem;cursor:pointer;margin-right:.4rem}
.sel{outline:2px solid #000;border-radius:6px}
</style>
</head>

<body>
<h1>ü•ã Coach Tai Jitsu</h1>

<div class="container">
  <div class="panel">
    <h3>üìö Banque</h3>
    <div id="bank"></div>
  </div>

  <div class="panel">
    <h3>üìù S√©ance</h3>
    <input id="sessionName" placeholder="Nom de la s√©ance">
    <div id="selection"></div>

    <label>Notes</label>
    <textarea id="notes"></textarea>

    <div class="controls">
      <button onclick="startSession()">‚ñ∂Ô∏è D√©marrer</button>
      <button onclick="toggleFullscreen()">üì± Plein √©cran</button>
      <button onclick="showHistory()">üìä Historique</button>
    </div>

    <progress id="progress" value="0" max="100"></progress>
  </div>
</div>

<!-- OVERLAY -->
<div id="overlay">
  <h2 id="overlayName"></h2>
  <div id="timer">00:00</div>
  <progress id="overlayProgress" value="0" max="100"></progress>
  <button onclick="toggleFullscreen()">‚ùå Quitter</button>
</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
/* ===== DONN√âES ===== */
const bankData=[
 {uv:'UV1 Kihon',items:['Kihon simple','Encha√Ænement','Cibles'],criteria:['Pr√©cision','R√©activit√©','Posture']},
 {uv:'UV2 D√©placements',items:['Ta√Ø sabaki','Slow ippon','Ippon kumite'],criteria:['Fluidit√©','√âquilibre','Contr√¥le']},
 {uv:'UV3 Kata',items:['Slow kata','Kata nidan','Bunka√Ø'],criteria:['Exactitude','Ma√Ætrise','Kime']},
 {uv:'UV4 Technique',items:['Shadow'],criteria:['R√©alisme','Zanchin','Protection']},
 {uv:'UV5-6 Randori',items:['Randori shadow'],criteria:['R√©alisme','Zanchin','Protection']}
];

let selection=JSON.parse(localStorage.getItem('tj-selection'))||[];
let history=JSON.parse(localStorage.getItem('tj-history'))||[];
let idx=0;
let running=false;
let fullscreen=false;

/* ===== UTILS ===== */
function speak(txt,cb){
 const u=new SpeechSynthesisUtterance(txt);
 u.lang='fr-FR';
 u.onend=cb;
 speechSynthesis.cancel();
 speechSynthesis.speak(u);
}
function fmt(s){
 return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0');
}

/* ===== RENDER ===== */
function renderBank(){
 const b=document.getElementById('bank');b.innerHTML='';
 bankData.forEach(u=>{
  b.innerHTML+=`<h4>${u.uv}</h4>`;
  u.items.forEach(n=>{
   b.innerHTML+=`
    <div class="exercise">
     ${n}
     <button onclick="add('${u.uv}','${n}')">‚ûï</button>
    </div>`;
  });
 });
}

function renderSelection(){
 const s=document.getElementById('selection');s.innerHTML='';
 selection.forEach((e,i)=>{
  s.innerHTML+=`
   <div class="exercise ${i<idx?'done':i===idx?'active':'selected'}">
    ${e.name}
    <div>
     <input type="range" min="1" max="60" value="${e.duration}" oninput="setDur(${i},this.value)">
     ${e.duration}m
     <button onclick="moveUp(${i})">‚¨ÜÔ∏è</button>
     <button onclick="moveDown(${i})">‚¨áÔ∏è</button>
    </div>
   </div>`;
 });
}

/* ===== ACTIONS ===== */
function add(uv,name){
 selection.push({uv,name,duration:5});
 save();
}
function setDur(i,v){selection[i].duration=+v;save();}
function moveUp(i){
 if(i>0){[selection[i-1],selection[i]]=[selection[i],selection[i-1]];save();}
}
function moveDown(i){
 if(i<selection.length-1){[selection[i+1],selection[i]]=[selection[i],selection[i+1]];save();}
}
function save(){
 localStorage.setItem('tj-selection',JSON.stringify(selection));
 renderSelection();
}

/* ===== ENTRAINEMENT ===== */
function startSession(){
 if(!selection.length||running)return;
 running=true;
 idx=0;
 speak("Commen√ßons l'entra√Ænement",()=>runExercise());
}

function runExercise(){
 if(idx>=selection.length){
  speak("Entra√Ænement termin√©, √† bient√¥t !");
  history.push({date:new Date().toLocaleString(),exercises:selection,notes:notes.value});
  localStorage.setItem('tj-history',JSON.stringify(history));
  running=false;
  return;
 }
 const ex=selection[idx];
 document.getElementById('overlayName').textContent=ex.name;
 let t=ex.duration*60;
 speak(`Exercice ${idx+1} ${ex.name}`,()=>{
  setTimeout(()=>{
   beep.play();
   tick();
   function tick(){
    if(t<=0){
     ding.play();
     speak("Fin de l'exercice",()=>{
      idx++;
      runExercise();
     });
     return;
    }
    t--;
    document.getElementById('timer').textContent=fmt(t);
    const p=((idx+(ex.duration*60-t)/(ex.duration*60))/selection.length)*100;
    progress.value=p;
    overlayProgress.value=p;
    setTimeout(tick,1000);
   }
  },1500);
 });
}

/* ===== FULLSCREEN ===== */
function toggleFullscreen(){
 fullscreen=!fullscreen;
 overlay.style.display=fullscreen?'flex':'none';
}

/* ===== HISTORIQUE ===== */
function showHistory(){
 alert(history.map(h=>`${h.date}\n${h.exercises.map(e=>e.name).join(', ')}`).join('\n\n')||"Aucune s√©ance");
}

/* INIT */
renderBank();
renderSelection();
</script>
</body>
</html>
