<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu â€“ SÃ©ance + Ã‰valuation</title>

<style>
body{font-family:system-ui,sans-serif;margin:0;background:linear-gradient(to right,#ffecd2,#fcb69f);}
h1{text-align:center;padding:1rem;}
.container{max-width:1100px;margin:auto;padding:1rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
.panel{background:#fff;border-radius:16px;padding:1rem;box-shadow:0 6px 14px rgba(0,0,0,.15);}
.uv{margin-bottom:1rem;}
.exercise{display:flex;justify-content:space-between;align-items:center;padding:.5rem .7rem;border-radius:10px;margin:.3rem 0;background:#f5f5f5;}
.exercise.selected{background:#d1f5d3;}
.exercise.active{background:#ffe8b3;}
.exercise.done{text-decoration:line-through;opacity:.6;}
.exercise button{border:none;border-radius:8px;padding:.3rem .6rem;cursor:pointer;}
.controls{margin-top:.8rem;display:flex;gap:.5rem;flex-wrap:wrap;}
input[type=text]{width:100%;padding:.6rem;border-radius:10px;border:1px solid #ccc;margin-bottom:.5rem;}
input[type=range]{width:120px;}
textarea{width:100%;border-radius:12px;padding:.6rem;margin-top:.5rem;}
label{font-weight:bold;}
progress{width:100%;height:16px}

/* Objectifs hebdomadaires */
.goal-row{background:#f5f5f5;border-radius:12px;padding:.6rem;margin:.4rem 0;}
.goal-row input{width:70px;}
.goal-row progress{height:12px}

/* Overlay */
#trainingOverlay{display:none;position:fixed;inset:0;background:linear-gradient(to right,#84fab0,#8fd3f4);z-index:999;
flex-direction:column;justify-content:center;align-items:center;}
#trainingOverlay h1{font-size:3rem;}
#trainingOverlay #timer{font-size:4rem;}
#trainingOverlay button{margin-top:2rem;padding:1rem 2rem;font-size:1.2rem;border-radius:12px;}
</style>
</head>

<body>
<h1>ğŸ¥‹ Coach Tai Jitsu â€“ SÃ©ance + Ã‰valuation</h1>

<div class="container">

  <!-- OBJECTIFS -->
  <div class="panel">
    <h2>ğŸ¯ Objectifs hebdomadaires</h2>
    <div id="weeklyGoals"></div>
  </div>

  <!-- BANQUE -->
  <div class="panel">
    <h2>ğŸ“š Banque d'exercices</h2>
    <div id="bank"></div>
  </div>

  <!-- SÃ‰ANCE -->
  <div class="panel">
    <h2>ğŸ“ SÃ©ance sÃ©lectionnÃ©e</h2>
    <input type="text" id="sessionName" placeholder="Nom de la sÃ©ance">
    <div id="selection"></div>
    <label>Carnet de notes :</label>
    <textarea id="notes" rows="3"></textarea>
    <div class="controls">
      <button onclick="saveSelection()">ğŸ’¾ Sauvegarder</button>
      <button onclick="clearSelection()">ğŸ§¹ Vider</button>
      <button onclick="startSession()">â–¶ï¸ DÃ©marrer</button>
      <button onclick="toggleFullscreen()">ğŸ“± Plein Ã©cran</button>
      <button onclick="showHistory()">ğŸ“Š Historique</button>
    </div>
    <progress id="progress" value="0" max="100"></progress>
  </div>

</div>

<!-- OVERLAY -->
<div id="trainingOverlay">
  <h1 id="exerciseName"></h1>
  <div id="timer">00:00</div>
  <progress id="sessionProgress" value="0" max="100"></progress>
  <button onclick="toggleFullscreen()">âŒ Quitter</button>
</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;
justify-content:center;align-items:center;">
  <div style="background:#fff;padding:1rem;border-radius:16px;max-width:600px;width:100%;">
    <h2>ğŸ“‹ Historique & Ã‰valuation</h2>
    <div id="historyList"></div>
    <button onclick="closeModal()">âŒ Fermer</button>
  </div>
</div>

<script>
/* ==== DONNÃ‰ES EXISTANTES ==== */
const bankData=[
{uv:'ğŸ¥‹ UV 1 â€“ Kihon',items:['Kihon simple','EnchaÃ®nement de kihon','Cibles'],criteria:['PrÃ©cision','RÃ©activitÃ©','Posture']},
{uv:'ğŸŒ€ UV 2 â€“ DÃ©placements',items:['TaÃ¯ sabaki','Slow ippon','Ippon kumite'],criteria:['FluiditÃ©','Ã‰quilibre','ContrÃ´le']},
{uv:'ğŸ“ UV 3 â€“ Kata',items:['Slow kata','Kata nidan','BunkaÃ¯'],criteria:['Exactitude','MaÃ®trise','Kime']},
{uv:'âš™ï¸ UV 4 â€“ Technique',items:['Shadow'],criteria:['RÃ©alisme','Zanchin','Protection']},
{uv:'ğŸ”¥ UV 5 & 6 â€“ Randori',items:['Randori shadow'],criteria:['RÃ©alisme','Zanchin','Protection']}
];

let selection=JSON.parse(localStorage.getItem('tj-selection'))||[];
let sessions=JSON.parse(localStorage.getItem('tj-sessions'))||{};
let weeklyGoals=JSON.parse(localStorage.getItem('tj-weekly-goals'))||{};
let weeklyProgress=JSON.parse(localStorage.getItem('tj-weekly-progress'))||{};
let seqIndex=0,timer=null,fullscreen=false,currentSessionName="";

/* ==== OBJECTIFS ==== */
function renderWeeklyGoals(){
 const d=document.getElementById('weeklyGoals'); d.innerHTML='';
 if(selection.length===0){d.innerHTML='<em>Aucun exercice sÃ©lectionnÃ©</em>';return;}
 selection.forEach(ex=>{
  weeklyGoals[ex.name]??=60;
  weeklyProgress[ex.name]??=0;
  const pct=Math.min(weeklyProgress[ex.name]/weeklyGoals[ex.name]*100,100).toFixed(0);
  d.innerHTML+=`
  <div class="goal-row">
   <strong>${ex.name}</strong><br>
   Objectif <input type="number" value="${weeklyGoals[ex.name]}"
   onchange="weeklyGoals['${ex.name}']=this.value;saveWeekly();renderWeeklyGoals()"> min
   <progress value="${pct}" max="100"></progress>
   <small>${weeklyProgress[ex.name]} / ${weeklyGoals[ex.name]} min (${pct}%)</small>
  </div>`;
 });
 saveWeekly();
}
function saveWeekly(){
 localStorage.setItem('tj-weekly-goals',JSON.stringify(weeklyGoals));
 localStorage.setItem('tj-weekly-progress',JSON.stringify(weeklyProgress));
}

/* ==== BANQUE & SÃ‰LECTION (INCHANGÃ‰ES) ==== */
function renderBank(){
 const b=document.getElementById('bank'); b.innerHTML='';
 bankData.forEach(u=>{
  const d=document.createElement('div'); d.className='uv'; d.innerHTML=`<h3>${u.uv}</h3>`;
  u.items.forEach(n=>{
   const e=document.createElement('div'); e.className='exercise';
   e.innerHTML=`<span>${n}</span><button onclick="addExercise('${u.uv}','${n}')">â•</button>`;
   d.appendChild(e);
  });
  b.appendChild(d);
 });
}

function renderSelection(){
 const s=document.getElementById('selection'); s.innerHTML='';
 selection.forEach((ex,i)=>{
  const d=document.createElement('div'); d.className='exercise selected';
  d.innerHTML=`
   <span>${ex.name}</span>
   <div>
    <input type="range" min="1" max="60" value="${ex.duration}"
     oninput="selection[${i}].duration=this.value;saveSelection()">
    ${ex.duration} min
    <button onclick="moveUp(${i})">â¬†ï¸</button>
    <button onclick="moveDown(${i})">â¬‡ï¸</button>
    <button onclick="removeExercise(${i})">âŒ</button>
   </div>`;
  s.appendChild(d);
 });
 renderWeeklyGoals();
}

function addExercise(uv,name){selection.push({uv,name,duration:5});saveSelection();}
function removeExercise(i){selection.splice(i,1);saveSelection();}
function moveUp(i){if(i>0)[selection[i-1],selection[i]]=[selection[i],selection[i-1]];saveSelection();}
function moveDown(i){if(i<selection.length-1)[selection[i+1],selection[i]]=[selection[i],selection[i+1]];saveSelection();}
function saveSelection(){localStorage.setItem('tj-selection',JSON.stringify(selection));renderSelection();}
function clearSelection(){selection=[];saveSelection();}

/* ==== SESSION (INCHANGÃ‰E SAUF INCRÃ‰MENT) ==== */
function startSession(){
 if(selection.length===0)return alert('SÃ©lection vide');
 saveSessionAuto(); seqIndex=0; nextExercise();
}

function toggleFullscreen(){
 fullscreen=!fullscreen;
 document.getElementById('trainingOverlay').style.display=fullscreen?'flex':'none';
}

function nextExercise(){
 if(seqIndex>=selection.length){toggleFullscreen();return;}
 const ex=selection[seqIndex];
 let t=ex.duration*60;
 document.getElementById('exerciseName').textContent=ex.name;
 updateState();
 if(fullscreen) document.getElementById('trainingOverlay').style.display='flex';
 timer=setInterval(()=>{
  t--; document.getElementById('timer').textContent=format(t);
  if(t<=0){
   clearInterval(timer);
   weeklyProgress[ex.name]+=ex.duration;
   saveWeekly(); renderWeeklyGoals();
   seqIndex++; nextExercise();
  }
 },1000);
}

function updateState(){
 document.querySelectorAll('#selection .exercise').forEach((e,i)=>{
  e.classList.toggle('active',i===seqIndex);
  e.classList.toggle('done',i<seqIndex);
 });
}

function format(s){return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0');}

/* ==== HISTORIQUE & Ã‰VALUATION : INTACT ==== */
function saveSessionAuto(){
 const n=sessionName.value||'SÃ©ance '+new Date().toLocaleString();
 currentSessionName=n;
 sessions[n]={exercises:[...selection],notes:notes.value,date:new Date().toLocaleString()};
 localStorage.setItem('tj-sessions',JSON.stringify(sessions));
}
function showHistory(){
 let h='';
 for(const n in sessions)h+=`<div><strong>${n}</strong> (${sessions[n].date})</div>`;
 modal.style.display='flex'; historyList.innerHTML=h;
}
function closeModal(){modal.style.display='none';}

/* ==== INIT ==== */
renderBank();
renderSelection();
renderWeeklyGoals();
</script>
</body>
</html>
