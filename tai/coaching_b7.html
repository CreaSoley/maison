<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(to right,#ffecd2,#fcb69f);
}
h1{text-align:center;margin:1rem}
.container{
  max-width:1100px;
  margin:auto;
  padding:1rem;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:1rem;
}
.panel{
  background:#fff;
  border-radius:16px;
  padding:1rem;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
}
.exercise{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:.5rem;
  margin:.3rem 0;
  background:#f3f3f3;
  border-radius:10px;
}
.exercise.active{background:#ffe6a7}
.exercise.done{opacity:.5;text-decoration:line-through}
button{
  border:none;
  border-radius:8px;
  padding:.4rem .7rem;
  cursor:pointer;
}
.controls{display:flex;flex-wrap:wrap;gap:.4rem;margin:.5rem 0}
progress{width:100%;height:14px}
textarea,input{width:100%;border-radius:8px;padding:.4rem}
#overlay{
  display:none;
  position:fixed;
  inset:0;
  background:linear-gradient(to right,#84fab0,#8fd3f4);
  z-index:1000;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
#overlay h2{font-size:3rem}
#timer{font-size:4rem}
.emoji{font-size:1.6rem;cursor:pointer}
.sel{outline:2px solid black;border-radius:6px}
</style>
</head>

<body>
<h1>ğŸ¥‹ Coach Tai Jitsu</h1>

<div class="container">

<div class="panel">
<h3>ğŸ“š Banque</h3>
<div id="bank"></div>
</div>

<div class="panel">
<h3>ğŸ“ SÃ©ance</h3>

<input id="sessionName" placeholder="Nom de la sÃ©ance">

<div class="controls">
<button onclick="saveSelection()">ğŸ’¾ Enregistrer sÃ©lection</button>
<button onclick="loadSelection()">ğŸ“‚ Charger sÃ©lection</button>
<button onclick="clearSelection()">ğŸ—‘ï¸ Vider</button>
</div>

<div id="selection"></div>

<label>Notes</label>
<textarea id="notes"></textarea>

<div class="controls">
<button onclick="startSession()">â–¶ï¸ DÃ©marrer</button>
<button onclick="pauseSession()">â¸ï¸ Pause</button>
<button onclick="resumeSession()">â–¶ï¸ Reprendre</button>
<button onclick="stopSession()">â¹ï¸ Stop</button>
<button onclick="toggleFullscreen()">ğŸ“± Plein Ã©cran</button>
<button onclick="showHistory()">ğŸ“Š Historique</button>
</div>

<progress id="sessionProgress" value="0" max="100"></progress>

<h4>ğŸ¯ Objectifs hebdomadaires</h4>
<div id="goals"></div>
</div>

</div>

<!-- OVERLAY -->
<div id="overlay">
<h2 id="overlayName"></h2>
<div id="timer">00:00</div>
<progress id="overlayProgress" value="0" max="100"></progress>
<button onclick="toggleFullscreen()">âŒ Quitter</button>
</div>

<script>
/* ===== DONNÃ‰ES ===== */
const bankData=[
 {uv:'UV1 Kihon',items:['Kihon simple','EnchaÃ®nement','Cibles'],criteria:['PrÃ©cision','Posture','Rythme']},
 {uv:'UV2 DÃ©placements',items:['TaÃ¯ sabaki','Slow ippon','Ippon kumite'],criteria:['FluiditÃ©','Ã‰quilibre','Timing']},
 {uv:'UV3 Kata',items:['Slow kata','Kata nidan','BunkaÃ¯'],criteria:['Exactitude','Kime','Zanchin']},
];

let selection=JSON.parse(localStorage.getItem('tj-selection'))||[];
let savedSelections=JSON.parse(localStorage.getItem('tj-saved'))||{};
let sessions=JSON.parse(localStorage.getItem('tj-sessions'))||[];
let goals=JSON.parse(localStorage.getItem('tj-goals'))||{};
let idx=0,remaining=0,timer=null;
let running=false,paused=false,fullscreen=false;

/* ===== UTILS ===== */
function speak(txt,cb){
 speechSynthesis.cancel();
 const u=new SpeechSynthesisUtterance(txt);
 u.lang='fr-FR';
 u.onend=cb;
 speechSynthesis.speak(u);
}
function fmt(s){return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0');}
function weekKey(){
 const d=new Date(),j=new Date(d.getFullYear(),0,1);
 return d.getFullYear()+"-W"+Math.ceil((((d-j)/86400000)+j.getDay()+1)/7);
}

/* ===== RENDER ===== */
function renderBank(){
 const b=document.getElementById('bank');b.innerHTML='';
 bankData.forEach(u=>{
  b.innerHTML+=`<h4>${u.uv}</h4>`;
  u.items.forEach(n=>{
   b.innerHTML+=`
   <div class="exercise">${n}
    <button onclick="addExercise('${u.uv}','${n}')">â•</button>
   </div>`;
  });
 });
}

function renderSelection(){
 const s=document.getElementById('selection');s.innerHTML='';
 selection.forEach((e,i)=>{
  s.innerHTML+=`
  <div class="exercise ${i===idx?'active':i<idx?'done':''}">
   ${e.name} (${e.duration} min)
   <div>
    <input type="range" min="1" max="60" value="${e.duration}" oninput="setDuration(${i},this.value)">
    <button onclick="moveUp(${i})">â¬†ï¸</button>
    <button onclick="moveDown(${i})">â¬‡ï¸</button>
   </div>
  </div>`;
 });
}

/* ===== ACTIONS ===== */
function addExercise(uv,name){selection.push({uv,name,duration:5});persist();}
function setDuration(i,v){selection[i].duration=+v;persist();}
function moveUp(i){ if(i>0){[selection[i-1],selection[i]]=[selection[i],selection[i-1]];persist();}}
function moveDown(i){ if(i<selection.length-1){[selection[i+1],selection[i]]=[selection[i],selection[i+1]];persist();}}
function persist(){
 localStorage.setItem('tj-selection',JSON.stringify(selection));
 renderSelection();renderGoals();
}
function clearSelection(){selection=[];persist();}

function saveSelection(){
 const name=prompt("Nom de la sÃ©lection");
 if(!name)return;
 savedSelections[name]=selection;
 localStorage.setItem('tj-saved',JSON.stringify(savedSelections));
}
function loadSelection(){
 const name=prompt("Nom ?");
 if(savedSelections[name]){
  selection=savedSelections[name];
  persist();
 }
}

/* ===== OBJECTIFS ===== */
function renderGoals(){
 const g=document.getElementById('goals');g.innerHTML='';
 const wk=weekKey();
 selection.forEach(e=>{
  if(!goals[e.name]) goals[e.name]=30;
  let done=0;
  sessions.forEach(s=>{
   if(s.week===wk){
    s.exercises.forEach(x=>{if(x.name===e.name)done+=x.done;});
   }
  });
  const pct=Math.min(100,Math.round(done/goals[e.name]*100));
  g.innerHTML+=`
  <div>
   ${e.name}
   <input type="number" value="${goals[e.name]}" onchange="goals['${e.name}']=+this.value;saveGoals()">
   <progress value="${pct}" max="100"></progress> ${pct}%
  </div>`;
 });
}
function saveGoals(){localStorage.setItem('tj-goals',JSON.stringify(goals));renderGoals();}

/* ===== ENTRAINEMENT ===== */
function startSession(){
 if(!selection.length||running)return;
 running=true;paused=false;idx=0;
 sessions.push({date:new Date().toLocaleString(),week:weekKey(),exercises:[],notes:notes.value});
 speak("CommenÃ§ons l'entraÃ®nement",runExercise);
}

function runExercise(){
 if(!running||paused)return;
 if(idx>=selection.length){
  speak("EntraÃ®nement terminÃ©, Ã  bientÃ´t !");
  localStorage.setItem('tj-sessions',JSON.stringify(sessions));
  running=false;return;
 }
 const ex=selection[idx];
 overlayName.textContent=ex.name;
 remaining=ex.duration*60;
 speak(`Exercice ${idx+1} ${ex.name}`,tick);
}

function tick(){
 if(!running||paused)return;
 timer=document.getElementById('timer');
 timer.textContent=fmt(remaining);
 const p=((idx+(selection[idx].duration*60-remaining)/(selection[idx].duration*60))/selection.length)*100;
 sessionProgress.value=p;overlayProgress.value=p;
 if(remaining--<=0){
  sessions[sessions.length-1].exercises.push({name:selection[idx].name,done:selection[idx].duration});
  speak("Fin de l'exercice",()=>{idx++;runExercise();});
  return;
 }
 setTimeout(tick,1000);
}

/* ===== CONTROLES ===== */
function pauseSession(){paused=true;}
function resumeSession(){if(paused){paused=false;tick();}}
function stopSession(){running=false;paused=false;}
function toggleFullscreen(){
 fullscreen=!fullscreen;
 overlay.style.display=fullscreen?'flex':'none';
}

/* ===== HISTORIQUE ===== */
function showHistory(){
 alert(sessions.map(s=>`${s.date}\n${s.exercises.map(e=>e.name+' '+e.done+'m').join(', ')}`).join('\n\n')||"Aucune sÃ©ance");
}

/* INIT */
renderBank();renderSelection();renderGoals();
</script>
</body>
</html>
