<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ¥‹ Coach KaratÃ©</title>

<style>
body{
 margin:0;
 font-family:system-ui;
 background:linear-gradient(to right,#ffecd2,#fcb69f);
}
header{
 background:linear-gradient(120deg,#84fab0,#8fd3f4);
 text-align:center;
 padding:12px;
}
.container{
 max-width:900px;
 margin:auto;
 padding:16px;
}
button{
 padding:12px 18px;
 border:none;
 border-radius:20px;
 margin:6px;
 font-size:16px;
 box-shadow:0 6px 12px rgba(0,0,0,.2);
}
.primary{background:#84fab0}
.warn{background:#ffd86f}
ul{list-style:none;padding:0}
li{
 background:#fff;
 margin:10px 0;
 padding:14px;
 border-radius:18px;
 box-shadow:0 6px 12px rgba(0,0,0,.15);
}
.progress{
 height:8px;
 background:#eee;
 border-radius:8px;
 margin-top:6px;
}
.progress div{
 height:100%;
 background:linear-gradient(120deg,#84fab0,#8fd3f4);
}
.modal{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.5);
 display:none;
 align-items:center;
 justify-content:center;
}
.card{
 background:white;
 border-radius:20px;
 padding:18px;
 width:90%;
 max-width:520px;
 max-height:90%;
 overflow:auto;
}
.smile{
 font-size:26px;
 padding:6px;
 cursor:pointer;
}
.smile.active{transform:scale(1.3)}
canvas{max-width:100%}
textarea{width:100%}
</style>
</head>

<body>

<header>
<h2>ğŸ¥‹ Coach KaratÃ©</h2>
</header>

<div class="container">

<button class="primary" onclick="start()">â–¶ Lancer</button>
<button class="warn" onclick="pause()">â¸ Pause</button>
<button onclick="resetSession()">â™» Reset</button>
<button onclick="openEval()">ğŸ“ Auto-Ã©valuation</button>

<ul id="list"></ul>

<h3>ğŸ“Š Radar (7 jours)</h3>
<canvas id="radar" width="300" height="300"></canvas>

</div>

<div class="modal" id="evalModal">
 <div class="card">
  <h3>ğŸ“ Ã‰valuation du jour</h3>
  <div id="evalContent"></div>

  <h4>ğŸ’¬ Commentaire</h4>
  <textarea id="comment" rows="3"></textarea>

  <button class="primary" onclick="saveEval()">ğŸ’¾ Enregistrer</button>
  <button onclick="closeEval()">Fermer</button>
 </div>
</div>

<audio id="ding" src="ding.mp3"></audio>

<script>
/* ===== DONNÃ‰ES ===== */
const exercises=[
 {id:"Kihon",label:"ğŸ¥‹ Kihon",duration:60,progress:0},
 {id:"Kata",label:"ğŸ§˜ Kata",duration:60,progress:0},
 {id:"Randori",label:"ğŸ”¥ Randori",duration:60,progress:0}
];

const criteria={
 Kihon:["distance","kime","prÃ©cision"],
 Kata:["fluiditÃ©","Ã©quilibre","kime"],
 Randori:["distance","timing","engagement"]
};

let index=0;
let timer=null;
let remaining=0;

/* ===== UTILS ===== */
const today=()=>new Date().toISOString().slice(0,10);
const log=()=>JSON.parse(localStorage.getItem("log")||"{}");
const save=l=>localStorage.setItem("log",JSON.stringify(l));

/* ===== RENDER ===== */
function render(){
 const ul=document.getElementById("list");
 ul.innerHTML="";
 exercises.forEach(e=>{
  const li=document.createElement("li");
  li.innerHTML=`<strong>${e.label}</strong>
  <div class="progress"><div style="width:${e.progress}%"></div></div>`;
  ul.appendChild(li);
 });
}
render();

/* ===== TIMER ===== */
function start(){
 if(timer) return;
 run();
}

function run(){
 if(index>=exercises.length){
  clearInterval(timer);
  timer=null;
  const l=log();
  l[today()]={done:true};
  save(l);
  drawRadar();
  return;
 }
 const e=exercises[index];
 remaining=e.duration;
 timer=setInterval(()=>{
  remaining--;
  e.progress=100-(remaining/e.duration)*100;
  render();
  if(remaining<=0){
   clearInterval(timer);
   timer=null;
   index++;
   run();
  }
 },1000);
}

function pause(){
 clearInterval(timer);
 timer=null;
}

function resetSession(){
 pause();
 index=0;
 exercises.forEach(e=>e.progress=0);
 render();
}

/* ===== AUTO-EVAL ===== */
function openEval(){
 const c=document.getElementById("evalContent");
 c.innerHTML="";
 const l=log();
 if(!l[today()]){
  c.innerHTML="<p>Aucune sÃ©ance aujourdâ€™hui.</p>";
 }else{
  exercises.forEach(e=>{
   c.innerHTML+=`<h4>${e.label}</h4>`;
   criteria[e.id].forEach(cr=>{
    c.innerHTML+=`${cr} :
    ${[1,2,3,4,5].map(v=>
     `<span class="smile" data-e="${e.id}" data-c="${cr}" data-v="${v}">
     ${["ğŸ˜","ğŸ˜","ğŸ™‚","ğŸ˜„","ğŸ”¥"][v-1]}</span>`
    ).join("")}<br>`;
   });
  });
 }
 document.querySelectorAll(".smile").forEach(s=>{
  s.onclick=()=>{
   s.parentNode.querySelectorAll(".smile").forEach(x=>x.classList.remove("active"));
   s.classList.add("active");
  };
 });
 document.getElementById("evalModal").style.display="flex";
}

function saveEval(){
 const l=log();
 l[today()].eval={};
 document.querySelectorAll(".smile.active").forEach(s=>{
  const e=s.dataset.e;
  const c=s.dataset.c;
  const v=parseInt(s.dataset.v);
  l[today()].eval[e]=l[today()].eval[e]||{};
  l[today()].eval[e][c]=v;
 });
 l[today()].comment=document.getElementById("comment").value;
 save(l);
 closeEval();
 drawRadar();
}

function closeEval(){
 document.getElementById("evalModal").style.display="none";
}

/* ===== RADAR ===== */
function drawRadar(){
 const ctx=document.getElementById("radar").getContext("2d");
 ctx.clearRect(0,0,300,300);
 const l=log();
 const acc={};
 Object.values(l).forEach(d=>{
  if(!d.eval) return;
  Object.values(d.eval).forEach(e=>{
   Object.entries(e).forEach(([k,v])=>{
    acc[k]=acc[k]||[];
    acc[k].push(v);
   });
  });
 });
 const keys=Object.keys(acc);
 if(!keys.length) return;
 const cx=150,cy=150,r=100;
 keys.forEach((k,i)=>{
  const a=(Math.PI*2/keys.length)*i-Math.PI/2;
  const avg=acc[k].reduce((a,b)=>a+b)/acc[k].length;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(cx+Math.cos(a)*r*avg/5,cy+Math.sin(a)*r*avg/5);
  ctx.stroke();
  ctx.fillText(k,cx+Math.cos(a)*(r+8),cy+Math.sin(a)*(r+8));
 });
}
</script>

</body>
</html>
