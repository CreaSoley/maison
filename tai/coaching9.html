<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ¥‹ Carnet dâ€™entraÃ®nement KaratÃ©</title>

<style>
:root{
 --g1:linear-gradient(to right,#ffecd2,#fcb69f);
 --g2:linear-gradient(120deg,#84fab0,#8fd3f4);
}
body{margin:0;font-family:system-ui;background:var(--g1)}
header{text-align:center;padding:14px;background:var(--g2)}
.container{max-width:900px;margin:auto;padding:16px}

button{
 padding:12px 18px;border:none;border-radius:20px;
 margin:6px;font-size:16px;
 box-shadow:0 6px 12px rgba(0,0,0,.2)
}
.primary{background:#84fab0}
.warn{background:#ffd86f}
.danger{background:#ff8a8a}
.small{font-size:14px;padding:8px 12px}

ul{list-style:none;padding:0}
li{
 background:white;margin:10px 0;padding:14px;
 border-radius:18px;
 box-shadow:0 6px 12px rgba(0,0,0,.15)
}
.active{border:3px solid #84fab0}

.progress{height:8px;background:#eee;border-radius:8px;margin-top:6px}
.progress div{height:100%;background:var(--g2)}

.timeline{height:14px;background:#eee;border-radius:10px}
.timeline div{height:100%;background:var(--g2)}

.modal{
 position:fixed;inset:0;background:rgba(0,0,0,.5);
 display:none;align-items:center;justify-content:center
}
.card{
 background:white;border-radius:20px;padding:20px;
 width:90%;max-width:520px;max-height:90%;overflow:auto
}

.smile{font-size:26px;padding:6px;cursor:pointer}
.smile.active{transform:scale(1.3)}

canvas{max-width:100%}
textarea{width:100%}
</style>
</head>

<body>

<header>
<h1>ğŸ¥‹ Carnet dâ€™entraÃ®nement KaratÃ©</h1>
</header>

<div class="container">

<button class="primary" onclick="start()">â–¶ Lancer</button>
<button class="warn" onclick="pause()">â¸ Pause</button>
<button onclick="newSession()">â™» Nouvelle sÃ©ance</button>
<button onclick="openEval()">ğŸ“ Auto-Ã©valuation</button>

<h3>Progression globale</h3>
<div class="timeline"><div id="global"></div></div>

<ul id="program"></ul>

<h3>ğŸ“Š Radar (7 jours)</h3>
<canvas id="radar" width="320" height="320"></canvas>

</div>

<div class="modal" id="evalModal">
 <div class="card">
  <h2>ğŸ“ Auto-Ã©valuation</h2>
  <div id="evalContent"></div>

  <h4>ğŸ’¬ Commentaire</h4>
  <textarea id="comment" rows="3"></textarea>

  <button class="primary" onclick="saveEval()">ğŸ’¾ Enregistrer</button>
  <button onclick="closeEval()">Fermer</button>
 </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const UV_CRITERIA={
 Kihon:["distance","kime","prÃ©cision"],
 Kata:["fluiditÃ©","Ã©quilibre","kime"],
 Randori:["distance","timing","engagement"]
};

/* ---------- STATE ---------- */
let interval=null,currentIndex=0,remaining=0;
const synth = window.speechSynthesis || null;

let exercises=[
 {speech:"Kihon",uv:"Kihon",duration:1,progress:0},
 {speech:"Kata",uv:"Kata",duration:1,progress:0},
 {speech:"Randori",uv:"Randori",duration:1,progress:0}
];

render();update();

/* ---------- RENDER ---------- */
function render(){
 const ul=document.getElementById("program");
 ul.innerHTML="";
 exercises.forEach((e,i)=>{
  const li=document.createElement("li");
  if(i===currentIndex) li.classList.add("active");
  li.innerHTML=`<strong>${e.speech}</strong>
   <div class="progress"><div style="width:${e.progress}%"></div></div>`;
  ul.appendChild(li);
 });
}

/* ---------- TIMER ---------- */
function start(){
 if(interval) return;
 play();
}

function play(){
 if(currentIndex>=exercises.length){
  speak("Fin de l'entraÃ®nement");
  return;
 }
 const e=exercises[currentIndex];
 speak(e.speech);
 remaining=e.duration*60;
 interval=setInterval(()=>{
  remaining--;
  e.progress=100-(remaining/(e.duration*60))*100;
  update();
  if(remaining<=0){
   clearInterval(interval);interval=null;
   logExercise(e.speech);
   currentIndex++;
   play();
  }
 },1000);
}

function pause(){
 clearInterval(interval);interval=null;
}

function newSession(){
 pause();
 currentIndex=0;
 exercises.forEach(e=>e.progress=0);
 update();
}

/* ---------- SPEECH ---------- */
function speak(t){
 if(!synth) return;
 synth.cancel();
 const u=new SpeechSynthesisUtterance(t);
 u.lang="fr-FR";
 synth.speak(u);
}

/* ---------- JOURNAL ---------- */
function logExercise(name){
 const d=new Date().toISOString().slice(0,10);
 const s=JSON.parse(localStorage.getItem("sessions")||"{}");
 s[d]=s[d]||{exercises:[]};
 if(!s[d].exercises.includes(name)) s[d].exercises.push(name);
 localStorage.setItem("sessions",JSON.stringify(s));
}

/* ---------- AUTO-EVAL ---------- */
function openEval(){
 const c=document.getElementById("evalContent");
 c.innerHTML="";
 const d=new Date().toISOString().slice(0,10);
 const s=JSON.parse(localStorage.getItem("sessions")||"{}");
 const done=s[d]?.exercises||[];

 if(!done.length){
  c.innerHTML="<p>Aucun exercice terminÃ© aujourdâ€™hui.</p>";
 }else{
  done.forEach(name=>{
   const e=exercises.find(x=>x.speech===name);
   let html=`<h4>${name}</h4>`;
   UV_CRITERIA[e.uv].forEach(cr=>{
    html+=`${cr} :
     ${[1,2,3,4,5].map(v=>
      `<span class="smile" data-ex="${name}" data-cr="${cr}" data-v="${v}">
       ${["ğŸ˜","ğŸ˜","ğŸ™‚","ğŸ˜„","ğŸ”¥"][v-1]}</span>`).join("")}<br>`;
   });
   c.innerHTML+=html;
  });
 }

 document.querySelectorAll(".smile").forEach(s=>{
  s.onclick=()=>{
   s.parentNode.querySelectorAll(".smile").forEach(x=>x.classList.remove("active"));
   s.classList.add("active");
  };
 });

 document.getElementById("evalModal").style.display="flex";
}

function saveEval(){
 closeEval();
 drawRadar();
}

function closeEval(){
 document.getElementById("evalModal").style.display="none";
}

/* ---------- RADAR ---------- */
function drawRadar(){
 const ctx=document.getElementById("radar").getContext("2d");
 ctx.clearRect(0,0,320,320);
}

/* ---------- UI ---------- */
function update(){
 render();
 const t=exercises.reduce((a,e)=>a+e.duration,0);
 const d=exercises.reduce((a,e)=>a+(e.progress/100*e.duration),0);
 document.getElementById("global").style.width=(d/t*100)+"%";
}
</script>

</body>
</html>
