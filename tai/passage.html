<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tai-Jitsu – Entraînement</title>

  <!-- Police Spicy -->
  <style>
    @font-face {
      font-family: "Spicy";
      src: url("Spicy Sale.ttf");
    }
    .spicy { font-family: "Spicy", cursive; }

    body { margin:0; background:#fafafa; font-family:Arial, sans-serif; }

    /* HEADER */
    header {
      background:black;
      color:white;
      padding:20px;
      display:flex;
      align-items:center;
      gap:20px;
    }
    header img { height:80px; }
    header h1 { font-size:2.5rem; margin:0; }

    /* ENCARTS */
    .grid-container{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      padding:20px;
      gap:20px;
    }
    .card{
      background:white;
      border-radius:18px;
      box-shadow:0 3px 8px rgba(0,0,0,0.1);
      padding:20px;
    }
    .card-title{
      display:flex;
      align-items:center;
      font-size:1.8rem;
      margin-bottom:12px;
    }
    .card-title img{
      width:40px;
      margin-right:10px;
    }

    /* BIBLIOTHÈQUE */
    .library{
      display:flex;
      gap:20px;
      justify-content:center;
      padding-top:10px;
    }
    .book{
      width:120px;
      height:160px;
      background:#c58a4b;
      border-radius:6px;
      cursor:pointer;
      box-shadow:0 4px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="logo" />
  <h1 class="spicy">Tai-Jitsu</h1>
</header>

<div class="grid-container">

  <!-- UV1 Kihon -->
  <div class="card" id="uv1">
    <div class="card-title spicy"><img src="ceinture.png"/>UV1 – Kihon</div>
    <div id="kihon-techniques"></div>
    <hr>
    <button onclick="nouveauxEnchainements()">Nouveaux enchaînements</button>
    <div id="enchainements"></div>
    <hr>
    <div id="kihon-combat"></div>
  </div>

  <!-- UV2 -->
  <div class="card" id="uv2">
    <div class="card-title spicy"><img src="ceinture.png"/>UV2 – Ippon Kumite</div>

    <!-- HIIT TIMER SECTION -->
    <section id="hiit-section" style="padding:20px; margin-top:20px; background:#111; border-radius:12px; color:white;">
      <h2 style="text-align:center; margin-bottom:20px;">Entraînement HIIT</h2>

      <div class="hiit-config" style="display:flex; gap:20px; justify-content:center; margin-bottom:20px; flex-wrap:wrap;">
        <label>Travail (sec)<br><input type="number" id="hiitWork" value="20"></label>
        <label>Repos (sec)<br><input type="number" id="hiitRest" value="10"></label>
        <label>Rounds<br><input type="number" id="hiitRounds" value="8"></label>
      </div>

      <div style="text-align:center;">
        <button id="hiitStart">Démarrer HIIT</button>
      </div>

      <div id="hiitDisplay" style="text-align:center; margin-top:20px; font-size:1.2em;">
        Round <span id="hiitRound">0</span>/<span id="hiitRoundTotal">0</span> —
        Phase : <span id="hiitPhase">-</span> —
        Temps : <span id="hiitTime">0</span>s
      </div>
    </section>


    
    
  </div>

  <!-- UV3 -->
  <div class="card">
    <div class="card-title spicy"><img src="ceinture.png"/>UV3 – Kata</div>
    <ul>
      <li>kata choisi</li>
      <li>bunkaï 1 : oi tsuki – gyaku tsuki</li>
      <li>bunkaï 2 : saisie des deux poignets</li>
    </ul>
  </div>

  <!-- UV4 -->
  <div class="card">
    <div class="card-title spicy"><img src="ceinture.png"/>UV4 – Technique de base</div>
    <ul>
      <li>Application par atemi</li>
      <li>Application par clé</li>
      <li>Application par projection</li>
    </ul>
  </div>

  <!-- UV5–6 -->
  <div class="card" id="uv5">
    <div class="card-title spicy"><img src="ceinture.png"/>UV5–6 – Randori</div>
    <div id="randori"></div>
  </div>

  <!-- Ressources -->
  <div class="card">
    <div class="card-title spicy"><img src="ceinture.png"/>Ressources</div>
    <div class="library">
      <div class="book" onclick="window.open('livre1.pdf')"></div>
      <div class="book" onclick="window.open('livre2.pdf')"></div>
      <div class="book" onclick="window.open('livre3.pdf')"></div>
      <div class="book" onclick="window.open('livre4.pdf')"></div>
    </div>
  </div>

</div>

<script>
// --- JS UV1 Kihon ---
async function chargerKihon(){
  const r = await fetch('tjkihon.json');
  const data = await r.json();
  const tirage = data.sort(()=>0.5-Math.random()).slice(0,3);
  document.getElementById('kihon-techniques').innerHTML = '<h3 class="spicy">Techniques du jour</h3>' +
    tirage.map(t=>`<div>• ${t.nom}</div>`).join('');
}

const ENCHAINEMENTS = [
  "Oi-zuki jodan → Gyaku-zuki chudan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
  "Mae-geri chudan → Gyaku-zuki chudan<br>• Zenkutsu-dachi → Mae-geri → Gyaku-zuki",
  "Uchi-uke → Gyaku-zuki chudan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
  "Soto-uke → Mae-geri → Gyaku-zuki<br>• Zenkutsu-dachi → Mae-geri → Gyaku-zuki",
  "Age-uke → Gyaku-zuki jodan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
  "Oi-zuki chudan → Ushiro-geri<br>• Avancée Zenkutsu → Kokutsu/Heiko → Ushiro-geri",
  "Gedan-barai → Oi-zuki chudan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
  "Teisho-uchi jodan → Mae-geri chudan<br>• Zenkutsu → Mae-geri → Zenkutsu",
  "Shuto-uke → Shuto-uchi<br>• Kokutsu → Zenkutsu/Shiko",
  "Haito-uke → Gyaku-zuki chudan<br>• Zenkutsu → Zenkutsu",
  "Fumikomi → Gyaku-zuki<br>• Zenkutsu → Fumikomi → Gyaku-zuki",
  "Soto-uke → Mawashi-geri chudan<br>• Zenkutsu → Mawashi → Zenkutsu",
  "Uraken → Gyaku-zuki<br>• Zenkutsu → Zenkutsu",
  "Oi-zuki → Kote-uchi<br>• Zenkutsu → Heiko/Sanchin",
  "Shuto-uke → Hiza-geri<br>• Kokutsu → Heiko → Hiza-geri",
  "Mae-geri → Empi<br>• Zenkutsu → Mae-geri → Sanchin/Heiko → Empi",
  "Soto-uke → Teisho<br>• Zenkutsu → Zenkutsu",
  "Gedan-barai → Mawashi jambe avant<br>• Zenkutsu → Mawashi → Zenkutsu",
  "Uraken → Mae-geri → Gyaku-zuki<br>• Zenkutsu → Mae-geri → Gyaku-zuki",
  "Shuto-uke → Shuto-uchi → Teisho<br>• Kokutsu → Zenkutsu/Shiko → Teisho"
];

function nouveauxEnchainements(){
  const e = [...ENCHAINEMENTS].sort(()=>0.5-Math.random()).slice(0,2);
  document.getElementById('enchainements').innerHTML = '<h3 class="spicy">Enchaînements</h3>' +
    e.map(x=>`<p>${x}</p>`).join('');
}

function kihonCombat(){
  const LISTE = [
    "Mae Geri arrière chudan",
    "Mawashi arrière jodan/chudan",
    "Mae Geri avant sursaut chudan",
    "Mawashi avant sursaut jodan/chudan",
    "Gyaku Zuki chudan",
    "Kizami Zuki + Gyaku Zuki",
    "Oï Zuki jodan retour arrière"
  ];
  const t = [...LISTE].sort(()=>0.5-Math.random()).slice(0,3);
  document.getElementById('kihon-combat').innerHTML = '<h3 class="spicy">Techniques combat</h3>' +
    t.map(x=>`<div>• ${x}</div>`).join('');
}

// --- JS UV5–6 randori ---
async function chargerRandori(){
  const r = await fetch('randori.json');
  const data = await r.json();
  const saisies = data.techniques.filter(t=>t.type_attaque==='saisie');
  const frappes = data.techniques.filter(t=>t.type_attaque==='frappe');
  const etranglement = data.techniques.filter(t=>t.type_attaque==='étranglement');
  const armesC = data.techniques.filter(t=>t.type_attaque==='arme – couteau');
  const armesM = data.techniques.filter(t=>t.type_attaque==='arme – matraque');

  const tir_s = saisies.sort(()=>0.5-Math.random()).slice(0,3);
  const tir_f = frappes.sort(()=>0.5-Math.random()).slice(0,2);
   const tir_t = etranglement.sort(()=>0.5-Math.random()).slice(0,1);
  const tir_c = armesC.sort(()=>0.5-Math.random()).slice(0,1);
  const tir_m = armesM.sort(()=>0.5-Math.random()).slice(0,1);

  const bloc = document.getElementById('randori');
  bloc.innerHTML = '<h3 class="spicy">Sélection du jour</h3>' +
    '<h4 class="spicy">Saisies</h4>' + tir_s.map(t=>`<div>• ${t.attaque}</div>`).join('') +
    '<h4 class="spicy">Couteau</h4>' + tir_c.map(t=>`<div>• ${t.attaque}</div>`).join('') +
    '<h4 class="spicy">Etranglement</h4>' + tir_t.map(t=>`<div>• ${t.attaque}</div>`).join('') +
    '<h4 class="spicy">Matraque</h4>' + tir_m.map(t=>`<div>• ${t.attaque}</div>`).join('') +
    '<h4 class="spicy">Frappes</h4>' + tir_f.map(t=>`<div>• ${t.attaque}</div>`).join('');
}

// Lancement
chargerKihon();
kihonCombat();
chargerRandori();
</script>

  <!-- HIIT TIMER SECTION -->
  <section id="hiit-section" style="padding:20px; margin-top:40px; background:#111; border-radius:12px;">
    <h2 style="text-align:center; margin-bottom:20px;">Entraînement HIIT</h2>

    <div class="hiit-config" style="display:flex; gap:20px; justify-content:center; margin-bottom:20px; flex-wrap:wrap;">
      <label>Travail (sec)<br><input type="number" id="hiitWork" value="20" class="training-input"></label>
      <label>Repos (sec)<br><input type="number" id="hiitRest" value="10" class="training-input"></label>
      <label>Rounds<br><input type="number" id="hiitRounds" value="8" class="training-input"></label>
    </div>

    <div style="text-align:center;">
      <button id="hiitStart" class="training-button">Démarrer HIIT</button>
    </div>

    <div id="hiitDisplay" style="text-align:center; margin-top:20px; font-size:1.2em;">
      Round <span id="hiitRound">0</span>/<span id="hiitRoundTotal">0</span> —
      Phase : <span id="hiitPhase">-</span> —
      Temps : <span id="hiitTime">0</span>s
    </div>
  </section>

  <script>
    // HIIT TIMER MODULE
    class HIITTimer {
      constructor({work, rest, rounds, onTick, onRoundChange, onFinish}) {
        this.work = work;
        this.rest = rest;
        this.rounds = rounds;
        this.currentRound = 1;
        this.phase = "work";
        this.timeLeft = work;
        this.interval = null;
        this.onTick = onTick;
        this.onRoundChange = onRoundChange;
        this.onFinish = onFinish;
      }

      start() {
        if (this.interval) return;
        this.interval = setInterval(() => {
          this.timeLeft--;
          if (this.onTick) this.onTick(this);

          if (this.timeLeft <= 0) {
            if (this.phase === "work") {
              this.phase = "rest";
              this.timeLeft = this.rest;
            } else {
              this.phase = "work";
              this.currentRound++;
              this.timeLeft = this.work;
              if (this.onRoundChange) this.onRoundChange(this);
            }

            if (this.currentRound > this.rounds) {
              this.stop();
              if (this.onFinish) this.onFinish();
            }
          }
        }, 1000);
      }

      stop() {
        clearInterval(this.interval);
        this.interval = null;
      }

      reset() {
        this.stop();
        this.currentRound = 1;
        this.phase = "work";
        this.timeLeft = this.work;
      }
    }

    // HIIT TIMER UI HOOK
    document.getElementById("hiitStart").addEventListener("click", () => {
      const work = parseInt(document.getElementById("hiitWork").value);
      const rest = parseInt(document.getElementById("hiitRest").value);
      const rounds = parseInt(document.getElementById("hiitRounds").value);

      const displayRound = document.getElementById("hiitRound");
      const displayTotal = document.getElementById("hiitRoundTotal");
      const displayPhase = document.getElementById("hiitPhase");
      const displayTime = document.getElementById("hiitTime");

      displayTotal.textContent = rounds;

      const hiit = new HIITTimer({
        work,
        rest,
        rounds,

        onTick: (timer) => {
          displayRound.textContent = timer.currentRound;
          displayPhase.textContent = timer.phase === "work" ? "Travail" : "Repos";
          displayTime.textContent = timer.timeLeft;

          // Soft beep near transition
          if ([3,2,1].includes(timer.timeLeft)) {
            new Audio("beep.mp3").play();
          }
        },

        onRoundChange: () => {
          new Audio("ding.mp3").play();
        },

        onFinish: () => {
          alert("HIIT terminé !");
        }
      });

      hiit.start();
    });
  </script>

</body>
</html>
