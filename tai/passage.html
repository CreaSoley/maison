<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tai-Jitsu – Entraînement</title>

  <!-- ======= STYLE KAWAII ======= -->
  <style>
    @font-face { font-family: "Spicy"; src: url("Spicy Sale.ttf"); }
    :root{
      --pink-1:#fff0f6;
      --pink-2:#ffd6ec;
      --accent:#ff5fc1;
      --card-shadow: 0 10px 24px rgba(255,120,180,0.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: linear-gradient(180deg,#fff6fb 0%, #ffeef6 100%);
      font-family: Arial, sans-serif;
      color:#222;
    }

    /* HEADER */
    header {
      background:#000;
      color:#fff;
      padding:24px 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      box-shadow:0 6px 18px rgba(0,0,0,0.25);
    }
    header img { height:86px; }
    header h1 {
      font-family:"Spicy";
      font-size:2.9rem;
      margin:0;
      color:var(--pink-2);
      letter-spacing:2px;
    }

    /* MAIN GRID:
       - desktop: 5 columns in one row (cards), resources banner spanning full width below
       - mobile: single column stacked
    */
    .main-wrapper{
      max-width:1300px;
      margin:20px auto;
      padding:0 18px 40px;
    }

    ./* ======= VERSION DESKTOP : les 5 encarts prennent toute la largeur ======= */
.cards-grid{
  display:grid;
  grid-template-columns: repeat(5, minmax(0, 1fr));
  gap:22px;
  align-items:start;
  width:100%;
}

/* ======= VERSION MOBILE : on garde les encarts empilés ======= */
@media(max-width:1060px){
  .cards-grid{
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  }
}

    /* resources banner will be below; set later */
    @media(max-width:1060px){
      .cards-grid { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    }

    /* CARD style */
    .card{
      background: linear-gradient(180deg,#fff9fb 0%, #fff4fb 100%);
      border-radius:20px;
      padding:20px;
      border:1px solid var(--pink-2);
      box-shadow: var(--card-shadow);
      transition: transform .16s, box-shadow .16s;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .card:hover{ transform: translateY(-6px); box-shadow: 0 18px 36px rgba(255,110,180,0.14); }

    .card-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-family:"Spicy";
      color:var(--accent);
      font-size:1.7rem;
    }
    .card-title img{ width:42px; }

    /* Increase vertical size & text size on desktop */
    @media(min-width:900px){
      .card{ min-height:520px; font-size:1.05rem; }
      .card p, .card li { font-size:1.02rem; line-height:1.45; }
    }

    /* HIIT section */
    #hiit-section{
      background:#111;
      color:#fff;
      padding:18px;
      border-radius:14px;
      box-shadow:0 8px 22px rgba(255,80,160,0.12);
    }
    #hiit-section h2{ font-family:"Spicy"; font-size:1.9rem; margin:0 0 12px; color:#ffd9ef; text-align:center; }
    .training-input{ width:70px; padding:6px; border-radius:8px; border:none; text-align:center; }
    .training-button{ padding:10px 18px; background:#ff80d4; border:none; color:#fff; border-radius:10px; cursor:pointer; font-weight:700; box-shadow:0 6px 16px rgba(255,100,170,0.12); }
    .training-button:hover{ background:#ff57c3; }

    /* cards internal scroll if content exceeds */
    .card .content { overflow:auto; }

    /* Resources banner: full width under grid */
    .resources-banner {
      margin-top:22px;
      background: linear-gradient(180deg,#fff6fb, #fff1f9);
      border-radius:14px;
      border:1px solid #ffd9ef;
      padding:14px 16px;
      box-shadow: 0 8px 20px rgba(255,120,180,0.06);
      display:flex;
      justify-content:center;
      align-items:center;
    }

    /* library banner: kimono buttons inline and scrollable */
    .library {
      display:flex;
      gap:14px;
      align-items:center;
      overflow-x:auto;
      padding:6px 4px;
      -webkit-overflow-scrolling:touch;
    }
    .kimono-btn {
      flex: 0 0 auto;
      width:64px;
      height:64px;
      background:url("kimono.png") center/contain no-repeat;
      border-radius:10px;
      cursor:pointer;
      transition:transform .12s;
    }
    .kimono-btn:hover { transform: scale(1.07) rotate(-6deg); }

    /* on desktop show resources as single lined centered
       Ensure no wrapping */
    @media(min-width:900px){
      .library { justify-content:flex-start; flex-wrap:nowrap; }
    }

    /* small helpers */
    hr { border:0; border-top:1px dashed rgba(255,100,170,0.12); margin:16px 0; }
    h3.spicy { font-family:"Spicy"; color:var(--accent); margin:8px 0; }

    /* Fallback for very small screens */
    @media(max-width:420px){
      header h1 { font-size:2rem; }
    }

    /* ensure embedded iframes / images fit and do not overflow */
    img, iframe { max-width:100%; height:auto; display:block; border-radius:8px; }

  </style>
</head>

<body>
  <header>
    <a class="logo" href="../index.html" title="Accueil">
      <img src="logo.png" alt="logo" class="logo-big">
    </a>
    <h1>Tai-Jitsu</h1>
  </header>

  <div class="main-wrapper">
    <!-- CARDS ROW -->
    <div class="cards-grid" id="cardsGrid">
      <!-- UV1 -->
      <div class="card" id="uv1">
        <div class="card-title"><img src="ceinture.png" alt="">UV1 – Kihon</div>
        <div id="kihon-techniques" class="content"></div>
        <hr>
        <button class="training-button" onclick="nouveauxEnchainements()">Nouveaux enchaînements</button>
        <div id="enchainements" style="margin-top:10px"></div>
        <hr>
        <div id="kihon-combat"></div>
      </div>

      <!-- UV2 -->
      <div class="card" id="uv2">
        <div class="card-title"><img src="ceinture.png" alt="">UV2 – Ippon Kumite</div>

        <section id="hiit-section">
          <h2>Entraînement HIIT</h2>

          <div class="hiit-config" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:10px;">
            <label style="color:#fff; text-align:center;">Travail<br><input type="number" id="hiitWork" value="20" class="training-input"></label>
            <label style="color:#fff; text-align:center;">Repos<br><input type="number" id="hiitRest" value="10" class="training-input"></label>
            <label style="color:#fff; text-align:center;">Rounds<br><input type="number" id="hiitRounds" value="8" class="training-input"></label>
          </div>

          <div style="text-align:center;">
            <button id="hiitStart" class="training-button">Démarrer HIIT</button>
          </div>

          <div id="hiitDisplay" style="text-align:center; margin-top:14px; font-size:1.15rem; color:#fff;">
            Round <span id="hiitRound">0</span>/<span id="hiitRoundTotal">0</span> — Phase : <span id="hiitPhase">-</span> — Temps : <span id="hiitTime">0</span>s
          </div>
        </section>

      </div>

      <!-- UV3 -->
      <div class="card" id="uv3">
        <div class="card-title"><img src="ceinture.png" alt="">UV3 – Kata</div>
        <ul>
          <li>kata choisi</li>
          <li>bunkaï 1 : oi tsuki – gyaku tsuki</li>
          <li>bunkaï 2 : saisie des deux poignets</li>
        </ul>
      </div>

      <!-- UV4 -->
      <div class="card" id="uv4">
        <div class="card-title"><img src="ceinture.png" alt="">UV4 – Technique de base</div>
        <ul>
          <li>Application par atemi</li>
          <li>Application par clé</li>
          <li>Application par projection</li>
        </ul>
      </div>

      <!-- UV5-6 -->
      <div class="card" id="uv56">
        <div class="card-title"><img src="ceinture.png" alt="">UV5–6 – Randori</div>
        <div id="randori" class="content"></div>
      </div>
    </div>

    <!-- RESOURCES BANNER (full width) -->
    <div class="resources-banner" id="resourcesBanner" role="navigation" aria-label="Ressources">
      <div class="library" id="library">
        <div class="kimono-btn" title="Livre 1" onclick="window.open('livre1.pdf')"></div>
        <div class="kimono-btn" title="Livre 2" onclick="window.open('livre2.pdf')"></div>
        <div class="kimono-btn" title="Livre 3" onclick="window.open('livre3.pdf')"></div>
        <div class="kimono-btn" title="Livre 4" onclick="window.open('livre4.pdf')"></div>
      </div>
    </div>
  </div>

  <!-- =============== SCRIPTS =============== -->
  <script>
  /* =================== UV1 – KIHON =================== */
  async function chargerKihon(){
    try {
      const r = await fetch('tjkihon.json');
      const data = await r.json();
      const tirage = data.sort(()=>0.5-Math.random()).slice(0,3);
      document.getElementById('kihon-techniques').innerHTML =
        '<h3 class="spicy">Techniques du jour</h3>' +
        tirage.map(t=>`<div>• ${t.nom}</div>`).join('');
    } catch(e) {
      console.error("Erreur chargerKihon:", e);
      document.getElementById('kihon-techniques').innerHTML = '<p>Impossible de charger les techniques.</p>';
    }
  }

  const ENCHAINEMENTS = [
    "Oi-zuki jodan → Gyaku-zuki chudan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
    "Mae-geri chudan → Gyaku-zuki chudan<br>• Zenkutsu-dachi → Mae-geri → Gyaku-zuki",
    "Uchi-uke → Gyaku-zuki chudan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
    "Soto-uke → Mae-geri → Gyaku-zuki<br>• Zenkutsu-dachi → Mae-geri → Gyaku-zuki",
    "Age-uke → Gyaku-zuki jodan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
    "Oi-zuki chudan → Ushiro-geri<br>• Avancée Zenkutsu → Kokutsu/Heiko → Ushiro-geri",
    "Gedan-barai → Oi-zuki chudan<br>• Zenkutsu-dachi → Zenkutsu-dachi",
    "Teisho-uchi jodan → Mae-geri chudan<br>• Zenkutsu → Mae-geri → Zenkutsu",
    "Shuto-uke → Shuto-uchi<br>• Kokutsu → Zenkutsu/Shiko",
    "Haito-uke → Gyaku-zuki chudan<br>• Zenkutsu → Zenkutsu",
    "Fumikomi → Gyaku-zuki<br>• Zenkutsu → Fumikomi → Gyaku-zuki",
    "Soto-uke → Mawashi-geri chudan<br>• Zenkutsu → Mawashi → Zenkutsu",
    "Uraken → Gyaku-zuki<br>• Zenkutsu → Zenkutsu",
    "Oi-zuki → Kote-uchi<br>• Zenkutsu → Heiko/Sanchin",
    "Shuto-uke → Hiza-geri<br>• Kokutsu → Heiko → Hiza-geri",
    "Mae-geri → Empi<br>• Zenkutsu → Mae-geri → Sanchin/Heiko → Empi",
    "Soto-uke → Teisho<br>• Zenkutsu → Zenkutsu",
    "Gedan-barai → Mawashi jambe avant<br>• Zenkutsu → Mawashi → Zenkutsu",
    "Uraken → Mae-geri → Gyaku-zuki<br>• Zenkutsu → Mae-geri → Gyaku-zuki",
    "Shuto-uke → Shuto-uchi → Teisho<br>• Kokutsu → Zenkutsu/Shiko → Teisho"
  ];

  function nouveauxEnchainements(){
    const e = [...ENCHAINEMENTS].sort(()=>0.5-Math.random()).slice(0,2);
    document.getElementById('enchainements').innerHTML = '<h3 class="spicy">Enchaînements</h3>' +
      e.map(x=>`<p>${x}</p>`).join('');
  }

  function kihonCombat(){
    const LISTE = [
      "Mae Geri arrière chudan",
      "Mawashi arrière jodan/chudan",
      "Mae Geri avant sursaut chudan",
      "Mawashi avant sursaut jodan/chudan",
      "Gyaku Zuki chudan",
      "Kizami Zuki + Gyaku Zuki",
      "Oï Zuki jodan retour arrière"
    ];
    const t = [...LISTE].sort(()=>0.5-Math.random()).slice(0,3);
    document.getElementById('kihon-combat').innerHTML = '<h3 class="spicy">Techniques combat</h3>' +
      t.map(x=>`<div>• ${x}</div>`).join('');
  }

  /* =================== UV5–6 – RANDORI =================== */
  async function chargerRandori(){
    try {
      const r = await fetch('randori.json');
      const data = await r.json();
      const saisies = data.techniques.filter(t=>t.type_attaque && t.type_attaque.toLowerCase().includes('saisie'));
      const frappes = data.techniques.filter(t=>t.type_attaque && t.type_attaque.toLowerCase().includes('frappe'));
      const etranglement = data.techniques.filter(t=>t.type_attaque && t.type_attaque.toLowerCase().includes('étranglement') || (t.type_attaque && t.type_attaque.toLowerCase().includes('etranglement')));
      const armesC = data.techniques.filter(t=>t.type_attaque && t.type_attaque.toLowerCase().includes('couteau'));
      const armesM = data.techniques.filter(t=>t.type_attaque && t.type_attaque.toLowerCase().includes('matraque'));

      const tir_s = saisies.sort(()=>0.5-Math.random()).slice(0,3);
      const tir_f = frappes.sort(()=>0.5-Math.random()).slice(0,2);
      const tir_t = etranglement.sort(()=>0.5-Math.random()).slice(0,1);
      const tir_c = armesC.sort(()=>0.5-Math.random()).slice(0,1);
      const tir_m = armesM.sort(()=>0.5-Math.random()).slice(0,1);

      const bloc = document.getElementById('randori');
      bloc.innerHTML = '<h3 class="spicy">Sélection du jour</h3>' +
        '<h4 class="spicy">Saisies</h4>' + tir_s.map(t=>`<div>• ${t.attaque}</div>`).join('') +
        '<h4 class="spicy">Couteau</h4>' + tir_c.map(t=>`<div>• ${t.attaque}</div>`).join('') +
        '<h4 class="spicy">Etranglement</h4>' + tir_t.map(t=>`<div>• ${t.attaque}</div>`).join('') +
        '<h4 class="spicy">Matraque</h4>' + tir_m.map(t=>`<div>• ${t.attaque}</div>`).join('') +
        '<h4 class="spicy">Frappes</h4>' + tir_f.map(t=>`<div>• ${t.attaque}</div>`).join('');
    } catch(e) {
      console.error("Erreur chargerRandori:", e);
      document.getElementById('randori').innerHTML = '<p>Impossible de charger le randori.</p>';
    }
  }

  /* =================== INITIAL LOADS =================== */
  chargerKihon();
  kihonCombat();
  chargerRandori();

  /* =================== HIIT with PREPARATION (OPTION A) =================== */

  // Small helper to play audio and swallow errors if file missing
  function playSound(src){
    try{
      const a = new Audio(src);
      a.play().catch(()=>{ /* ignore play rejected */ });
      return a;
    } catch(e){ console.warn("playSound err", e); return null; }
  }

  // HIIT controller: handles preparation + rounds
  class HIITController {
    constructor({work, rest, rounds, onUpdate, onFinish}){
      this.work = work;
      this.rest = rest;
      this.rounds = rounds;
      this.onUpdate = onUpdate;
      this.onFinish = onFinish;

      this.state = "idle"; // 'prep', 'work', 'rest', 'finished'
      this.currentRound = 0;
      this.timer = null;
      this.timeLeft = 0;
    }

    startPrep(prepSeconds = 10){
      this.clear();
      this.state = "prep";
      this.timeLeft = prepSeconds;
      this.currentRound = 0;
      this._tick(); // update immediate
      this.timer = setInterval(()=> this._tick(), 1000);
    }

    _tick(){
      // call update
      if (this.onUpdate) this.onUpdate(this.snapshot());
      // handle countdown
      if (this.timeLeft > 0){
        this.timeLeft--;
        return;
      }
      // timeLeft <= 0 => transition
      if (this.state === "prep"){
        // prep finished: beep + start first work
        playSound("beep.mp3");
        this.startWork();
      } else if (this.state === "work"){
        // work finished -> ding, start rest
        playSound("ding.mp3");
        this.startRest();
      } else if (this.state === "rest"){
        // rest finished -> if rounds remain start next work (beep), else finish
        if (this.currentRound < this.rounds){
          playSound("beep.mp3");
          this.startWork();
        } else {
          this.finish();
        }
      }
    }

    startWork(){
      this.state = "work";
      this.currentRound++;
      this.timeLeft = this.work;
      if (this.onUpdate) this.onUpdate(this.snapshot());
    }

    startRest(){
      this.state = "rest";
      this.timeLeft = this.rest;
      if (this.onUpdate) this.onUpdate(this.snapshot());
    }

    finish(){
      this.state = "finished";
      this.clear();
      if (this.onFinish) this.onFinish();
    }

    clear(){
      if (this.timer) { clearInterval(this.timer); this.timer = null; }
    }

    snapshot(){
      return {
        state: this.state,
        currentRound: this.currentRound,
        rounds: this.rounds,
        timeLeft: this.timeLeft
      };
    }
  }

  // UI hookup
  document.getElementById("hiitStart").addEventListener("click", () => {
    // try to unlock audio context with a tiny silent sound
    try { new Audio("silence.mp3").play().catch(()=>{}); } catch(e){}

    const work = Math.max(1, parseInt(document.getElementById("hiitWork").value)||20);
    const rest = Math.max(1, parseInt(document.getElementById("hiitRest").value)||10);
    const rounds = Math.max(1, parseInt(document.getElementById("hiitRounds").value)||8);

    const displayRound = document.getElementById("hiitRound");
    const displayTotal = document.getElementById("hiitRoundTotal");
    const displayPhase = document.getElementById("hiitPhase");
    const displayTime = document.getElementById("hiitTime");

    displayTotal.textContent = rounds;

    const controller = new HIITController({
      work, rest, rounds,
      onUpdate: (snap) => {
        // snap: {state, currentRound, rounds, timeLeft}
        displayRound.textContent = snap.currentRound;
        displayPhase.textContent = snap.state === "prep" ? "Préparation" : (snap.state === "work" ? "Travail" : (snap.state==="rest"?"Repos":"-"));
        displayTime.textContent = snap.timeLeft;
      },
      onFinish: () => {
        displayPhase.textContent = "Terminé";
        displayTime.textContent = 0;
        alert("HIIT terminé !");
      }
    });

    // Start preparation 10s visible (as requested)
    controller.startPrep(10);
  });

  </script>
</body>
</html>
