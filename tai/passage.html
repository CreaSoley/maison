<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tai-Jitsu – Entraînement</title>

  <!-- ======= STYLE KAWAII ======= -->
  <style>
    @font-face { font-family: "Spicy"; src: url("Spicy Sale.ttf"); }

    :root{
      --pink-1:#fff0f6;
      --pink-2:#ffd6ec;
      --accent:#ff5fc1;
      --card-shadow: 0 10px 24px rgba(255,120,180,0.12);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      background: linear-gradient(180deg,#fff6fb 0%, #ffeef6 100%);
      font-family: Arial, sans-serif;
      color:#222;
    }

    /* HEADER */
    header {
      background:#000;
      color:#fff;
      padding:24px 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      box-shadow:0 6px 18px rgba(0,0,0,0.25);
    }
    header img { height:86px; }
    header h1 {
      font-family:"Spicy";
      font-size:2.9rem;
      margin:0;
      color:var(--pink-2);
      letter-spacing:2px;
    }

    /* MAIN WRAPPER */
    .main-wrapper{
      max-width:1600px;
      margin:20px auto;
      padding:0 18px 40px;
    }

    /* ===== DESKTOP : 5 CARDS EN LIGNE ===== */
    .cards-grid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:22px;
      width:100%;
      align-items:stretch;
    }

    /* ===== MOBILE : STACK ===== */
    @media(max-width:1200px){
      .cards-grid{
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
    }

    /* ===== CARD STYLE ===== */
    .card{
      background: linear-gradient(180deg,#fff9fb 0%, #fff4fb 100%);
      border-radius:20px;
      padding:20px;
      border:1px solid var(--pink-2);
      box-shadow: var(--card-shadow);
      transition: transform .16s, box-shadow .16s;
      display:flex;
      flex-direction:column;
    }
    .card:hover{
      transform: translateY(-6px);
      box-shadow: 0 18px 36px rgba(255,110,180,0.14);
    }

    .card-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-family:"Spicy";
      color:var(--accent);
      font-size:1.7rem;
      margin-bottom:6px;
    }
    .card-title img{ width:42px; }

    /* INTERNAL SCROLL */
    .card .content{
      overflow-y:auto;
      max-height:350px;
      padding-right:4px;
    }

    /* HIIT SECTION */
    #hiit-section{
      background:#111;
      color:#fff;
      padding:18px;
      border-radius:14px;
      box-shadow:0 8px 22px rgba(255,80,160,0.12);
    }
    #hiit-section h2{
      font-family:"Spicy";
      font-size:1.9rem;
      text-align:center;
      margin:0 0 10px;
      color:#ffd9ef;
    }

    .training-input{
      width:70px;
      padding:6px;
      border-radius:8px;
      border:none;
      text-align:center;
    }

    .training-button{
      padding:10px 18px;
      background:#ff80d4;
      border:none;
      color:#fff;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      box-shadow:0 6px 16px rgba(255,100,170,0.12);
    }
    .training-button:hover{ background:#ff57c3; }

    /* RESOURCES BANNER */
    .resources-banner{
      margin-top:30px;
      padding:14px 16px;
      background: linear-gradient(180deg,#fff6fb,#fff1f9);
      border:1px solid #ffd9ef;
      border-radius:14px;
      box-shadow:0 8px 20px rgba(255,120,180,0.06);
      display:flex;
      justify-content:center;
      align-items:center;
    }

    /* KIMONO BOUTONS */
    .library{
      display:flex;
      align-items:center;
      gap:14px;
      overflow-x:auto;
      padding:6px 4px;
    }

    .kimono-btn{
      flex:0 0 auto;
      width:64px;
      height:64px;
      background:url("kimono.png") center/contain no-repeat;
      border-radius:12px;
      cursor:pointer;
      transition:transform .12s;
    }
    .kimono-btn:hover{
      transform:scale(1.08) rotate(-6deg);
    }

    hr{
      border:0;
      border-top:1px dashed rgba(255,100,170,0.18);
      margin:14px 0;
    }

    h3.spicy{
      font-family:"Spicy";
      color:var(--accent);
      margin:12px 0 6px;
      font-size:1.4rem;
}


  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header>
    <a class="logo" href="../index.html">
      <img src="logo.png" alt="logo">
    </a>
    <h1>Tai-Jitsu</h1>
  </header>


  <!-- ===== MAIN WRAPPER ===== -->
  <div class="main-wrapper">

    <!-- ===== CARDS GRID (5 COLONNES DESKTOP) ===== -->
    <div class="cards-grid">

      <!-- ========== UV1 ========== -->
      <div class="card" id="uv1">
        <div class="card-title">
          <img src="ceinture.png" alt=""> UV1 – Kihon
        </div>

        <!-- Techniques du jour -->
        <div id="kihon-techniques" class="content"></div>

        <hr>

        <button class="training-button" onclick="nouveauxEnchainements()">Nouveaux enchaînements</button>
        <div id="enchainements" style="margin-top:10px;"></div>

        <hr>

        <!-- Combat -->
        <div id="kihon-combat"></div>
      </div>


      <!-- ========== UV2 – HIIT ========== -->
      <div class="card" id="uv2">
        <div class="card-title">
          <img src="ceinture.png" alt=""> UV2 – Ippon Kumite
        </div>

        <section id="hiit-section">
          <h2>Entraînement HIIT</h2>

          <div class="hiit-config"
               style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:10px;">
            <label style="color:#fff; text-align:center;">
              Travail<br><input type="number" id="hiitWork" value="20" class="training-input">
            </label>
            <label style="color:#fff; text-align:center;">
              Repos<br><input type="number" id="hiitRest" value="10" class="training-input">
            </label>
            <label style="color:#fff; text-align:center;">
              Rounds<br><input type="number" id="hiitRounds" value="8" class="training-input">
            </label>
          </div>

          <div style="text-align:center;">
            <button id="hiitStart" class="training-button">Démarrer HIIT</button>
          </div>

          <div id="hiitDisplay"
               style="text-align:center; margin-top:14px; font-size:1.15rem; color:#fff;">
            Round <span id="hiitRound">0</span>/<span id="hiitRoundTotal">0</span> —
            Phase : <span id="hiitPhase">-</span> —
            Temps : <span id="hiitTime">0</span>s
          </div>
        </section>
      </div>


      <!-- ========== UV3 ========== -->
      <div class="card" id="uv3">
        <div class="card-title">
          <img src="ceinture.png" alt=""> UV3 – Kata
        </div>

        <ul>
          <li>Kata choisi</li>
          <li>Bunkaï 1 : oi tsuki – gyaku tsuki</li>
          <li>Bunkaï 2 : saisie des deux poignets</li>
        </ul>
      </div>


      <!-- ========== UV4 ========== -->
      <div class="card" id="uv4">
        <div class="card-title">
          <img src="ceinture.png" alt=""> UV4 – Technique de base
        </div>

        <ul>
          <li>Application par atemi</li>
          <li>Application par clé</li>
          <li>Application par projection</li>
        </ul>
      </div>


      <!-- ========== UV5–6 ========== -->
      <div class="card" id="uv56">
        <div class="card-title">
          <img src="ceinture.png" alt=""> UV5–6 – Randori
        </div>

        <div id="randori" class="content"></div>
      </div>

    </div> <!-- fin cards-grid -->


    <!-- ===== BANDEAU RESSOURCES ===== -->
    <div class="resources-banner">
      <div class="library">
        <div class="kimono-btn" title="Livre 1" onclick="window.open('livre1.pdf')"></div>
        <div class="kimono-btn" title="Livre 2" onclick="window.open('livre2.pdf')"></div>
        <div class="kimono-btn" title="Livre 3" onclick="window.open('livre3.pdf')"></div>
        <div class="kimono-btn" title="Livre 4" onclick="window.open('livre4.pdf')"></div>
      </div>
    </div>

  </div> <!-- fin main-wrapper -->
<script>
/* ============================================
   UV1 – KIHON
   ============================================ */
async function chargerKihon(){
  const zone = document.getElementById('kihon-techniques');
  try {
    const r = await fetch('tjkihon.json');
    const data = await r.json();

    const tirage = [...data].sort(()=>0.5 - Math.random()).slice(0,3);

    zone.innerHTML =
      '<h3 class="spicy">Techniques du jour</h3>' +
      tirage.map(t => `<div>• ${t.nom}</div>`).join('');
  }
  catch(e){
    console.error("Erreur cargarKihon:", e);
    zone.innerHTML = "<p>Erreur de chargement.</p>";
  }
}

const ENCHAINEMENTS = [
  "Oi-zuki jodan → Gyaku-zuki chudan<br>• Zenkutsu → Zenkutsu",
  "Mae-geri chudan → Gyaku-zuki<br>• Zenkutsu → Mae-geri → Gyaku-zuki",
  "Uchi-uke → Gyaku-zuki<br>• Zenkutsu → Zenkutsu",
  "Soto-uke → Mae-geri → Gyaku-zuki<br>• Zenkutsu",
  "Age-uke → Gyaku-zuki jodan<br>• Zenkutsu",
  "Oi-zuki chudan → Ushiro-geri<br>• Zenkutsu → Kokutsu",
  "Gedan-barai → Oi-zuki<br>• Zenkutsu",
  "Teisho-uchi → Mae-geri<br>• Zenkutsu → Mae-geri",
  "Shuto-uke → Shuto-uchi<br>• Kokutsu → Zenkutsu",
  "Haito-uke → Gyaku-zuki<br>• Zenkutsu",
  "Fumikomi → Gyaku-zuki<br>• Zenkutsu",
  "Soto-uke → Mawashi-geri<br>• Zenkutsu",
  "Uraken → Gyaku-zuki<br>• Zenkutsu",
  "Oi-zuki → Kote-uchi<br>• Zenkutsu → Heiko",
  "Shuto-uke → Hiza-geri<br>• Kokutsu",
  "Mae-geri → Empi<br>• Zenkutsu → Sanchin",
  "Soto-uke → Teisho<br>• Zenkutsu",
  "Gedan-barai → Mawashi avant<br>• Zenkutsu",
  "Uraken → Mae-geri → Gyaku-zuki<br>• Zenkutsu",
  "Shuto-uke → Shuto-uchi → Teisho<br>• Kokutsu → Zenkutsu"
];

function nouveauxEnchainements(){
  const tir = [...ENCHAINEMENTS].sort(()=>0.5-Math.random()).slice(0,2);
  document.getElementById('enchainements').innerHTML =
    '<h3 class="spicy">Enchaînements</h3>' +
    tir.map(x=>`<p>${x}</p>`).join('');
}

function kihonCombat(){
  const LISTE = [
    "Mae Geri arrière chudan",
    "Mawashi arrière jodan",
    "Mae Geri avant sursaut",
    "Mawashi avant sursaut",
    "Gyaku Zuki chudan",
    "Kizami → Gyaku",
    "Oi Zuki jodan"
  ];

  const tir = [...LISTE].sort(()=>0.5 - Math.random()).slice(0,3);
  document.getElementById('kihon-combat').innerHTML =
    '<h3 class="spicy">Techniques combat</h3>' +
    tir.map(x=>`<div>• ${x}</div>`).join('');
}


/* ============================================
   UV5–6 – RANDORI
   ============================================ */
async function chargerRandori(){
  const zone = document.getElementById('randori');
  try {
    const r = await fetch('randori.json');
    const data = await r.json();

    const get = f =>
      data.techniques.filter(t => t.type_attaque && t.type_attaque.toLowerCase().includes(f));

    const pack = {
      saisies : get("saisie").sort(() => 0.5-Math.random()).slice(0,3),
      couteau : get("couteau").sort(() => 0.5-Math.random()).slice(0,1),
      etranglement : get("étranglement").concat(get("etranglement")).sort(() => 0.5-Math.random()).slice(0,1),
      matraque : get("matraque").sort(() => 0.5-Math.random()).slice(0,1),
      frappes : get("frappe").sort(() => 0.5-Math.random()).slice(0,2)
    };

    zone.innerHTML =
      `<h3 class="spicy">Sélection du jour</h3>
       <h4 class="spicy">Saisies</h4>${pack.saisies.map(t=>`<div>• ${t.attaque}</div>`).join('')}
       <h4 class="spicy">Couteau</h4>${pack.couteau.map(t=>`<div>• ${t.attaque}</div>`).join('')}
       <h4 class="spicy">Étranglement</h4>${pack.etranglement.map(t=>`<div>• ${t.attaque}</div>`).join('')}
       <h4 class="spicy">Matraque</h4>${pack.matraque.map(t=>`<div>• ${t.attaque}</div>`).join('')}
       <h4 class="spicy">Frappes</h4>${pack.frappes.map(t=>`<div>• ${t.attaque}</div>`).join('')}`;
  }
  catch(e){
    console.error(e);
    zone.innerHTML="<p>Erreur de chargement du randori.</p>";
  }
}


/* ============================================
   HIIT TIMER – Option A (Préparation 10s + BEEP + DING)
   ============================================ */

/* Déverrouillage audio mobile */
function unlockAudio(){
  try { new Audio("silence.mp3").play().catch(()=>{}); }
  catch(e){}
}

function playSound(src){
  try{
    const a=new Audio(src);
    a.play().catch(()=>{});
  }catch(e){}
}

/* Contrôleur HIIT */
class HIITController {
  constructor(work, rest, rounds, onUpdate, onFinish){
    this.work = work;
    this.rest = rest;
    this.rounds = rounds;

    this.onUpdate = onUpdate;
    this.onFinish = onFinish;

    this.state = "idle";  // prep, work, rest, finished
    this.currentRound = 0;
    this.timeLeft = 0;
    this.timer = null;
  }

  startPrep(seconds=10){
    this.clear();
    this.state = "prep";
    this.timeLeft = seconds;
    this.currentRound = 0;
    this._update();

    this.timer = setInterval(()=> this._tick(), 1000);
  }

  _tick(){
    if (this.timeLeft > 0){
      this.timeLeft--;
      this._update();
      return;
    }

    /* transitions */
    if (this.state === "prep"){
      playSound("beep.mp3");
      this.startWork();
    }
    else if (this.state === "work"){
      playSound("ding.mp3");
      this.startRest();
    }
    else if (this.state === "rest"){
      if (this.currentRound < this.rounds){
        playSound("beep.mp3");
        this.startWork();
      } else {
        this.finish();
      }
    }
  }

  startWork(){
    this.state = "work";
    this.currentRound++;
    this.timeLeft = this.work;
    this._update();
  }

  startRest(){
    this.state = "rest";
    this.timeLeft = this.rest;
    this._update();
  }

  finish(){
    this.state = "finished";
    this.clear();
    this.onFinish && this.onFinish();
  }

  clear(){
    if (this.timer){
      clearInterval(this.timer);
      this.timer=null;
    }
  }

  _update(){
    this.onUpdate && this.onUpdate({
      state: this.state,
      currentRound: this.currentRound,
      rounds: this.rounds,
      timeLeft: this.timeLeft
    });
  }
}

/* Connexion UI → HIIT */
document.getElementById("hiitStart").addEventListener("click", ()=>{
  unlockAudio();

  const work = Math.max(1, parseInt(document.getElementById("hiitWork").value)||20);
  const rest = Math.max(1, parseInt(document.getElementById("hiitRest").value)||10);
  const rounds = Math.max(1, parseInt(document.getElementById("hiitRounds").value)||8);

  const R = document.getElementById("hiitRound");
  const RT = document.getElementById("hiitRoundTotal");
  const P = document.getElementById("hiitPhase");
  const T = document.getElementById("hiitTime");

  RT.textContent = rounds;

  const hiit = new HIITController(
    work, rest, rounds,
    snap => {
      R.textContent = snap.currentRound;
      P.textContent =
        snap.state==="prep" ? "Préparation" :
        snap.state==="work" ? "Travail" :
        snap.state==="rest" ? "Repos" : "-";
      T.textContent = snap.timeLeft;
    },
    () => {
      P.textContent = "Terminé";
      T.textContent = 0;
      alert("HIIT terminé !");
    }
  );

  hiit.startPrep(10);
});


/* ============================================
   CHARGEMENT INITIAL
   ============================================ */
chargerKihon();
kihonCombat();
chargerRandori();
</script>
</body>
</html>
