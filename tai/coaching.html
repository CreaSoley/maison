<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü•ã Coach Karat√© Kawaii</title>

<link rel="manifest" href="manifest.json">

<style>
:root {
  --grad1: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);
  --grad2: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
}

body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: var(--grad1);
  min-height: 100vh;
  animation: bgMove 8s infinite alternate;
}

@keyframes bgMove {
  from { filter: hue-rotate(0deg); }
  to { filter: hue-rotate(15deg); }
}

header {
  padding: 20px;
  text-align: center;
  background: var(--grad2);
  box-shadow: 0 4px 10px rgba(0,0,0,.2);
}

h1 { margin: 0; }

.container {
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

button {
  padding: 10px 18px;
  margin: 5px;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  font-size: 16px;
  box-shadow: 0 6px 12px rgba(0,0,0,.2);
  transition: transform .2s;
}
button:hover { transform: scale(1.05); }

.start { background: #84fab0; }
.pause { background: #ffd86f; }
.stop  { background: #ff8a8a; }

ul { list-style: none; padding: 0; }

li {
  background: white;
  margin: 10px 0;
  padding: 14px;
  border-radius: 18px;
  box-shadow: 0 6px 14px rgba(0,0,0,.15);
  display: flex;
  flex-direction: column;
  cursor: grab;
}

li.active { border: 3px solid #84fab0; }
li.done { opacity: .6; text-decoration: line-through; }

.row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.progress {
  height: 8px;
  border-radius: 10px;
  background: #eee;
  overflow: hidden;
  margin-top: 6px;
}

.progress div {
  height: 100%;
  width: 0%;
  background: var(--grad2);
  transition: width .5s;
}

.timeline {
  height: 14px;
  background: #eee;
  border-radius: 10px;
  overflow: hidden;
  margin: 15px 0;
}

.timeline div {
  height: 100%;
  width: 0%;
  background: var(--grad2);
}

.tracker {
  margin-top: 20px;
  padding: 15px;
  background: white;
  border-radius: 18px;
  box-shadow: 0 6px 12px rgba(0,0,0,.15);
}
</style>
</head>

<body>

<header>
  <h1>ü•ã Coach Karat√© Kawaii üå∏</h1>
  <p>Entra√Ænement guid√© & intelligent</p>
</header>

<div class="container">

<div>
  <button class="start" onclick="start()">‚ñ∂ Lancer / Reprendre</button>
  <button class="pause" onclick="pause()">‚è∏ Pause</button>
  <button class="stop" onclick="stop()">‚èπ Stop</button>
</div>

<h3>‚è± Progression globale</h3>
<div class="timeline"><div id="globalProgress"></div></div>

<h3>üìã Programme (glisser-d√©poser / cliquer pour reprendre)</h3>
<ul id="program"></ul>

<div class="tracker">
  <h3>üìä Historique hebdomadaire</h3>
  <div id="stats"></div>
</div>

<audio id="ding" src="ding.mp3"></audio>

</div>

<script>
const synth = window.speechSynthesis;
const ding = document.getElementById("ding");
const program = document.getElementById("program");
let timer, interval;
let currentIndex = 0;
let remaining = 0;

let exercises = [
  {label:"ü•ã UV1 Kihon simple",speech:"UV 1. Kihon simple",duration:15,progress:0,done:false},
  {label:"ü•ã Kihon encha√Ænement",speech:"Kihon encha√Ænement",duration:20,progress:0,done:false},
  {label:"üéØ Cibles",speech:"Cibles",duration:10,progress:0,done:false},
  {label:"üåÄ Ta√Ø Sabaki",speech:"Ta√Ø Sabaki",duration:10,progress:0,done:false},
  {label:"üê¢ Slow Ippon",speech:"Slow Ippon",duration:10,progress:0,done:false},
  {label:"‚ö° Ippon Kumite",speech:"Ippon Kumite",duration:10,progress:0,done:false},
  {label:"üßò Slow Kata",speech:"Slow Kata",duration:10,progress:0,done:false},
  {label:"ü•ã Kata Nidan",speech:"Kata Nidan",duration:10,progress:0,done:false},
  {label:"üîç Bunkai",speech:"Bunka√Ø",duration:5,progress:0,done:false},
  {label:"üë§ Shadow technique",speech:"Shadow technique",duration:10,progress:0,done:false},
  {label:"üî• Randori shadow",speech:"Randori shadow",duration:10,progress:0,done:false}
];

loadState();
render();
showStats();

function render(){
  program.innerHTML="";
  exercises.forEach((ex,i)=>{
    const li=document.createElement("li");
    li.draggable=true;
    if(ex.done) li.classList.add("done");
    li.innerHTML=`
      <div class="row">
        <span>${ex.label}</span>
        <input type="number" min="1" value="${ex.duration}" style="width:60px"> min
      </div>
      <div class="progress"><div style="width:${ex.progress}%"></div></div>
    `;
    li.onclick=()=>{currentIndex=i; saveState();};
    program.appendChild(li);
  });
  drag();
}

function speak(txt){
  const u=new SpeechSynthesisUtterance(txt);
  u.lang="fr-FR";
  synth.speak(u);
}

function start(){
  const next=exercises.findIndex(e=>!e.done);
  if(next!==-1) currentIndex=next;
  play();
}

function play(){
  if(currentIndex>=exercises.length){
    speak("Fin de l'entra√Ænement");
    saveStats();
    return;
  }

  const ex=exercises[currentIndex];
  const li=program.children[currentIndex];
  document.querySelectorAll("li").forEach(l=>l.classList.remove("active"));
  li.classList.add("active");

  speak(ex.speech);
  setTimeout(()=>ding.play(),2000);
  if(navigator.vibrate) navigator.vibrate(200);

  remaining=(ex.duration*60)-(ex.progress/100*ex.duration*60);

  interval=setInterval(()=>{
    remaining--;
    ex.progress=100-(remaining/(ex.duration*60))*100;
    li.querySelector(".progress div").style.width=ex.progress+"%";
    updateGlobal();
    saveState();
    if(remaining<=0){
      clearInterval(interval);
      ding.play();
      if(navigator.vibrate) navigator.vibrate([300,100,300]);
      speak("Fin de l'exercice");
      ex.done=true;
      currentIndex++;
      play();
    }
  },1000);
}

function pause(){
  clearInterval(interval);
  synth.cancel();
  saveState();
}

function stop(){
  clearInterval(interval);
  synth.cancel();
  currentIndex=0;
  saveState();
}

function updateGlobal(){
  const total=exercises.reduce((a,e)=>a+e.duration,0);
  const done=exercises.reduce((a,e)=>a+(e.progress/100*e.duration),0);
  document.getElementById("globalProgress").style.width=(done/total*100)+"%";
}

function drag(){
  let src;
  program.querySelectorAll("li").forEach(li=>{
    li.ondragstart=()=>src=li;
    li.ondragover=e=>e.preventDefault();
    li.ondrop=()=>{
      program.insertBefore(src,li);
      sync();
    };
  });
}

function sync(){
  const newEx=[];
  program.querySelectorAll("li").forEach((li,i)=>{
    newEx.push(exercises[i]);
  });
  exercises=newEx;
  saveState();
}

function saveState(){
  localStorage.setItem("state",JSON.stringify({exercises,currentIndex}));
}

function loadState(){
  const s=localStorage.getItem("state");
  if(s){
    const d=JSON.parse(s);
    exercises=d.exercises;
    currentIndex=d.currentIndex;
  }
}

function saveStats(){
  const d=new Date().toISOString().slice(0,10);
  const stats=JSON.parse(localStorage.getItem("stats")||"{}");
  stats[d]=(stats[d]||0)+1;
  localStorage.setItem("stats",JSON.stringify(stats));
  showStats();
}

function showStats(){
  const stats=JSON.parse(localStorage.getItem("stats")||"{}");
  let html="";
  Object.keys(stats).slice(-7).forEach(d=>{
    html+=`${d} : ${stats[d]} s√©ance(s)<br>`;
  });
  document.getElementById("stats").innerHTML=html||"Aucune donn√©e";
}
</script>

</body>
</html>
