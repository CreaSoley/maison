<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Entra√Ænement Karate</title>

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:10px}
h2{text-align:center}
.card{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px}
.btn{padding:6px 12px;border-radius:18px;border:2px solid #ff64c4;background:white;font-weight:bold}
.btn-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.sequence-item{padding:8px;border-radius:8px;margin-bottom:6px;background:#eee}
.sequence-item.active{background:#ffd6ec;font-weight:bold}
.sequence-item.done{text-decoration:line-through;opacity:.6}
progress{width:100%}

#fullscreen{
  display:none;
  position:fixed;
  inset:0;
  background:black;
  color:white;
  z-index:999;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:10px;
}
</style>
</head>

<body>

<h2>ü•ã Coaching Karate</h2>

<div class="card">
<h3>Banque</h3>
<div id="bank"></div>
</div>

<div class="card">
<h3>S√©lection</h3>
<div id="selection"></div>
<div class="btn-row">
<button class="btn" onclick="startTraining()">‚ñ∂Ô∏è D√©marrer</button>
<button class="btn" onclick="enterFullscreen()">üñ• Plein √©cran</button>
<button class="btn" onclick="editGoals()">üéØ Objectifs</button>
<button class="btn" onclick="showHistory()">üìú Historique</button>
</div>
</div>

<!-- FULLSCREEN -->
<div id="fullscreen">
<h2 id="fsTitle"></h2>
<div id="fsTimer"></div>
<progress id="fsProgress" value="0" max="100"></progress>
<div class="btn-row">
<button class="btn" onclick="pause()">‚è∏ Pause</button>
<button class="btn" onclick="resume()">‚ñ∂Ô∏è Reprendre</button>
<button class="btn" onclick="exitFullscreen()">‚¨ÖÔ∏è Quitter</button>
</div>
</div>

<script>
/* ========= DATA ========= */
const bankData=[
{uv:"UV1 ‚Äì Kihon",ex:["Kihon simple","Encha√Ænement kihon","Travail aux cibles"]},
{uv:"UV2 ‚Äì D√©placements",ex:["Ta√Ø sabaki","Slow ippon","Ippon kumite"]},
{uv:"UV3 ‚Äì Kata",ex:["Slow kata","Kata nidan","Bunka√Ø"]},
{uv:"UV4 ‚Äì Techniques",ex:["Shadow technique","Encha√Ænements libres"]},
{uv:"UV5-6 ‚Äì Randori",ex:["Randori shadow","Randori dirig√©"]}
];

/* ========= STATE ========= */
let selection=[];
let index=0;
let remaining=0;
let timer=null;
let paused=false;

let history=JSON.parse(localStorage.getItem("tj-history")||"[]");
let goals=JSON.parse(localStorage.getItem("tj-goals")||"{}");

/* ========= UI ========= */
function renderBank(){
const b=document.getElementById("bank");b.innerHTML="";
bankData.forEach(u=>{
const c=document.createElement("div");
c.innerHTML=`<strong>${u.uv}</strong><br>`;
u.ex.forEach(n=>{
const btn=document.createElement("button");
btn.className="btn";btn.textContent=n;
btn.onclick=()=>addExercise(n);
c.appendChild(btn);
});
b.appendChild(c);
});
}

function renderSelection(){
const s=document.getElementById("selection");s.innerHTML="";
selection.forEach((e,i)=>{
const d=document.createElement("div");
d.className="sequence-item"+(i===index?" active":"")+(e.done?" done":"");
d.innerHTML=`
${e.name}<br>
Dur√©e :
<input type="number" min="1" value="${e.duration}"
onchange="setDuration(${i},this.value)"> min
<button onclick="removeEx(${i})">‚ùå</button>
`;
s.appendChild(d);
});
}

function addExercise(name){
selection.push({name,duration:5,done:false});
renderSelection();
}

/* ========= TRAINING ========= */
function startTraining(){
if(!selection.length)return;
speechSynthesis.speak(new SpeechSynthesisUtterance("Commen√ßons l'entra√Ænement"));
index=0;
selection.forEach(e=>e.done=false);
history.push({date:new Date().toLocaleString(),exercises:[]});
run();
}

function run(){
if(index>=selection.length){
speechSynthesis.speak(new SpeechSynthesisUtterance("Fin de l'entra√Ænement, √† bient√¥t"));
localStorage.setItem("tj-history",JSON.stringify(history));
renderSelection();
return;
}
const ex=selection[index];
remaining=ex.duration*60;
paused=false;
updateFullscreen(ex.name);
tick();
renderSelection();
}

function tick(){
if(paused)return;
document.getElementById("fsTimer").textContent=Math.ceil(remaining/60)+" min";
document.getElementById("fsProgress").value=
100*(1-remaining/(selection[index].duration*60));
if(remaining<=0){
selection[index].done=true;
history.at(-1).exercises.push({
name:selection[index].name,
minutes:selection[index].duration
});
updateGoals(selection[index].name,selection[index].duration);
index++;
run();
return;
}
remaining--;
timer=setTimeout(tick,1000);
}

/* ========= CONTROLS ========= */
function pause(){paused=true;clearTimeout(timer);}
function resume(){if(!paused)return;paused=false;tick();}
function setDuration(i,v){selection[i].duration=Number(v);}
function removeEx(i){selection.splice(i,1);renderSelection();}

/* ========= FULLSCREEN ========= */
function enterFullscreen(){
document.getElementById("fullscreen").style.display="flex";
}
function exitFullscreen(){
document.getElementById("fullscreen").style.display="none";
}
function updateFullscreen(t){
document.getElementById("fsTitle").textContent=t;
}

/* ========= GOALS ========= */
function editGoals(){
selection.forEach(e=>{
const v=prompt("Objectif hebdo (min) pour "+e.name,goals[e.name]||30);
if(v)goals[e.name]=Number(v);
});
localStorage.setItem("tj-goals",JSON.stringify(goals));
}
function updateGoals(n,m){
if(!goals[n])goals[n]=30;
}

/* ========= HISTORY ========= */
function showHistory(){
let txt="";
history.forEach(s=>{
txt+=s.date+"\n";
s.exercises.forEach(e=>txt+=`- ${e.name}: ${e.minutes} min\n`);
txt+="\n";
});
alert(txt||"Aucun historique");
}

/* INIT */
renderBank();
renderSelection();
</script>

</body>
</html>
