<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Tai-Jitsu Coach ‚Äì Ceinture Noire</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:'Fredoka',Arial,sans-serif;background-image:linear-gradient(120deg,#84fab0 0%,#8fd3f4 100%);overflow-x:hidden}
.container{padding:12px}
.card{background:#fff;border-radius:18px;padding:14px;margin-bottom:14px;box-shadow:0 6px 12px rgba(0,0,0,.1)}
h1,h3{text-align:center}
button{border:none;border-radius:14px;padding:10px 14px;font-family:'Fredoka';cursor:pointer;margin:4px 0}
.btn-primary{background-image:linear-gradient(to right,#fa709a 0%,#fee140 100%);color:#fff}
.btn-secondary{background:#84fab0;color:#fff}
.btn-danger{background:#ff6b6b;color:#fff}
.accordion-header{display:flex;justify-content:space-between;font-weight:600;cursor:pointer}
.accordion-content{display:none;margin-top:10px}
.exercise{display:flex;align-items:center;justify-content:space-between;gap:6px;margin-bottom:6px}
.exercise.active{background:#fff3cd;border-radius:10px;padding:6px}
.exercise.done{text-decoration:line-through;opacity:.5}
.progress{width:100%;height:10px;background:#eee;border-radius:10px;overflow:hidden}
.progress-bar{height:100%;width:0;background-image:linear-gradient(to right,#fa709a 0%,#fee140 100%)}
input[type=range]{flex:1}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;padding:12px}
.modal-content{background:#fff;border-radius:18px;padding:14px;width:100%;max-height:90vh;overflow:auto}
.rating{display:flex;justify-content:space-between;font-size:12px}
</style>
</head>
<body>
<div class="container">
<h1>ü•ã Tai-Jitsu Coach</h1>

<div class="card">
<div class="accordion-header" onclick="toggleAccordion(this)">üéØ Objectifs <span>‚¨áÔ∏è</span></div>
<div class="accordion-content" id="objectifs"></div>
<button class="btn-secondary" onclick="editObjectives()">‚úèÔ∏è √âditer</button>
</div>

<div class="card">
<div class="accordion-header" onclick="toggleAccordion(this)">üìö Banque d'exercices <span>‚¨áÔ∏è</span></div>
<div class="accordion-content" id="bank"></div>
</div>

<div class="card">
<h3>üìù S√©ance</h3>
<div id="selection"></div>
<button class="btn-secondary" onclick="clearSelection()">Vider</button>
</div>

<div class="card">
<h3>‚è±Ô∏è S√©ance</h3>
<div class="progress"><div class="progress-bar" id="globalBar"></div></div>
<p id="timers">00:00 | 00:00</p>
<button class="btn-primary" onclick="startSession()">Commencer</button>
<button class="btn-secondary" id="pauseBtn" onclick="pauseResume()">Pause</button>
<button class="btn-danger" onclick="stopSession()">Stop</button>
</div>
</div>

<div class="modal" id="evalModal">
<div class="modal-content">
<h3>üìù Auto-√©valuation</h3>
<textarea id="notes" placeholder="Carnet de notes..."></textarea>
<div id="evaluation"></div>
<button class="btn-primary" onclick="saveEvaluation()">Valider</button>
</div>
</div>

<script>
const ding=new Audio('ding.mp3');
const beep=new Audio('beep.mp3');

const EXERCISES=[
{name:'UV1 : Kihon simples',criteria:['pr√©cision','kime','posture']},
{name:'UV1 : Encha√Ænements',criteria:['pr√©cision','kime','posture']},
{name:'UV1 : Cibles',criteria:['pr√©cision','kime','posture']},
{name:'UV2 : Ta√Ø sabaki',criteria:['fluidit√©','distance','contr√¥le']},
{name:'UV2 : Ippon kumite lent',criteria:['fluidit√©','distance','contr√¥le']},
{name:'UV2 : Ippon kumite examen',criteria:['fluidit√©','distance','contr√¥le']},
{name:'UV3 : Kata lent',criteria:['exactitude','kime','√©quilibre']},
{name:'UV3 : Kata examen',criteria:['exactitude','kime','√©quilibre']},
{name:'UV3 : Bunka√Ø',criteria:['exactitude','kime','√©quilibre']},
{name:'UV4 : Technique de base',criteria:['r√©alisme','zanchin','protection']},
{name:'UV5-6 : Self-defense arme',criteria:['r√©alisme','zanchin','protection']},
{name:'UV5-6 : Self-defense atemi',criteria:['r√©alisme','zanchin','protection']},
{name:'UV5-6 : Self-defense saisie',criteria:['r√©alisme','zanchin','protection']}
];

let selection=[];
let current=0,timer=null,paused=false;
let remainingEx=0,remainingTotal=0;

function toggleAccordion(h){const c=h.nextElementSibling;const s=h.querySelector('span');const o=c.style.display==='block';c.style.display=o?'none':'block';s.textContent=o?'‚¨áÔ∏è':'‚¨ÜÔ∏è'}

function renderBank(){const b=document.getElementById('bank');b.innerHTML='';EXERCISES.forEach(e=>{b.innerHTML+=`<div class='exercise'><span>${e.name}</span><button onclick="addExercise('${e.name}')">‚ûï</button></div>`})}
function addExercise(name){selection.push({name,duration:10});renderSelection()}
function renderSelection(){const s=document.getElementById('selection');s.innerHTML='';selection.forEach((e,i)=>{s.innerHTML+=`<div class='exercise'><span>${e.name}</span><input type='range' min='1' max='60' value='${e.duration}' oninput='updateDuration(${i},this.value)'><span>${e.duration} min</span></div>`})}
function updateDuration(i,v){selection[i].duration=parseInt(v);renderSelection()}
function clearSelection(){selection=[];renderSelection()}

function startSession(){if(!selection.length)return;paused=false;document.getElementById('pauseBtn').textContent='Pause';remainingTotal=selection.reduce((a,b)=>a+b.duration*60,0);speak('Commen√ßons l\'entra√Ænement');setTimeout(()=>runExercise(0),2000)}

function runExercise(i){if(i>=selection.length){endSession(true);return}current=i;remainingEx=selection[i].duration*60;renderActive();announceExercise(i);timer=setInterval(tick,1000)}

function announceExercise(i){const label=i===0?'premier':(i+1)+'√®me';speak(`${label} exercice, ${selection[i].name}`)}

function tick(){if(paused)return;remainingEx--;remainingTotal--;updateTimers();updateProgress();if(remainingEx===10)speak('10 secondes');if(remainingEx<=0){clearInterval(timer);if(current<selection.length-1)ding.play();else beep.play();setTimeout(()=>runExercise(current+1),1500)}}

function pauseResume(){paused=!paused;document.getElementById('pauseBtn').textContent=paused?'Reprendre':'Pause'}
function stopSession(){clearInterval(timer);endSession(false)}

function updateTimers(){document.getElementById('timers').textContent=format(remainingEx)+' | '+format(remainingTotal)}
function updateProgress(){const total=selection.reduce((a,b)=>a+b.duration*60,0);document.getElementById('globalBar').style.width=((total-remainingTotal)/total*100)+'%'}
function format(s){const m=Math.floor(s/60).toString().padStart(2,'0');const r=(s%60).toString().padStart(2,'0');return m+':'+r}
function renderActive(){document.querySelectorAll('.exercise').forEach((e,i)=>{e.classList.toggle('active',i===current);e.classList.toggle('done',i<current)})}

function speak(t){speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t);u.lang='fr-FR';speechSynthesis.speak(u)}

function endSession(normal){clearInterval(timer);setTimeout(()=>{speak("Fin de l'entra√Ænement, place √† l'auto-√©valuation");openEval()},normal?4000:0)}

function openEval(){const e=document.getElementById('evaluation');e.innerHTML='';selection.forEach(ex=>{const def=EXERCISES.find(d=>d.name===ex.name);let html=`<h4>${ex.name}</h4>`;def.criteria.forEach(c=>{html+=`<div class='rating'><span>${c}</span>`;for(let i=0;i<=5;i++)html+=`<label><input type='radio' name='${ex.name}-${c}' value='${i}'>${i}</label>`;html+='</div>'});e.innerHTML+=html});document.getElementById('evalModal').style.display='flex'}

function saveEvaluation(){document.getElementById('evalModal').style.display='none'}

renderBank();renderSelection();
</script>
</body>
</html>
