<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Coaching Karate</title>

<style>
body{font-family:Arial;background:#f7f7f7;margin:0;padding:10px}
h2{text-align:center}
.card{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px}
.btn{padding:8px 14px;border-radius:20px;border:2px solid #ff64c4;background:white;font-weight:bold}
.btn-row{display:flex;flex-wrap:wrap;gap:8px}
.sequence-item{padding:8px;border-radius:8px;margin-bottom:6px;background:#eee}
.sequence-item.active{background:#ffe3f4;font-weight:bold}
.sequence-item.done{text-decoration:line-through;opacity:.6}
progress{width:100%}
#fullscreen{display:none;position:fixed;inset:0;background:black;color:white;z-index:999;align-items:center;justify-content:center;flex-direction:column}
#modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999;align-items:center;justify-content:center}
#modalContent{background:white;width:90%;max-height:80%;overflow:auto;padding:15px;border-radius:12px}
textarea{width:100%;min-height:80px}
</style>
</head>

<body>

<h2>ü•ã Coaching Karate</h2>

<div class="card">
<h3>Banque d‚Äôexercices</h3>
<div id="bank"></div>
</div>

<div class="card">
<h3>S√©lection</h3>
<div id="selection"></div>
<button class="btn" onclick="startTraining()">‚ñ∂Ô∏è D√©marrer</button>
</div>

<div class="card">
<h3>üéØ Objectifs hebdomadaires</h3>
<div id="goals"></div>
</div>

<div class="card">
<h3>üìù Notes</h3>
<textarea id="notes"></textarea>
<button class="btn" onclick="saveNotes()">üíæ Sauvegarder notes</button>
</div>

<div class="card">
<button class="btn" onclick="showHistory()">üìú Historique</button>
</div>

<!-- FULLSCREEN -->
<div id="fullscreen">
<h2 id="fsTitle"></h2>
<div id="fsTimer"></div>
<progress id="fsProgress" value="0" max="100"></progress>
<div class="btn-row">
<button class="btn" onclick="pauseTraining()">‚è∏Ô∏è Pause</button>
<button class="btn" onclick="resumeTraining()">‚ñ∂Ô∏è Reprendre</button>
<button class="btn" onclick="stopTraining()">‚èπÔ∏è Stop</button>
</div>
</div>

<!-- MODAL -->
<div id="modal">
<div id="modalContent">
<h3>Historique</h3>
<div id="historyList"></div>
<button class="btn" onclick="closeModal()">Fermer</button>
</div>
</div>

<script>
/* ================= DATA ================= */
const bankData = [
{uv:"ü•ã UV1 ‚Äì Kihon",exercises:["Kihon simple","Encha√Ænement kihon","Travail aux cibles"]},
{uv:"üåÄ UV2 ‚Äì D√©placements",exercises:["Ta√Ø sabaki","Slow ippon","Ippon kumite"]},
{uv:"üìê UV3 ‚Äì Kata",exercises:["Slow kata","Kata nidan","Bunka√Ø"]},
{uv:"‚öôÔ∏è UV4 ‚Äì Techniques",exercises:["Shadow technique","Encha√Ænements libres"]},
{uv:"üî• UV5-6 ‚Äì Randori",exercises:["Randori shadow","Randori dirig√©"]}
];

/* ================= STATE ================= */
let selection=[];
let currentIndex=0;
let timer=null;
let remaining=0;
let paused=false;
let currentSession=null;

let sessions=JSON.parse(localStorage.getItem("tj-sessions")||"{}");
let goals=JSON.parse(localStorage.getItem("tj-goals")||"{}");

/* ================= UI ================= */
function renderBank(){
const b=document.getElementById("bank");b.innerHTML="";
bankData.forEach(u=>{
const c=document.createElement("div");c.className="card";
c.innerHTML=`<strong>${u.uv}</strong><br>`;
u.exercises.forEach(n=>{
const btn=document.createElement("button");
btn.className="btn";btn.textContent=n;
btn.onclick=()=>{selection.push({name:n,duration:60});renderSelection();renderGoals();};
c.appendChild(btn);
});
b.appendChild(c);
});
}

function renderSelection(){
const s=document.getElementById("selection");s.innerHTML="";
selection.forEach((e,i)=>{
const d=document.createElement("div");
d.className="sequence-item"+(i===currentIndex?" active":"")+(e.done?" done":"");
d.innerHTML=`${e.name}
<button onclick="moveUp(${i})">‚¨ÜÔ∏è</button>
<button onclick="moveDown(${i})">‚¨áÔ∏è</button>`;
s.appendChild(d);
});
}

function renderGoals(){
const g=document.getElementById("goals");g.innerHTML="";
selection.forEach(e=>{
if(!goals[e.name])goals[e.name]=30;
const done=getWeeklyProgress(e.name);
const pct=Math.min(100,Math.round(done/goals[e.name]*100));
g.innerHTML+=`
<div><strong>${e.name}</strong><br>
Objectif <input type="number" value="${goals[e.name]}" onchange="setGoal('${e.name}',this.value)"> min
<progress value="${pct}" max="100"></progress> ${pct}%
</div>`;
});
localStorage.setItem("tj-goals",JSON.stringify(goals));
}

/* ================= TRAINING ================= */
function startTraining(){
if(!selection.length)return;
speechSynthesis.speak(new SpeechSynthesisUtterance("Commen√ßons l'entra√Ænement"));
currentIndex=0;
currentSession={
date:new Date().toLocaleString(),
exercises:[],
notes:document.getElementById("notes").value
};
runExercise();
}

function runExercise(){
if(currentIndex>=selection.length){
speechSynthesis.speak(new SpeechSynthesisUtterance("Fin de l'exercice"));
sessions["S√©ance "+Date.now()]=currentSession;
localStorage.setItem("tj-sessions",JSON.stringify(sessions));
exitFullscreen();
renderGoals();
return;
}
const ex=selection[currentIndex];
remaining=ex.duration;
paused=false;
enterFullscreen(ex.name);
tick();
}

function tick(){
if(paused)return;
document.getElementById("fsTimer").textContent=remaining+" s";
document.getElementById("fsProgress").value=
100*(1-remaining/selection[currentIndex].duration);
if(remaining<=0){
selection[currentIndex].done=true;
currentSession.exercises.push({name:selection[currentIndex].name,doneMinutes:selection[currentIndex].duration/60});
currentIndex++;
renderSelection();
runExercise();
return;
}
remaining--;
timer=setTimeout(tick,1000);
}

/* ================= CONTROLS ================= */
function pauseTraining(){paused=true;clearTimeout(timer);}
function resumeTraining(){if(!paused)return;paused=false;tick();}
function stopTraining(){clearTimeout(timer);exitFullscreen();}

function moveUp(i){if(i>0){[selection[i-1],selection[i]]=[selection[i],selection[i-1]];renderSelection();}}
function moveDown(i){if(i<selection.length-1){[selection[i+1],selection[i]]=[selection[i],selection[i+1]];renderSelection();}}

/* ================= FULLSCREEN ================= */
function enterFullscreen(title){
const f=document.getElementById("fullscreen");
document.getElementById("fsTitle").textContent=title;
f.style.display="flex";
}
function exitFullscreen(){
document.getElementById("fullscreen").style.display="none";
}

/* ================= HISTORY ================= */
function showHistory(){
const h=document.getElementById("historyList");h.innerHTML="";
Object.values(sessions).forEach(s=>{
const d=document.createElement("div");
d.innerHTML=`<strong>${s.date}</strong><br>
${s.exercises.map(e=>`${e.name}: ${e.doneMinutes||0} min`).join("<br>")}
<br><em>${s.notes||""}</em><hr>`;
h.appendChild(d);
});
document.getElementById("modal").style.display="flex";
}
function closeModal(){document.getElementById("modal").style.display="none";}

/* ================= UTILS ================= */
function saveNotes(){
if(!currentSession)return alert("Aucune s√©ance");
currentSession.notes=document.getElementById("notes").value;
alert("Notes sauvegard√©es");
}
function setGoal(n,v){goals[n]=Number(v);localStorage.setItem("tj-goals",JSON.stringify(goals));}
function getWeeklyProgress(n){
let t=0,now=new Date();
Object.values(sessions).forEach(s=>{
const d=new Date(s.date);
if((now-d)/(1000*60*60*24)<=7){
s.exercises.forEach(e=>{if(e.name===n)t+=e.doneMinutes||0});
}});
return t;
}

/* INIT */
renderBank();
renderSelection();
renderGoals();
</script>

</body>
</html>
