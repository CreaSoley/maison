<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü•ã Coach Karat√©</title>

<link rel="manifest" href="manifest.json">

<style>
:root {
  --grad1: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);
  --grad2: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
}

body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: var(--grad1);
  min-height: 100vh;
}

header {
  padding: 20px;
  text-align: center;
  background: var(--grad2);
  box-shadow: 0 4px 10px rgba(0,0,0,.2);
}

h1 { margin: 0; }

.container {
  padding: 20px;
  max-width: 900px;
  margin: auto;
}

button {
  padding: 10px 16px;
  margin: 5px;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-size: 16px;
  box-shadow: 0 4px 8px rgba(0,0,0,.2);
}

.start { background: #84fab0; }
.pause { background: #ffd86f; }
.stop  { background: #ff8a8a; }

ul {
  list-style: none;
  padding: 0;
}

li {
  background: white;
  margin: 8px 0;
  padding: 12px;
  border-radius: 16px;
  box-shadow: 0 6px 12px rgba(0,0,0,.15);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

li.active {
  border: 3px solid #84fab0;
  background: #f0fff7;
}

.duration {
  width: 70px;
}

.tracker {
  margin-top: 20px;
  padding: 15px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 6px 12px rgba(0,0,0,.15);
}
</style>
</head>

<body>

<header>
  <h1>ü•ã Coach Karat√© Kawaii</h1>
  <p>Entra√Ænement guid√© avec synth√®se vocale</p>
</header>

<div class="container">

<div>
  <button class="start" onclick="start()">‚ñ∂ Lancer</button>
  <button class="pause" onclick="pause()">‚è∏ Pause</button>
  <button class="stop" onclick="stop()">‚èπ Stop</button>
</div>

<h2>üìã Programme (glisser-d√©poser)</h2>
<ul id="program"></ul>

<div class="tracker">
  <h3>üìä Suivi</h3>
  <p id="stats"></p>
</div>

<audio id="ding" src="ding.mp3"></audio>

</div>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}

const synth = window.speechSynthesis;
const ding = document.getElementById("ding");

let currentIndex = 0;
let timer = null;
let paused = false;

const exercises = [
  { name: "ü•ã UV 1 ‚Äì Kihon simple", duration: 15 },
  { name: "ü•ã Kihon encha√Ænement", duration: 20 },
  { name: "üéØ Cibles", duration: 10 },
  { name: "üåÄ Ta√Ø Sabaki", duration: 10 },
  { name: "üê¢ Slow Ippon", duration: 10 },
  { name: "‚ö° Ippon Kumite", duration: 10 },
  { name: "üßò Slow Kata", duration: 10 },
  { name: "ü•ã Kata Nidan", duration: 10 },
  { name: "üîç Bunkai", duration: 5 },
  { name: "üë§ Shadow technique", duration: 10 },
  { name: "üî• Randori Shadow", duration: 10 }
];

const program = document.getElementById("program");

function render() {
  program.innerHTML = "";
  exercises.forEach((ex, i) => {
    const li = document.createElement("li");
    li.draggable = true;
    li.dataset.index = i;
    li.innerHTML = `
      <span>${ex.name}</span>
      <input class="duration" type="number" min="1" value="${ex.duration}"> min
    `;
    program.appendChild(li);
  });
  dragAndDrop();
}
render();

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "fr-FR";
  synth.speak(u);
}

function playExercise() {
  if (currentIndex >= exercises.length) {
    speak("Fin de l'entra√Ænement");
    saveStats();
    return;
  }

  document.querySelectorAll("li").forEach(li => li.classList.remove("active"));
  const li = program.children[currentIndex];
  li.classList.add("active");

  const durationInput = li.querySelector("input");
  exercises[currentIndex].duration = durationInput.value;

  speak(exercises[currentIndex].name);
  setTimeout(() => ding.play(), 2000);

  timer = setTimeout(() => {
    ding.play();
    speak("Fin de l'exercice");
    currentIndex++;
    playExercise();
  }, exercises[currentIndex].duration * 60 * 1000);
}

function start() {
  paused = false;
  speak("Commen√ßons l'entra√Ænement");
  setTimeout(playExercise, 2000);
}

function pause() {
  paused = true;
  clearTimeout(timer);
  synth.cancel();
}

function stop() {
  clearTimeout(timer);
  synth.cancel();
  currentIndex = 0;
  document.querySelectorAll("li").forEach(li => li.classList.remove("active"));
}

function saveStats() {
  const today = new Date().toISOString().slice(0,10);
  const stats = JSON.parse(localStorage.getItem("stats") || "{}");
  stats[today] = (stats[today] || 0) + 1;
  localStorage.setItem("stats", JSON.stringify(stats));
  showStats();
}

function showStats() {
  const stats = JSON.parse(localStorage.getItem("stats") || "{}");
  let html = "";
  for (let d in stats) {
    html += `${d} : ${stats[d]} entra√Ænement(s)<br>`;
  }
  document.getElementById("stats").innerHTML = html || "Aucun entra√Ænement enregistr√©";
}
showStats();

function dragAndDrop() {
  let dragSrc;
  program.querySelectorAll("li").forEach(li => {
    li.addEventListener("dragstart", e => dragSrc = li);
    li.addEventListener("dragover", e => e.preventDefault());
    li.addEventListener("drop", e => {
      program.insertBefore(dragSrc, li);
    });
  });
}
</script>

</body>
</html>
