<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coach Tai Jitsu â€“ 2e Dan</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      margin: 0;
      min-height: 100vh;
      background-image: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);
    }
    h1 {
      text-align: center;
      padding: 1rem;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 1rem;
    }
    .uv {
      background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
      border-radius: 20px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    .uv h2 {
      display: flex;
      align-items: center;
      gap: .5rem;
    }
    .exercise {
      background: #fff;
      border-radius: 15px;
      padding: .75rem;
      margin: .5rem 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 10px rgba(0,0,0,.1);
    }
    .exercise.dragging { opacity: .5; }
    .controls button {
      border: none;
      border-radius: 50px;
      padding: .6rem 1.2rem;
      margin: .2rem;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,.2);
    }
    .controls button.active {
      background: #84fab0;
      color: #000;
    }
    .status {
      background: #fff;
      border-radius: 20px;
      padding: 1rem;
      margin-top: 1rem;
      box-shadow: 0 6px 12px rgba(0,0,0,.15);
    }
    .highlight {
      background: #ffe0f0 !important;
    }
    textarea {
      width: 100%;
      border-radius: 15px;
      padding: .75rem;
      border: none;
      box-shadow: inset 0 2px 6px rgba(0,0,0,.15);
    }
  </style>
</head>
<body>
<h1>ğŸ¥‹ Coach Tai Jitsu â€“ Passage 2e Dan</h1>
<div class="container" id="app"></div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
const synth = window.speechSynthesis;

const data = JSON.parse(localStorage.getItem('tj-exercises')) || [
  { uv: 'ğŸ¥‹ UV 1 â€“ Kihon', items: [
    { name: 'Kihon simple', duration: 15 },
    { name: 'EnchaÃ®nement de kihon', duration: 20 },
    { name: 'Cibles', duration: 10 }
  ]},
  { uv: 'ğŸŒ€ UV 2 â€“ DÃ©placements', items: [
    { name: 'TaÃ¯ sabaki', duration: 10 },
    { name: 'Slow ippon', duration: 10 },
    { name: 'Ippon kumite', duration: 10 }
  ]},
  { uv: 'ğŸ“ UV 3 â€“ Kata', items: [
    { name: 'Slow kata', duration: 10 },
    { name: 'Kata nidan', duration: 10 },
    { name: 'BunkaÃ¯', duration: 5 }
  ]},
  { uv: 'âš™ï¸ UV 4 â€“ Technique de base', items: [
    { name: 'Shadow', duration: 10 }
  ]},
  { uv: 'ğŸ”¥ UV 5 & 6 â€“ Randori', items: [
    { name: 'Shadow randori', duration: 10 }
  ]}
];

let sequence = [];
let currentIndex = 0;
let timer = null;
let remaining = 0;

function render() {
  const app = document.getElementById('app');
  app.innerHTML = '';
  data.forEach((uv, uvi) => {
    const block = document.createElement('div');
    block.className = 'uv';
    block.innerHTML = `<h2>${uv.uv}</h2>`;

    uv.items.forEach((ex, exi) => {
      const div = document.createElement('div');
      div.className = 'exercise';
      div.draggable = true;
      div.dataset.uv = uvi;
      div.dataset.index = exi;

      div.innerHTML = `
        <span>â˜° ${ex.name}</span>
        <input type="range" min="1" max="60" value="${ex.duration}" 
          oninput="this.nextElementSibling.textContent=this.value+' min'; data[${uvi}].items[${exi}].duration=this.value; save();" />
        <span>${ex.duration} min</span>`;

      div.addEventListener('dragstart', dragStart);
      div.addEventListener('dragover', dragOver);
      div.addEventListener('drop', drop);
      div.addEventListener('dragend', dragEnd);

      block.appendChild(div);
    });

    app.appendChild(block);
  });

  const controls = document.createElement('div');
  controls.className = 'controls';
  controls.innerHTML = `
    <button onclick="start()">â–¶ï¸ Lecture</button>
    <button onclick="pause()">â¸ Pause</button>
    <button onclick="stop()">â¹ Stop</button>
    <button onclick="save()">ğŸ’¾ Enregistrer l'ordre</button>
    <button onclick="exportCSV()">ğŸ“¤ Export CSV</button>`;
  app.appendChild(controls);

  const status = document.createElement('div');
  status.className = 'status';
  status.innerHTML = `
    <h3>ğŸ“ Suivi de sÃ©ance</h3>
    <div id="current"></div>
    <h4>ğŸ“ Carnet de notes</h4>
    <textarea rows="4" placeholder="Ressenti du jour..." onblur="saveNote(this.value)">${localStorage.getItem('tj-note')||''}</textarea>
    <h4>â­ Ã‰valuation</h4>
    Kime ğŸ’¥ <input type="range" min="1" max="5" />
    Zanshin ğŸ‘€ <input type="range" min="1" max="5" />
    RÃ©activitÃ© âš¡ <input type="range" min="1" max="5" />
  `;
  app.appendChild(status);
}

let dragged = null;

function dragStart(e) {
  dragged = e.currentTarget;
  dragged.classList.add('dragging');
}

function dragOver(e) {
  e.preventDefault();
}

function drop(e) {
  e.preventDefault();
  if (!dragged || dragged === e.currentTarget) return;

  const fromUV = dragged.dataset.uv;
  const fromIndex = dragged.dataset.index;
  const toUV = e.currentTarget.dataset.uv;
  const toIndex = e.currentTarget.dataset.index;

  const moved = data[fromUV].items.splice(fromIndex, 1)[0];
  data[toUV].items.splice(toIndex, 0, moved);

  save();
  render();
}

function dragEnd() {
  if (dragged) dragged.classList.remove('dragging');
  dragged = null;
}

render();
</script>
</body>
</html>
