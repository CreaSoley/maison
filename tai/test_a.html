<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Coach Tai Jitsu â€“ 2e Dan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: system-ui;
  background: linear-gradient(to right, #ffecd2, #fcb69f);
  margin: 0;
}
h1 { text-align:center; }
.container { max-width:900px; margin:auto; padding:1rem; }

.exercise {
  background:white;
  margin:.5rem 0;
  padding:.7rem;
  border-radius:15px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:grab;
}
.exercise.dragging { opacity:.4; }

.controls button {
  padding:.6rem 1.2rem;
  margin:.2rem;
  border:none;
  border-radius:20px;
}
.status {
  background:white;
  border-radius:20px;
  padding:1rem;
  margin-top:1rem;
}
</style>
</head>

<body>
<h1>ğŸ¥‹ Coach Tai Jitsu â€“ 2e Dan</h1>
<div class="container">

<h3>ğŸ“‹ SÃ©quence d'entraÃ®nement</h3>
<div id="list"></div>

<h4>ğŸ’¾ Sauvegarde</h4>
<input id="seqName" placeholder="Nom de la sÃ©ance">
<button onclick="saveSequence()">Enregistrer</button>

<h4>ğŸ“‚ Charger</h4>
<select id="loadSelect" onchange="loadSequence()"></select>

<div class="controls">
  <button onclick="start()">â–¶ï¸</button>
  <button onclick="pause()">â¸</button>
  <button onclick="stop()">â¹</button>
</div>

<div class="status">
  <div id="current">En attenteâ€¦</div>
</div>

</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
/* ================= DATA ================= */

let sequence = JSON.parse(localStorage.getItem('current-sequence')) || [
  { uv:'UV1', name:'Kihon simple', duration:15 },
  { uv:'UV1', name:'EnchaÃ®nement kihon', duration:20 },
  { uv:'UV1', name:'Cibles', duration:10 },
  { uv:'UV2', name:'Tai sabaki', duration:10 },
  { uv:'UV2', name:'Slow ippon', duration:10 },
  { uv:'UV2', name:'Ippon kumite', duration:10 },
  { uv:'UV3', name:'Slow kata', duration:10 },
  { uv:'UV3', name:'Kata nidan', duration:10 },
  { uv:'UV3', name:'Bunkai', duration:5 }
];

let currentIndex = 0;
let remaining = 0;
let timer = null;
let isRunning = false;

/* ================= RENDER ================= */

function render() {
  const list = document.getElementById('list');
  list.innerHTML = '';

  sequence.forEach((ex, i) => {
    const div = document.createElement('div');
    div.className = 'exercise';
    div.draggable = true;
    div.dataset.index = i;

    div.innerHTML = `
      <span>â˜° ${ex.uv} â€“ ${ex.name}</span>
      <span>${ex.duration} min</span>
    `;

    div.addEventListener('dragstart', e => {
      div.classList.add('dragging');
      e.dataTransfer.setData('text/plain', i);
    });

    div.addEventListener('dragover', e => e.preventDefault());

    div.addEventListener('drop', e => {
      e.preventDefault();
      const from = Number(e.dataTransfer.getData('text/plain'));
      const to = i;
      const moved = sequence.splice(from,1)[0];
      sequence.splice(to,0,moved);
      persist();
      render();
    });

    div.addEventListener('dragend', () => div.classList.remove('dragging'));
    list.appendChild(div);
  });
}

render();

/* ================= PLAYER ================= */

function speak(t){
  const u = new SpeechSynthesisUtterance(t);
  u.lang='fr-FR';
  speechSynthesis.speak(u);
}

function start(){
  if (isRunning) return;
  isRunning = true;

  if (remaining === 0) {
    speak("CommenÃ§ons la sÃ©ance");
    setTimeout(run,1000);
  } else {
    runTimer();
  }
}

function run(){
  if (currentIndex >= sequence.length) {
    speak("Fin de l'entraÃ®nement, Ã  bientÃ´t");
    stop();
    return;
  }

  const ex = sequence[currentIndex];
  remaining = ex.duration * 60;

  document.getElementById('beep').play();
  speak(`Exercice ${currentIndex+1} : ${ex.name}`);
  runTimer();
}

function runTimer(){
  timer = setInterval(()=>{
    remaining--;
    document.getElementById('current').textContent =
      `${sequence[currentIndex].name} â€“ ${Math.floor(remaining/60)}:${String(remaining%60).padStart(2,'0')}`;

    if (remaining<=0){
      clearInterval(timer);
      document.getElementById('ding').play();
      currentIndex++;
      run();
    }
  },1000);
}

function pause(){
  clearInterval(timer);
  isRunning = false;
}

function stop(){
  clearInterval(timer);
  isRunning=false;
  currentIndex=0;
  remaining=0;
  document.getElementById('current').textContent='SÃ©ance arrÃªtÃ©e';
}

/* ================= STORAGE ================= */

function persist(){
  localStorage.setItem('current-sequence', JSON.stringify(sequence));
}

function saveSequence(){
  const name = document.getElementById('seqName').value;
  if(!name) return alert("Nom requis");
  const all = JSON.parse(localStorage.getItem('saved-sequences')) || {};
  all[name] = sequence;
  localStorage.setItem('saved-sequences', JSON.stringify(all));
  loadList();
  alert("SÃ©quence enregistrÃ©e");
}

function loadList(){
  const sel = document.getElementById('loadSelect');
  sel.innerHTML='<option>-- choisir --</option>';
  const all = JSON.parse(localStorage.getItem('saved-sequences')) || {};
  Object.keys(all).forEach(k=>{
    const o=document.createElement('option');
    o.value=k;o.textContent=k;
    sel.appendChild(o);
  });
}

function loadSequence(){
  const name=document.getElementById('loadSelect').value;
  const all=JSON.parse(localStorage.getItem('saved-sequences'));
  if(all && all[name]){
    sequence = all[name];
    persist();
    render();
  }
}

loadList();
</script>
</body>
</html>
