<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu ‚Äì 2e Dan</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',system-ui;
  background:linear-gradient(to right,#ffecd2,#fcb69f);
}
h1,h2,h3{text-align:center}
.container{max-width:1100px;margin:auto;padding:1rem}
.uv{
  background:linear-gradient(120deg,#84fab0,#8fd3f4);
  border-radius:20px;padding:1rem;margin-bottom:1rem;
  box-shadow:0 10px 20px rgba(0,0,0,.15)
}
.exercise{
  background:#fff;border-radius:15px;
  padding:.5rem;margin:.3rem 0;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 4px 10px rgba(0,0,0,.1)
}
.exercise.done{text-decoration:line-through;opacity:.5}
.exercise.active{background:#ffe0f0}
button{
  border:none;border-radius:20px;
  padding:.4rem .8rem;margin:.1rem;
  cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.2)
}
.progress{
  width:100%;height:18px;
  background:#eee;border-radius:10px;overflow:hidden
}
.progress div{
  height:100%;background:#84fab0;width:0%
}
#fullscreen{
  display:none;position:fixed;inset:0;
  background:#000;color:#fff;
  z-index:999;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center
}
#fsName{font-size:2rem}
#fsTimer{font-size:5rem;margin:1rem}
</style>
</head>

<body>
<h1>ü•ã Coach Tai Jitsu ‚Äì 2e Dan</h1>

<div class="container">

<h2>üè∑Ô∏è S√©ances nomm√©es</h2>
<input id="sessionName" placeholder="Nom de la s√©ance">
<button onclick="saveSession()">üíæ Sauvegarder</button>
<select id="sessionSelect" onchange="loadSession()">
  <option value=\"\">Charger une s√©ance</option>
</select>

<h2>üìã Banque d‚Äôexercices</h2>
<div id="bank"></div>

<h2>üß© S√©lection</h2>
<div id="selection"></div>
<button onclick="clearSelection()">üóëÔ∏è Vider</button>
<button onclick="validateSelection()">‚úÖ Valider</button>

<h2>‚è±Ô∏è S√©ance</h2>
<div id="sequence"></div>
<div class="progress"><div id="sessionBar"></div></div>

<h2>üéÆ Commandes</h2>
<button onclick="start()">‚ñ∂Ô∏è Lecture</button>
<button onclick="pause()">‚è∏ Pause</button>
<button onclick="stop()">‚èπ Stop</button>
<button onclick="openFullscreen()">üì± Plein √©cran</button>

<h2>üéØ Objectifs par exercice</h2>
<div id="goals"></div>

<h2>üìä Historique par exercice</h2>
<div id="history"></div>

</div>

<div id="fullscreen">
  <div id="fsName"></div>
  <div id="fsTimer">00:00</div>
  <div class="progress" style="width:80%">
    <div id="fsBar"></div>
  </div>
  <button onclick="closeFullscreen()">‚¨ÖÔ∏è Quitter</button>
</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
/* ================== DONN√âES ================== */
const synth = speechSynthesis;

const bankData=[
 {uv:'ü•ã UV1 ‚Äì Kihon',items:['Kihon simple','Encha√Ænement','Cibles']},
 {uv:'üåÄ UV2 ‚Äì D√©placements',items:['Tai sabaki','Slow ippon','Ippon kumite']},
 {uv:'üìê UV3 ‚Äì Kata',items:['Slow kata','Kata nidan','Bunka√Ø']},
 {uv:'‚öôÔ∏è UV4 ‚Äì Technique',items:['Shadow']},
 {uv:'üî• UV5&6 ‚Äì Randori',items:['Shadow randori']}
];

let selection = JSON.parse(localStorage.getItem('selection')) || [];
let sequence  = JSON.parse(localStorage.getItem('sequence')) || [];
let sessions  = JSON.parse(localStorage.getItem('sessions')) || {};
let history   = JSON.parse(localStorage.getItem('history')) || {};
let goals     = JSON.parse(localStorage.getItem('goals')) || {};

let idx=0, timer=null, remaining=0, totalTime=0, elapsed=0;

/* ================== RENDER ================== */
function render(){
  renderBank();
  renderSelection();
  renderSequence();
  renderSessions();
  renderGoals();
  renderHistory();
}
function renderBank(){
  const b=document.getElementById('bank'); b.innerHTML='';
  bankData.forEach(u=>{
    const d=document.createElement('div');
    d.className='uv'; d.innerHTML=`<h3>${u.uv}</h3>`;
    u.items.forEach(n=>{
      d.innerHTML+=`
      <div class="exercise">
        ${n}
        <button onclick="add('${n}','${u.uv}')">‚ûï</button>
      </div>`;
    });
    b.appendChild(d);
  });
}
function renderSelection(){
  const s=document.getElementById('selection'); s.innerHTML='';
  selection.forEach((e,i)=>{
    s.innerHTML+=`
    <div class="exercise">
      ${e.name}
      <div>
        <button onclick="moveSel(${i},-1)">‚¨ÜÔ∏è</button>
        <button onclick="moveSel(${i},1)">‚¨áÔ∏è</button>
        <button onclick="removeSel(${i})">‚ùå</button>
      </div>
    </div>`;
  });
}
function renderSequence(){
  const s=document.getElementById('sequence'); s.innerHTML='';
  totalTime = sequence.reduce((a,b)=>a+b.duration*60,0);
  sequence.forEach((e,i)=>{
    s.innerHTML+=`
    <div class="exercise ${e.done?'done':''} ${i===idx?'active':''}">
      ${e.name}
      <input type="range" min="1" max="60" value="${e.duration}"
        onchange="setDur(${i},this.value)"> ${e.duration} min
    </div>`;
  });
}
function renderSessions(){
  const sel=document.getElementById('sessionSelect');
  sel.innerHTML='<option value=\"\">Charger une s√©ance</option>';
  Object.keys(sessions).forEach(n=>{
    sel.innerHTML+=`<option>${n}</option>`;
  });
}
function renderGoals(){
  const g=document.getElementById('goals'); g.innerHTML='';
  Object.keys(goals).forEach(n=>{
    const pct=Math.min(100,goals[n].done/goals[n].target*100);
    g.innerHTML+=`
    <div class="exercise">
      ${n} (${goals[n].done}/${goals[n].target} min)
      <div class="progress"><div style="width:${pct}%"></div></div>
    </div>`;
  });
}
function renderHistory(){
  const h=document.getElementById('history'); h.innerHTML='';
  Object.keys(history).forEach(n=>{
    h.innerHTML+=`<p>${n} : ${history[n]} min</p>`;
  });
}

/* ================== ACTIONS ================== */
function add(n,uv){ selection.push({name:n,uv}); save(); }
function moveSel(i,d){
  const n=i+d; if(n<0||n>=selection.length)return;
  [selection[i],selection[n]]=[selection[n],selection[i]];
  save();
}
function removeSel(i){ selection.splice(i,1); save(); }
function clearSelection(){ selection=[]; save(); }

function validateSelection(){
  sequence = selection.map(e=>({...e,duration:5,done:false}));
  selection=[]; idx=0; elapsed=0;
  save();
}
function setDur(i,v){ sequence[i].duration=+v; save(); }

/* ================== LECTURE ================== */
function start(){
  if(timer||!sequence.length)return;
  speak('Commen√ßons la s√©ance');
  run();
}
function run(){
  if(idx>=sequence.length){
    speak('Fin de l‚Äôentra√Ænement');
    saveHistory();
    return;
  }
  const e=sequence[idx];
  remaining=e.duration*60;
  document.getElementById('beep').play();
  speak(e.name);
  timer=setInterval(()=>{
    remaining--; elapsed++;
    updateBars();
    if(remaining<=0){
      clearInterval(timer); timer=null;
      document.getElementById('ding').play();
      e.done=true;
      idx++; render(); run();
    }
  },1000);
}
function pause(){ clearInterval(timer); timer=null; }
function stop(){
  pause(); idx=0; elapsed=0;
  sequence.forEach(e=>e.done=false);
  render();
}

/* ================== FULLSCREEN ================== */
function openFullscreen(){
  document.getElementById('fullscreen').style.display='flex';
}
function closeFullscreen(){
  document.getElementById('fullscreen').style.display='none';
}
function updateBars(){
  document.getElementById('fsName').textContent = sequence[idx]?.name || '';
  document.getElementById('fsTimer').textContent =
    Math.floor(remaining/60)+':'+String(remaining%60).padStart(2,'0');
  const pct = totalTime ? elapsed/totalTime*100 : 0;
  document.getElementById('fsBar').style.width=pct+'%';
  document.getElementById('sessionBar').style.width=pct+'%';
}

/* ================== HISTORIQUE & OBJECTIFS ================== */
function saveHistory(){
  sequence.forEach(e=>{
    history[e.name]=(history[e.name]||0)+e.duration;
    if(!goals[e.name]) goals[e.name]={target:60,done:0};
    goals[e.name].done+=e.duration;
  });
  save();
}

/* ================== SESSIONS ================== */
function saveSession(){
  const n=document.getElementById('sessionName').value;
  if(!n)return;
  sessions[n]=sequence;
  save();
}
function loadSession(){
  const n=document.getElementById('sessionSelect').value;
  if(sessions[n]){
    sequence=JSON.parse(JSON.stringify(sessions[n]));
    idx=0; elapsed=0;
    save();
  }
}

/* ================== UTILS ================== */
function speak(t){
  synth.cancel();
  synth.speak(new SpeechSynthesisUtterance(t));
}
function save(){
  localStorage.setItem('selection',JSON.stringify(selection));
  localStorage.setItem('sequence',JSON.stringify(sequence));
  localStorage.setItem('sessions',JSON.stringify(sessions));
  localStorage.setItem('history',JSON.stringify(history));
  localStorage.setItem('goals',JSON.stringify(goals));
  render();
}

render();
</script>
</body>
</html>
