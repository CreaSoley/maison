<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ¥‹ Carnet dâ€™entraÃ®nement KaratÃ©</title>

<style>
body{margin:0;font-family:system-ui;background:#ffecd2}
header{text-align:center;padding:14px;background:#84fab0}
.container{max-width:900px;margin:auto;padding:16px}

button{
 padding:12px 18px;border:none;border-radius:18px;
 margin:6px;font-size:16px
}

ul{list-style:none;padding:0}
li{
 background:#fff;margin:10px 0;padding:14px;
 border-radius:16px
}

.progress{height:8px;background:#ddd;border-radius:8px;margin-top:6px}
.progress div{height:100%;background:#84fab0}

.modal{
 position:fixed;inset:0;background:rgba(0,0,0,.5);
 display:none;align-items:center;justify-content:center
}
.card{
 background:#fff;border-radius:18px;padding:20px;
 width:90%;max-width:520px;max-height:90%;overflow:auto
}

.smile{font-size:26px;padding:6px;cursor:pointer}
.smile.active{transform:scale(1.3)}
</style>
</head>

<body>

<header>
<h1>ğŸ¥‹ Carnet dâ€™entraÃ®nement</h1>
</header>

<div class="container">

<button onclick="start()">â–¶ Lancer</button>
<button onclick="newSession()">â™» Nouvelle sÃ©ance</button>
<button onclick="openEval()">ğŸ“ Auto-Ã©valuation</button>

<ul id="program"></ul>

</div>

<div class="modal" id="evalModal">
 <div class="card">
  <h2>ğŸ“ Auto-Ã©valuation du jour</h2>
  <div id="evalContent"></div>
  <button onclick="saveEval()">ğŸ’¾ Enregistrer</button>
  <button onclick="closeEval()">Fermer</button>
 </div>
</div>

<script>
/* ---------- CONFIG ---------- */
var UV_CRITERIA={
 Kihon:["distance","kime","prÃ©cision"],
 Kata:["fluiditÃ©","Ã©quilibre"],
 Randori:["distance","engagement"]
};

/* ---------- STATE ---------- */
var exercises=[
 {name:"Kihon",uv:"Kihon",duration:1,progress:0},
 {name:"Kata",uv:"Kata",duration:1,progress:0},
 {name:"Randori",uv:"Randori",duration:1,progress:0}
];

var interval=null,currentIndex=0;

/* ---------- INIT ---------- */
render();

/* ---------- RENDER ---------- */
function render(){
 var ul=document.getElementById("program");
 ul.innerHTML="";
 for(var i=0;i<exercises.length;i++){
  var e=exercises[i];
  var li=document.createElement("li");
  li.innerHTML="<strong>"+e.name+"</strong>"+
   "<div class='progress'><div style='width:"+e.progress+"%'></div></div>";
  ul.appendChild(li);
 }
}

/* ---------- TIMER ---------- */
function start(){
 if(interval) return;
 play();
}

function play(){
 if(currentIndex>=exercises.length) return;
 var e=exercises[currentIndex];
 var remaining=e.duration*60;

 interval=setInterval(function(){
  remaining--;
  e.progress=100-(remaining/(e.duration*60))*100;
  render();
  if(remaining<=0){
   clearInterval(interval);interval=null;
   logExercise(e.name);
   currentIndex++;
   play();
  }
 },1000);
}

function newSession(){
 if(interval){clearInterval(interval);interval=null;}
 currentIndex=0;
 for(var i=0;i<exercises.length;i++) exercises[i].progress=0;
 render();
}

/* ---------- STORAGE ---------- */
function logExercise(name){
 var d=new Date().toISOString().slice(0,10);
 var s=JSON.parse(localStorage.getItem("sessions")||"{}");
 if(!s[d]) s[d]={exercises:[]};
 if(s[d].exercises.indexOf(name)===-1) s[d].exercises.push(name);
 localStorage.setItem("sessions",JSON.stringify(s));
}

/* ---------- EVAL STORAGE ---------- */
function getEvals(){
 return JSON.parse(localStorage.getItem("evals")||"{}");
}
function saveEvals(e){
 localStorage.setItem("evals",JSON.stringify(e));
}

/* ---------- AUTO-EVAL ---------- */
function openEval(){
 var modal=document.getElementById("evalModal");
 var c=document.getElementById("evalContent");
 c.innerHTML="";

 var d=new Date().toISOString().slice(0,10);
 var sessions=JSON.parse(localStorage.getItem("sessions")||"{}");
 var evals=getEvals();

 var done=[];
 if(sessions[d] && sessions[d].exercises){
  done=sessions[d].exercises;
 }

 if(done.length===0){
  c.innerHTML="<p>Aucun exercice terminÃ© aujourdâ€™hui.</p>";
  modal.style.display="flex";
  return;
 }

 for(var i=0;i<done.length;i++){
  var name=done[i];
  var ex=null;
  for(var j=0;j<exercises.length;j++){
   if(exercises[j].name===name) ex=exercises[j];
  }
  if(!ex) continue;

  c.innerHTML+="<h4>"+name+"</h4>";

  var criteria=UV_CRITERIA[ex.uv];
  for(var k=0;k<criteria.length;k++){
   var cr=criteria[k];
   c.innerHTML+=cr+" : ";

   for(var v=1;v<=5;v++){
    var active="";
    if(
     evals[d] &&
     evals[d].exercises &&
     evals[d].exercises[name] &&
     evals[d].exercises[name][cr]===v
    ){
     active=" active";
    }

    c.innerHTML+=
     "<span class='smile"+active+
     "' data-ex='"+name+
     "' data-cr='"+cr+
     "' data-v='"+v+"'>"+
     ["ğŸ˜","ğŸ˜","ğŸ™‚","ğŸ˜„","ğŸ”¥"][v-1]+
     "</span>";
   }
   c.innerHTML+="<br>";
  }
 }

 var smiles=document.querySelectorAll(".smile");
 for(var s=0;s<smiles.length;s++){
  smiles[s].onclick=function(){
   var list=this.parentNode.querySelectorAll(".smile");
   for(var i=0;i<list.length;i++) list[i].classList.remove("active");
   this.classList.add("active");
  };
 }

 modal.style.display="flex";
}

function saveEval(){
 var d=new Date().toISOString().slice(0,10);
 var evals=getEvals();
 if(!evals[d]) evals[d]={exercises:{}};

 var active=document.querySelectorAll(".smile.active");
 for(var i=0;i<active.length;i++){
  var s=active[i];
  var ex=s.getAttribute("data-ex");
  var cr=s.getAttribute("data-cr");
  var v=parseInt(s.getAttribute("data-v"),10);

  if(!evals[d].exercises[ex]) evals[d].exercises[ex]={};
  evals[d].exercises[ex][cr]=v;
 }

 saveEvals(evals);
 alert("Ã‰valuation enregistrÃ©e âœ…");
 closeEval();
}

function closeEval(){
 document.getElementById("evalModal").style.display="none";
}
</script>

</body>
</html>
