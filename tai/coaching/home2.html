
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸŒ¸ Kihon Trainer ğŸŒ¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
/* ===================== VARIABLES ===================== */
:root{
  --pink:#ff5fc1;
  --hot-pink:#ff1493;
  --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px;
  --shadow:0 12px 25px rgba(255,120,180,.25);
}

/* ===================== BASE ===================== */
body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:20px;
}

main{
  max-width:800px;
  width:100%;
}

/* ===================== CARD ===================== */
.card{
  background:white;
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

h1{
  text-align:center;
  color:var(--hot-pink);
}

/* ===================== CONTROLS ===================== */
.controls{
  display:grid;
  gap:10px;
}

select,button,input{
  padding:10px;
  border-radius:12px;
  border:2px solid #ffd6ec;
  font-family:'Fredoka';
}

button{
  background:var(--pink);
  color:white;
  cursor:pointer;
}

button.stop{background:#ff4d6d}
button.pause{background:#999}

.range-wrap{
  display:flex;
  gap:10px;
  align-items:center;
}

/* ===================== VISUAL ZONE ===================== */
#visual{
  margin-top:20px;
  border-radius:20px;
  padding:25px;
  min-height:160px;
  color:white;
  text-align:center;
  font-size:1.4rem;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

#countdown{
  font-size:2rem;
  margin-top:10px;
}

/* ===================== CATEGORY BACKGROUNDS ===================== */
.bg-3pas{
  background-image:linear-gradient(to top,#30cfd0,#330867);
}
.bg-surplace{
  background:
    linear-gradient(to bottom,rgba(255,255,255,.15),rgba(0,0,0,.15)),
    radial-gradient(at top center,rgba(255,255,255,.4),rgba(0,0,0,.4)),
    #989898;
  background-blend-mode:multiply,multiply;
}
.bg-multi{
  background-image:linear-gradient(to top,#f43b47,#453a94);
}
</style>
</head>

<body>
<main>
<div class="card">

<h1>ğŸ¥‹ Kihon Trainer</h1>

<div class="controls">

<select id="mode">
  <option value="1">ğŸ² Exercice 1 â€“ AlÃ©atoire global</option>
  <option value="2">ğŸ¯ Exercice 2 â€“ Par catÃ©gorie</option>
  <option value="3">ğŸ“‚ Exercice 3 â€“ CatÃ©gorie choisie</option>
</select>

<select id="categorie">
  <option value="3pas">3 pas</option>
  <option value="surplace">Sur place</option>
  <option value="multi">Multidirectionnel</option>
</select>
<div class="range-wrap">
  <label>Nombre d'enchaÃ®nements :</label>
  <input type="number" id="count" min="1" value="3" style="width:80px">
</div>

<div class="range-wrap">
  <label>Intervalle :</label>
  <input type="range" min="30" max="240" value="60" id="interval">
  <span id="intervalVal">60s</span>
</div>
<option value="exam">ğŸ“ Mode examen blanc</option>

<button id="start">â–¶ Lancer</button>
<button id="pause" class="pause">â¸ Pause</button>
<button id="stop" class="stop">â¹ Stop</button>
<button id="reset" class="pause">ğŸ”„ RÃ©initialiser</button>


</div>

<div id="visual">
  <div id="text">PrÃªt ğŸŒ¸</div>
  <div id="countdown"></div>
</div>

</div>
</main>

<script>
/* ===================== DATA ===================== */
const DATA = {
  "3pas":[
    "Avancer en Soto Uke en Zenkutsu Dachi, sur place Gyaku Tsuki Chudane, Mae geri",
    "Avancer en Shuto Uke Kokutsu Dachi, sur place Gyaku NukitÃ© Chudane en Zenkutsu Dachi",
    "Reculer Gedan Barai en Zenkutsu Dachi, OÃ¯ tsuki, avancer Mae geri",
    "Avancer Uchi uke en Zenkutsu Dachi, Yoko geri repose Kiba dachi, Yoko empi uchi sur place",
    "Avancer sur 3 pas en Zenkutsu Dachi, Jodan AguÃ© uke, HaÃ¯to uchi, TatÃ© empi uchi",
    "Kiba dachi Uraken uchi, dÃ©placement jambe avant Gyaku tsuki en Zenkutsu Dachi, retour Kiba dachi",
    "Avancer Mae geri, poser AguÃ© uke suivi de Gyaku tsuki"
  ],
  "surplace":[
    "Sur place Ã  gauche et Ã  droite : Mae geri jambe arriÃ¨re repose devant, Kizami Tsuki, Gyaku Tsuki",
    "Sur place Ã  gauche et Ã  droite : sursaut arriÃ¨re Jodan AguÃ© Uke, Gyaku tsuki, Mae geri jambe arriÃ¨re repose arriÃ¨re",
    "Sur place Ã  gauche et Ã  droite : sursaut arriÃ¨re Soto uke, Gyaku tsuki chudan, Mae geri jambe arriÃ¨re repose arriÃ¨re",
    "Sur place Ã  gauche et Ã  droite : sursaut Mae geri jambe avant, OÃ¯ Tsuki, Gyaku tsuki"
  ],
  "multi":[
    "Multidirectionnel : Mae geri jambe arriÃ¨re pose devant, Gyaku Tsuki Chudane sur place",
    "Multidirectionnel : Pas chassÃ© Gyaku Tsuki chudane, ressort pas chassÃ©",
    "Multidirectionnel : Avancer Mae geri, poser AguÃ© uke suivi de Gyaku tsuki"
  ]
};

const BG = {
  "3pas":"bg-3pas",
  "surplace":"bg-surplace",
  "multi":"bg-multi"
};

/* ===================== DOM ===================== */
const modeSelect   = document.getElementById("mode");
const categorieSel = document.getElementById("categorie");
const countInput   = document.getElementById("count");
const interval     = document.getElementById("interval");
const intervalVal  = document.getElementById("intervalVal");

const startBtn = document.getElementById("start");
const pauseBtn = document.getElementById("pause");
const stopBtn  = document.getElementById("stop");
const resetBtn = document.getElementById("reset");

const visual    = document.getElementById("visual");
const text      = document.getElementById("text");
const countdown = document.getElementById("countdown");

/* ===================== STATE ===================== */
let sequence = [];
let index = 0;
let timer = null;
let paused = false;
let stopped = false;
let workedSeconds = 0;
let examMode = false;
let examRecap = [];

/* ===================== UTILS ===================== */
function speak(text, rate = 1){
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "fr-FR";
    u.rate = rate;
    u.onend = resolve;
    speechSynthesis.speak(u);
  });
}

function formatTime(sec){
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}m ${s.toString().padStart(2,"0")}s`;
}

/* ===================== RANGE DISPLAY ===================== */
interval.oninput = () => {
  intervalVal.textContent = formatTime(Number(interval.value));
};

/* ===================== CORE ===================== */
async function runExercise(){
  if(stopped) return;

  if(index >= sequence.length){
    await speak("EntraÃ®nement terminÃ©");
    alert("Temps travaillÃ© : " + formatTime(workedSeconds));
    return;
  }

  const ex = sequence[index];

  visual.className = BG[ex.cat];
  text.textContent = ex.text;

  if(current.garde){
  await speak("Garde Ã  " + current.garde, 1);
}

  await speak("CatÃ©gorie " + ex.cat, 0.7);
  await speak(ex.text, 0.7);
  await speak(ex.text, 0.7);
  await speak("HajimÃ©", 1);

 let remaining = examMode ? current.duration : Number(interval.value);

  countdown.textContent = formatTime(remaining);

  timer = setInterval(() => {
    if(paused || stopped) return;

    remaining--;
    workedSeconds++;
    countdown.textContent = formatTime(remaining);

    if(remaining <= 0){
      clearInterval(timer);
      index++;

     if(!examMode && index < sequence.length - 1){
  await speak("Exercice suivant",1);
}
          setTimeout(() => {
            if(!stopped) runExercise();
          }, 2000);
        });
      } else {
        runExercise();
      }
    }
  }, 1000);
}

/* ===================== EVENTS ===================== */
startBtn.onclick = () => {
  speechSynthesis.cancel();
  clearInterval(timer);

  stopped = false;
  paused = false;
  index = 0;
  workedSeconds = 0;

  pauseBtn.classList.remove("active");
  pauseBtn.textContent = "â¸ Pause";

  sequence = [];

  const mode = modeSelect.value;
  const cat  = categorieSel.value;
  const qty  = Number(countInput.value);

  if(mode === "1"){
    let all=[];
    Object.entries(DATA).forEach(([c,l])=>l.forEach(t=>all.push({cat:c,text:t})));
    sequence = all.sort(()=>Math.random()-.5).slice(0,qty);
  }

  if(mode === "2"){
    Object.entries(DATA).forEach(([c,l])=>{
      sequence.push({cat:c,text:l[Math.floor(Math.random()*l.length)]});
    });
  }

  if(mode === "3"){
    sequence = DATA[cat]
      .slice().sort(()=>Math.random()-.5)
      .slice(0,qty)
      .map(t=>({cat:cat,text:t}));
  }

  setTimeout(() => {
    if(!stopped) runExercise();
  }, 5000);
};
  if(mode === "exam"){
  interval.disabled = true;
  sequence = buildExamSequence();
}


pauseBtn.onclick = () => {
  paused = !paused;
  pauseBtn.classList.toggle("active", paused);
  pauseBtn.textContent = paused ? "â–¶ Reprendre" : "â¸ Pause";
};

stopBtn.onclick = () => {
  stopped = true;
  speechSynthesis.cancel();
  clearInterval(timer);

  visual.className = "";
  text.textContent = "SÃ©ance arrÃªtÃ©e";
  countdown.textContent = "";

  pauseBtn.classList.remove("active");
  pauseBtn.textContent = "â¸ Pause";

  alert("Temps travaillÃ© : " + formatTime(workedSeconds));
};

resetBtn.onclick = () => {
  speechSynthesis.cancel();
  clearInterval(timer);

  stopped = false;
  paused = false;
  index = 0;
  workedSeconds = 0;

  pauseBtn.classList.remove("active");
  pauseBtn.textContent = "â¸ Pause";

  visual.className = "";
  text.textContent = "PrÃªt ğŸŒ¸";
  countdown.textContent = "";
};
  function buildExamSequence(){
  examMode = true;
  examRecap = [];

  const seq = [];

  /* ========= PARTIE 1 â€” 3 PAS ========= */
  const pas3 = DATA["3pas"]
    .slice()
    .sort(() => Math.random() - .5)
    .slice(0, 3);

  pas3.forEach(txt => {
    seq.push({
      cat: "3pas",
      text: txt,
      duration: 60,
      repeat: 1,
      garde: null
    });
  });

  examRecap.push({
    title: "Partie 1 â€“ EnchaÃ®nements 3 pas",
    items: pas3
  });

  /* ========= PARTIE 2 â€” SUR PLACE ========= */
  const surPlace = DATA["surplace"][Math.floor(Math.random()*DATA["surplace"].length)];

  ["gauche","droite"].forEach(garde=>{
    seq.push({
      cat: "surplace",
      text: surPlace,
      duration: 60,
      repeat: 1,
      garde
    });
  });

  examRecap.push({
    title: "Partie 2 â€“ EnchaÃ®nement sur place",
    items: [surPlace]
  });

  /* ========= PARTIE 3 â€” MULTI ========= */
  const multi = DATA["multi"][Math.floor(Math.random()*DATA["multi"].length)];

  ["gauche","droite"].forEach(garde=>{
    seq.push({
      cat: "multi",
      text: multi,
      duration: 120,
      repeat: 1,
      garde
    });
  });

  examRecap.push({
    title: "Partie 3 â€“ EnchaÃ®nement multidirectionnel",
    items: [multi]
  });

  return seq;
}
if(examMode){
  let html = "<h3>ğŸ“„ RÃ©capitulatif de l'examen</h3>";

  examRecap.forEach(part=>{
    html += `<strong>${part.title}</strong><ul>`;
    part.items.forEach(i=>{
      html += `<li>${i}</li>`;
    });
    html += "</ul>";
  });

  document.getElementById("recap").innerHTML = html;
  examMode = false;
}

</script>

</body>
</html>

