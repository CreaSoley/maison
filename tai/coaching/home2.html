<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸ¥‹ Kihon Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#ff5fc1;
  --hot-pink:#ff1493;
  --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px;
  --shadow:0 12px 25px rgba(255,120,180,.25);
}

body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:20px;
}

main{max-width:800px;width:100%}

.card{
  background:white;
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

h1{text-align:center;color:var(--hot-pink)}

.controls{display:grid;gap:10px}

select,button,input{
  padding:10px;
  border-radius:12px;
  border:2px solid #ffd6ec;
  font-family:'Fredoka';
}

button{background:var(--pink);color:white;cursor:pointer}
button.stop{background:#ff4d6d}
button.pause{background:#999}

#visual{
  margin-top:20px;
  border-radius:20px;
  padding:25px;
  min-height:160px;
  color:white;
  text-align:center;
  font-size:1.3rem;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

#countdown{font-size:2rem;margin-top:10px}

.bg-3pas{background:linear-gradient(to top,#30cfd0,#330867)}
.bg-surplace{background:linear-gradient(to top,#999,#555)}
.bg-multi{background:linear-gradient(to top,#f43b47,#453a94)}

.hidden{display:none}
</style>
</head>

<body>
<main>
<div class="card">

<h1>ğŸ¥‹ Kihon Trainer</h1>

<div class="controls">

<select id="mode">
  <option value="normal">ğŸ² EntraÃ®nement libre</option>
  <option value="exam">ğŸ“ Mode examen blanc</option>
</select>

<div id="normalControls">
  <input type="number" id="count" min="1" value="3">
  <input type="range" id="interval" min="30" max="240" value="60">
</div>

<div id="examControls" class="hidden">
  <button id="presentation">ğŸ“¢ PrÃ©sentation de l'examen</button>
  <button id="startExam">â–¶ DÃ©marrer l'examen</button>
</div>

<button id="pause" class="pause">â¸ Pause</button>
<button id="stop" class="stop">â¹ Stop</button>

</div>

<div id="visual">
  <div id="text">PrÃªt ğŸŒ¸</div>
  <div id="countdown"></div>
</div>

</div>
</main>

<script>
/* ===================== DATA ===================== */
const DATA = {
  "3pas":[
    "Avancer en Soto Uke, Gyaku Tsuki, Mae Geri",
    "Avancer Shuto Uke Kokutsu Dachi, Nukite",
    "Reculer Gedan Barai, Oi Tsuki, Mae Geri"
  ],
  "surplace":[
    "Mae Geri jambe arriÃ¨re, Kizami Tsuki, Gyaku Tsuki"
  ],
  "multi":[
    "Mae Geri, Gyaku Tsuki, pivot"
  ]
};

const BG = {
  "3pas":"bg-3pas",
  "surplace":"bg-surplace",
  "multi":"bg-multi"
};

/* ===================== DOM ===================== */
const modeSelect = document.getElementById("mode");
const normalControls = document.getElementById("normalControls");
const examControls = document.getElementById("examControls");

const presentationBtn = document.getElementById("presentation");
const startExamBtn = document.getElementById("startExam");

const pauseBtn = document.getElementById("pause");
const stopBtn = document.getElementById("stop");

const text = document.getElementById("text");
const countdown = document.getElementById("countdown");
const visual = document.getElementById("visual");

/* ===================== STATE ===================== */
let sequence = [];
let index = 0;
let timer = null;
let paused = false;
let stopped = false;

/* ===================== UTILS ===================== */
function speak(txt, rate=1){
  return new Promise(res=>{
    const u=new SpeechSynthesisUtterance(txt);
    u.lang="fr-FR";
    u.rate=rate;
    u.onend=res;
    speechSynthesis.speak(u);
  });
}

function format(sec){
  return `${Math.floor(sec/60)}:${String(sec%60).padStart(2,"0")}`;
}

/* ===================== MODE SWITCH ===================== */
modeSelect.onchange = () => {
  const exam = modeSelect.value==="exam";
  normalControls.classList.toggle("hidden", exam);
  examControls.classList.toggle("hidden", !exam);
};

/* ===================== PRESENTATION EXAM ===================== */
presentationBtn.onclick = async () => {
  speechSynthesis.cancel();
  await speak(
    "Vous avez choisi le mode examen. " +
    "La sÃ©ance comporte trois parties. " +
    "PremiÃ¨re partie : trois enchaÃ®nements trois pas. " +
    "Trois fois en avanÃ§ant, puis trois fois en reculant. " +
    "DeuxiÃ¨me partie : un enchaÃ®nement sur place, garde Ã  gauche puis garde Ã  droite. " +
    "TroisiÃ¨me partie : un enchaÃ®nement multidirectionnel, garde Ã  gauche puis garde Ã  droite. " +
    "La pause est autorisÃ©e. Vous disposez du temps rÃ©glementaire.",
    0.7
  );
};

/* ===================== BUILD EXAM ===================== */
function buildExam(){
  return [
    {cat:"3pas",text:DATA["3pas"][0],time:60},
    {cat:"3pas",text:DATA["3pas"][1],time:60},
    {cat:"3pas",text:DATA["3pas"][2],time:60},
    {cat:"surplace",text:DATA["surplace"][0],time:60,garde:"gauche"},
    {cat:"surplace",text:DATA["surplace"][0],time:60,garde:"droite"},
    {cat:"multi",text:DATA["multi"][0],time:120,garde:"gauche"},
    {cat:"multi",text:DATA["multi"][0],time:120,garde:"droite"}
  ];
}

/* ===================== RUN ===================== */
async function run(){
  if(stopped || index>=sequence.length) return;

  const ex=sequence[index];
  visual.className=BG[ex.cat];
  text.textContent=ex.text;

  if(ex.garde) await speak("Garde Ã  "+ex.garde,1);
  await speak(ex.text,0.7);
  await speak(ex.text,0.7);
  await speak("HajimÃ©",1);

  let t=ex.time;
  countdown.textContent=format(t);

  timer=setInterval(()=>{
    if(paused||stopped) return;
    t--;
    countdown.textContent=format(t);
    if(t<=0){
      clearInterval(timer);
      index++;
      run();
    }
  },1000);
}

/* ===================== EVENTS ===================== */
startExamBtn.onclick = () => {
  speechSynthesis.cancel();
  clearInterval(timer);
  stopped=false;paused=false;
  index=0;
  sequence=buildExam();
  run();
};

pauseBtn.onclick = ()=>{
  paused=!paused;
  pauseBtn.textContent=paused?"â–¶ Reprendre":"â¸ Pause";
};

stopBtn.onclick = ()=>{
  stopped=true;
  speechSynthesis.cancel();
  clearInterval(timer);
  text.textContent="SÃ©ance arrÃªtÃ©e";
  countdown.textContent="";
};
</script>
</body>
</html>
