<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸŒ¸ Kihon Trainer ğŸŒ¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#ff5fc1;
  --hot-pink:#ff1493;
  --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px;
  --shadow:0 12px 25px rgba(255,120,180,.25);
}

body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:20px;
}

main{max-width:800px;width:100%}

.card{
  background:white;
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

h1{text-align:center;color:var(--hot-pink)}

.controls{display:grid;gap:10px}

select,button,input{
  padding:10px;
  border-radius:12px;
  border:2px solid #ffd6ec;
  font-family:'Fredoka';
}

button{background:var(--pink);color:white;cursor:pointer}
button.stop{background:#ff4d6d}
button.pause{background:#999}

.range-wrap{display:flex;gap:10px;align-items:center}

#visual{
  margin-top:20px;
  border-radius:20px;
  padding:25px;
  min-height:160px;
  color:white;
  text-align:center;
  font-size:1.4rem;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

#countdown{font-size:2rem;margin-top:10px}

.bg-3pas{background-image:linear-gradient(to top,#30cfd0,#330867)}
.bg-surplace{
  background:
    linear-gradient(to bottom,rgba(255,255,255,.15),rgba(0,0,0,.15)),
    radial-gradient(at top center,rgba(255,255,255,.4),rgba(0,0,0,.4)),
    #989898;
  background-blend-mode:multiply,multiply;
}
.bg-multi{background-image:linear-gradient(to top,#f43b47,#453a94)}
</style>
</head>

<body>
<main>
<div class="card">

<h1>ğŸ¥‹ Kihon Trainer</h1>

<div class="controls">

<select id="mode">
  <option value="1">ğŸ² Exercice 1 â€“ AlÃ©atoire global</option>
  <option value="2">ğŸ¯ Exercice 2 â€“ Par catÃ©gorie</option>
  <option value="3">ğŸ“‚ Exercice 3 â€“ CatÃ©gorie choisie</option>
</select>

<select id="categorie">
  <option value="3pas">3 pas</option>
  <option value="surplace">Sur place</option>
  <option value="multi">Multidirectionnel</option>
</select>

<div class="range-wrap">
  <label>Nombre :</label>
  <input type="number" id="count" min="1" value="3" style="width:80px">
</div>

<div class="range-wrap">
  <label>Intervalle :</label>
  <input type="range" min="30" max="240" value="60" id="interval">
  <span id="intervalVal">1m 00s</span>
</div>

<button id="start">â–¶ Lancer</button>
<button id="pause" class="pause">â¸ Pause</button>
<button id="stop" class="stop">â¹ Stop</button>
<button id="reset" class="pause">ğŸ”„ RÃ©initialiser</button>

</div>

<div id="visual">
  <div id="text">PrÃªt ğŸŒ¸</div>
  <div id="countdown"></div>
</div>

</div>
</main>

<script>
const DATA={
  "3pas":[
    "Avancer en Soto Uke en Zenkutsu Dachi, Gyaku Tsuki Chudan, Mae geri",
    "Avancer en Shuto Uke Kokutsu Dachi, Gyaku NukitÃ© Chudan",
    "Reculer Gedan Barai, OÃ¯ tsuki, Mae geri",
    "Avancer Uchi uke, Yoko geri, Yoko empi uchi",
    "Avancer 3 pas Jodan Age uke, HaÃ¯to uchi, Tate empi uchi"
  ],
  "surplace":[
    "Mae geri jambe arriÃ¨re, Kizami Tsuki, Gyaku Tsuki",
    "Sursaut arriÃ¨re Jodan Age Uke, Gyaku tsuki, Mae geri",
    "Sursaut Soto uke, Gyaku tsuki, Mae geri"
  ],
  "multi":[
    "Mae geri, Gyaku Tsuki",
    "Pas chassÃ© Gyaku Tsuki",
    "Mae geri, Age uke, Gyaku tsuki"
  ]
};

const BG={3pas:"bg-3pas",surplace:"bg-surplace",multi:"bg-multi"};

const mode=document.getElementById("mode");
const catSel=document.getElementById("categorie");
const count=document.getElementById("count");
const interval=document.getElementById("interval");
const intervalVal=document.getElementById("intervalVal");

const startBtn=document.getElementById("start");
const pauseBtn=document.getElementById("pause");
const stopBtn=document.getElementById("stop");
const resetBtn=document.getElementById("reset");

const visual=document.getElementById("visual");
const text=document.getElementById("text");
const countdown=document.getElementById("countdown");

let seq=[],idx=0,timer=null,paused=false,stopped=false,worked=0;

interval.oninput=()=>intervalVal.textContent=format(interval.value);

function speak(t,r=1){
  return new Promise(res=>{
    const u=new SpeechSynthesisUtterance(t);
    u.lang="fr-FR";u.rate=r;u.onend=res;
    speechSynthesis.speak(u);
  });
}

function format(s){
  const m=Math.floor(s/60),sec=s%60;
  return `${m}m ${sec.toString().padStart(2,"0")}s`;
}

async function run(){
  if(stopped||idx>=seq.length){
    await speak("EntraÃ®nement terminÃ©");
    alert("Temps travaillÃ© : "+format(worked));
    return;
  }

  const ex=seq[idx];
  visual.className=BG[ex.cat];
  text.textContent=ex.text;

  await speak("EnchaÃ®nement",0.7);
  await speak(ex.text,0.7);
  await speak(ex.text,0.7);
  await speak("HajimÃ©");

  let remain=Number(interval.value);
  countdown.textContent=format(remain);

  timer=setInterval(()=>{
    if(paused||stopped)return;
    remain--;worked++;
    countdown.textContent=format(remain);
    if(remain<=0){
      clearInterval(timer);
      idx++;
      setTimeout(run,2000);
    }
  },1000);
}

startBtn.onclick=()=>{
  speechSynthesis.cancel();
  clearInterval(timer);
  stopped=false;paused=false;idx=0;worked=0;

  seq=[];
  if(mode.value==="1"){
    let all=[];
    Object.entries(DATA).forEach(([c,l])=>l.forEach(t=>all.push({cat:c,text:t})));
    seq=all.sort(()=>Math.random()-.5).slice(0,count.value);
  }
  if(mode.value==="2"){
    Object.entries(DATA).forEach(([c,l])=>{
      seq.push({cat:c,text:l[Math.floor(Math.random()*l.length)]});
    });
  }
  if(mode.value==="3"){
    seq=DATA[catSel.value].slice().sort(()=>Math.random()-.5)
      .slice(0,count.value).map(t=>({cat:catSel.value,text:t}));
  }
  setTimeout(run,5000);
};

pauseBtn.onclick=()=>{
  paused=!paused;
  pauseBtn.textContent=paused?"â–¶ Reprendre":"â¸ Pause";
};

stopBtn.onclick=()=>{
  stopped=true;
  speechSynthesis.cancel();
  clearInterval(timer);
  text.textContent="SÃ©ance arrÃªtÃ©e";
  countdown.textContent="";
};

resetBtn.onclick=()=>{
  speechSynthesis.cancel();
  clearInterval(timer);
  stopped=false;paused=false;idx=0;worked=0;
  text.textContent="PrÃªt ğŸŒ¸";
  countdown.textContent="";
};
</script>
</body>
</html>
