<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>üå∏ Kihon Trainer üå∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
/* ===================== VARIABLES ===================== */
:root{
  --pink:#ff5fc1;
  --hot-pink:#ff1493;
  --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px;
  --shadow:0 12px 25px rgba(255,120,180,.25);
}

/* ===================== BASE ===================== */
body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:20px;
}

main{
  max-width:800px;
  width:100%;
}

/* ===================== CARD ===================== */
.card{
  background:white;
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

h1{
  text-align:center;
  color:var(--hot-pink);
}

/* ===================== CONTROLS ===================== */
.controls{
  display:grid;
  gap:10px;
}

select,button,input{
  padding:10px;
  border-radius:12px;
  border:2px solid #ffd6ec;
  font-family:'Fredoka';
}

button{
  background:var(--pink);
  color:white;
  cursor:pointer;
}

button.stop{background:#ff4d6d}
button.pause{background:#999}

.range-wrap{
  display:flex;
  gap:10px;
  align-items:center;
}

/* ===================== VISUAL ZONE ===================== */
#visual{
  margin-top:20px;
  border-radius:20px;
  padding:25px;
  min-height:160px;
  color:white;
  text-align:center;
  font-size:1.4rem;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

#countdown{
  font-size:2rem;
  margin-top:10px;
}

/* ===================== CATEGORY BACKGROUNDS ===================== */
.bg-3pas{
  background-image:linear-gradient(to top,#30cfd0,#330867);
}
.bg-surplace{
  background:
    linear-gradient(to bottom,rgba(255,255,255,.15),rgba(0,0,0,.15)),
    radial-gradient(at top center,rgba(255,255,255,.4),rgba(0,0,0,.4)),
    #989898;
  background-blend-mode:multiply,multiply;
}
.bg-multi{
  background-image:linear-gradient(to top,#f43b47,#453a94);
}
</style>
</head>

<body>
<main>
<div class="card">

<h1>ü•ã Kihon Trainer</h1>

<div class="controls">

<select id="mode">
  <option value="1">üé≤ Exercice 1 ‚Äì Al√©atoire global</option>
  <option value="2">üéØ Exercice 2 ‚Äì Par cat√©gorie</option>
  <option value="3">üìÇ Exercice 3 ‚Äì Cat√©gorie choisie</option>
</select>

<select id="categorie">
  <option value="3pas">3 pas</option>
  <option value="surplace">Sur place</option>
  <option value="multi">Multidirectionnel</option>
</select>
<div class="range-wrap">
  <label>Nombre d'encha√Ænements :</label>
  <input type="number" id="count" min="1" value="3" style="width:80px">
</div>

<div class="range-wrap">
  <label>Intervalle :</label>
  <input type="range" min="30" max="240" value="60" id="interval">
  <span id="intervalVal">60s</span>
</div>

<button id="start">‚ñ∂ Lancer</button>
<button id="pause" class="pause">‚è∏ Pause</button>
<button id="stop" class="stop">‚èπ Stop</button>

</div>

<div id="visual">
  <div id="text">Pr√™t üå∏</div>
  <div id="countdown"></div>
</div>

</div>
</main>

<script>
/* ===================== DATA ===================== */
const DATA = {
  "3pas":[
    "Avancer en Soto Uke en Zenkutsu Dachi, sur place Gyaku Tsuki Chudan, Mae geri",
    "Avancer en Shuto Uke Kokutsu Dachi, sur place Gyaku Nukite Chudan en Zenkutsu Dachi",
    "Reculer Gedan Barai en Zenkutsu Dachi, O√Ø tsuki, avancer Mae geri",
    "Avancer Uchi uke en Zenkutsu Dachi, Yoko geri repose Kiba dachi, Yoko empi uchi sur place",
    "Avancer sur 3 pas en Zenkutsu Dachi, Jodan Age uke, Ha√Øto uchi, Tate empi uchi",
    "Kiba dachi Uraken uchi, d√©placement jambe avant Gyaku tsuki en Zenkutsu Dachi, retour Kiba dachi",
    "Avancer Mae geri, poser Age uke suivi de Gyaku tsuki"
  ],
  "surplace":[
    "Sur place √† gauche et √† droite : Mae geri jambe arri√®re repose devant, Kizami Tsuki, Gyaku Tsuki",
    "Sur place √† gauche et √† droite : sursaut arri√®re Jodan Age Uke, Gyaku tsuki, Mae geri jambe arri√®re repose arri√®re",
    "Sur place √† gauche et √† droite : sursaut arri√®re Soto uke, Gyaku tsuki chudan, Mae geri jambe arri√®re repose arri√®re",
    "Sur place √† gauche et √† droite : sursaut Mae geri jambe avant, O√Ø Tsuki, Gyaku tsuki"
  ],
  "multi":[
    "Multidirectionnel : Mae geri jambe arri√®re pose devant, Gyaku Tsuki Chudan sur place",
    "Multidirectionnel : Pas chass√© Gyaku Tsuki chudan, ressort pas chass√©",
    "Multidirectionnel : Avancer Mae geri, poser Age uke suivi de Gyaku tsuki"
  ]
};

const BG = {
  "3pas":"bg-3pas",
  "surplace":"bg-surplace",
  "multi":"bg-multi"
};

/* ===================== STATE ===================== */
let sequence = [];
let index = 0;
let paused = false;
let timer = null;
let workedSeconds = 0;

/* ===================== UTILS ===================== */
function speak(text, rate = 1){
  return new Promise(resolve => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "fr-FR";
    u.rate = rate;
    u.onend = resolve;
    speechSynthesis.speak(u);
  });
}

function formatTime(sec){
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}m ${s.toString().padStart(2,"0")}s`;
}

/* ===================== CORE ===================== */
async function runExercise(){
  if(index >= sequence.length){
    await speak("Entra√Ænement termin√©");
    alert("Temps travaill√© : " + formatTime(workedSeconds));
    return;
  }

  const ex = sequence[index];
  visual.className = BG[ex.cat];
  text.textContent = ex.text;

  await speak("Cat√©gorie " + ex.cat);
  await speak(ex.text);
  await speak("Hajim√©", 0.7);

  let remaining = Number(interval.value);
  countdown.textContent = formatTime(remaining);

  timer = setInterval(() => {
    if(paused) return;
    remaining--;
    workedSeconds++;
    countdown.textContent = formatTime(remaining);

    if(remaining <= 0){
      clearInterval(timer);
      index++;
      if(index < sequence.length){
        speak("Exercice suivant").then(()=>setTimeout(runExercise,2000));
      } else {
        runExercise();
      }
    }
  },1000);
}

/* ===================== EVENTS ===================== */
start.onclick = () => {
  speechSynthesis.cancel();
  clearInterval(timer);
  index = 0;
  workedSeconds = 0;
  paused = false;

  const mode = modeSelect.value;
  const cat = categorie.value;
  const count = Number(countInput.value);

  sequence = [];

  if(mode === "1"){
    let all=[];
    Object.entries(DATA).forEach(([c,l])=>l.forEach(t=>all.push({cat:c,text:t})));
    sequence = all.sort(()=>Math.random()-.5).slice(0,count);
  }

  if(mode === "2"){
    Object.entries(DATA).forEach(([c,l])=>{
      sequence.push({cat:c,text:l[Math.floor(Math.random()*l.length)]});
    });
  }

  if(mode === "3"){
    sequence = DATA[cat].slice().sort(()=>Math.random()-.5)
      .slice(0,count).map(t=>({cat,text:t}));
  }

  setTimeout(runExercise,5000);
};

pause.onclick = () => {
  paused = !paused;
  pause.classList.toggle("active", paused);
  pause.textContent = paused ? "‚ñ∂ Reprendre" : "‚è∏ Pause";
};

stop.onclick = () => {
  speechSynthesis.cancel();
  clearInterval(timer);
  alert("Temps travaill√© : " + formatTime(workedSeconds));
};
</script>

</body>
</html>
