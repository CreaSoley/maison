<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>üå∏ Kihon Trainer üå∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
/* ===================== VARIABLES ===================== */
:root{
  --pink:#ff5fc1;
  --hot-pink:#ff1493;
  --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px;
  --shadow:0 12px 25px rgba(255,120,180,.25);
}

/* ===================== BASE ===================== */
body{
  margin:0;
  font-family:'Fredoka',sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:20px;
}

main{
  max-width:800px;
  width:100%;
}

/* ===================== CARD ===================== */
.card{
  background:white;
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

h1{
  text-align:center;
  color:var(--hot-pink);
}

/* ===================== CONTROLS ===================== */
.controls{
  display:grid;
  gap:10px;
}

select,button,input{
  padding:10px;
  border-radius:12px;
  border:2px solid #ffd6ec;
  font-family:'Fredoka';
}

button{
  background:var(--pink);
  color:white;
  cursor:pointer;
}

button.stop{background:#ff4d6d}
button.pause{background:#999}

.range-wrap{
  display:flex;
  gap:10px;
  align-items:center;
}

/* ===================== VISUAL ZONE ===================== */
#visual{
  margin-top:20px;
  border-radius:20px;
  padding:25px;
  min-height:160px;
  color:white;
  text-align:center;
  font-size:1.4rem;
  display:flex;
  flex-direction:column;
  justify-content:center;
}

#countdown{
  font-size:2rem;
  margin-top:10px;
}

/* ===================== CATEGORY BACKGROUNDS ===================== */
.bg-3pas{
  background-image:linear-gradient(to top,#30cfd0,#330867);
}
.bg-surplace{
  background:
    linear-gradient(to bottom,rgba(255,255,255,.15),rgba(0,0,0,.15)),
    radial-gradient(at top center,rgba(255,255,255,.4),rgba(0,0,0,.4)),
    #989898;
  background-blend-mode:multiply,multiply;
}
.bg-multi{
  background-image:linear-gradient(to top,#f43b47,#453a94);
}
</style>
</head>

<body>
<main>
<div class="card">

<h1>ü•ã Kihon Trainer</h1>

<div class="controls">

<select id="mode">
  <option value="1">üé≤ Exercice 1 ‚Äì Al√©atoire global</option>
  <option value="2">üéØ Exercice 2 ‚Äì Par cat√©gorie</option>
  <option value="3">üìÇ Exercice 3 ‚Äì Cat√©gorie choisie</option>
</select>

<select id="categorie">
  <option value="3pas">3 pas</option>
  <option value="surplace">Sur place</option>
  <option value="multi">Multidirectionnel</option>
</select>
<div class="range-wrap">
  <label>Nombre d'encha√Ænements :</label>
  <input type="number" id="count" min="1" value="3" style="width:80px">
</div>

<div class="range-wrap">
  <label>Intervalle :</label>
  <input type="range" min="30" max="240" value="60" id="interval">
  <span id="intervalVal">60s</span>
</div>

<button id="start">‚ñ∂ Lancer</button>
<button id="pause" class="pause">‚è∏ Pause</button>
<button id="stop" class="stop">‚èπ Stop</button>

</div>

<div id="visual">
  <div id="text">Pr√™t üå∏</div>
  <div id="countdown"></div>
</div>

</div>
</main>

<script>
/* ===================== DATA ===================== */
const DATA = {
  "3pas":[
    "Avancer en Soto Uke en Zenkutsu Dachi, Gyaku Tsuki Chudan, Mae geri",
    "Avancer Shuto Uke Kokutsu Dachi, Gyaku Nukite Chudan",
    "Reculer Gedan Barai, Oi tsuki, Mae geri",
    "Avancer Uchi uke, Yoko geri, Yoko empi",
    "Avancer Age uke, Haito uchi, Tate empi",
    "Kiba dachi Uraken, Gyaku tsuki",
    "Avancer Mae geri, Age uke, Gyaku tsuki"
  ],
  "surplace":[
    "Mae geri jambe arri√®re, Kizami tsuki, Gyaku tsuki",
    "Sursaut arri√®re Age uke, Gyaku tsuki, Mae geri",
    "Sursaut arri√®re Soto uke, Gyaku tsuki, Mae geri",
    "Sursaut Mae geri jambe avant, Oi tsuki, Gyaku tsuki"
  ],
  "multi":[
    "Mae geri jambe arri√®re, Gyaku tsuki",
    "Pas chass√© Gyaku tsuki",
    "Avancer Mae geri, Age uke, Gyaku tsuki"
  ]
};

const BG = {
  "3pas":"bg-3pas",
  "surplace":"bg-surplace",
  "multi":"bg-multi"
};

/* ===================== STATE ===================== */
let sequence = [];
let index = 0;
let timer = null;
let paused = false;
let startTime = null;

const synth = window.speechSynthesis;

/* ===================== UI ===================== */
const intervalInput = document.getElementById("interval");
const intervalVal = document.getElementById("intervalVal");
intervalInput.oninput = () => intervalVal.textContent = intervalInput.value + "s";

/* ===================== SPEECH ===================== */
function speak(text, onEnd){
  synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "fr-FR";
  u.onend = onEnd;
  synth.speak(u);
}

/* ===================== CORE ===================== */
function startExercise(){
  if(index >= sequence.length){
    speak("Entra√Ænement termin√©");
    const realTime = Math.round((Date.now() - startTime) / 1000);
    alert("Temps r√©el travaill√© : " + realTime + " secondes");
    return;
  }

  const ex = sequence[index];

  visual.className = BG[ex.cat];
  text.textContent = ex.text;

  speak("Cat√©gorie " + ex.cat, () => {
    speak(ex.text);
  });

  let remaining = Number(intervalInput.value);
  countdown.textContent = remaining + "s";

  timer = setInterval(() => {
    if(paused) return;

    remaining--;
    countdown.textContent = remaining + "s";

    if(remaining <= 0){
      clearInterval(timer);
      index++;
      speak("Exercice suivant", () => {
        setTimeout(startExercise, 2000);
      });
    }
  }, 1000);
}

/* ===================== EVENTS ===================== */
document.getElementById("start").onclick = () => {
  synth.cancel();
  clearInterval(timer);

  index = 0;
  paused = false;
  sequence = [];
  startTime = Date.now();

  const mode = document.getElementById("mode").value;
  const cat = document.getElementById("categorie").value;
  const count = Number(document.getElementById("count").value);

  if(mode === "1"){
    let all = [];
    Object.entries(DATA).forEach(([c,list])=>{
      list.forEach(t => all.push({cat:c,text:t}));
    });
    sequence = all.sort(()=>Math.random()-.5).slice(0,count);
  }

  if(mode === "2"){
    Object.entries(DATA).forEach(([c,list])=>{
      const t = list[Math.floor(Math.random()*list.length)];
      sequence.push({cat:c,text:t});
    });
  }

  if(mode === "3"){
    const list = DATA[cat].slice().sort(()=>Math.random()-.5);
    sequence = list.slice(0,count).map(t=>({cat:cat,text:t}));
  }

  setTimeout(startExercise, 5000);
};

document.getElementById("pause").onclick = () => paused = !paused;

document.getElementById("stop").onclick = () => {
  synth.cancel();
  clearInterval(timer);
  const realTime = Math.round((Date.now() - startTime) / 1000);
  alert("Temps travaill√© : " + realTime + " secondes");
};
</script>
</body>
</html>
