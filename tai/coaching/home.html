<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸ¥‹ Kihon Trainer ğŸŒ¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#ff5fc1;
  --hot-pink:#ff1493;
  --blue1:#13547a;
  --blue2:#80d0c7;
  --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px;
  --shadow:0 12px 25px rgba(255,120,180,.25);
}
body{
  margin:0;font-family:'Fredoka',sans-serif;background:var(--bg);
  display:flex;justify-content:center;padding:20px;
}
main{max-width:950px;width:100%}
.card{
  background:white;border-radius:var(--radius);padding:20px;
  box-shadow:var(--shadow);display:flex;flex-direction:column;gap:15px;
}
h1{text-align:center;color:var(--hot-pink)}
.controls{display:grid;gap:10px}
select,button,input{padding:10px;border-radius:12px;border:2px solid #ffd6ec;font-family:'Fredoka';}
button{color:white;cursor:pointer;transition:0.2s;}
button.start{background:var(--pink)}
button.stop{background:#ff4d6d}
button.pause{background:#999}
button.reset{background-image: linear-gradient(to right, #f83600 0%, #f9d423 100%);}
button.examBtn{width:60px;height:60px;border:none;border-radius:12px;margin:5px;cursor:pointer;box-shadow:0 8px 15px rgba(255,50,150,.4);font-size:24px;color:white;}
.range-wrap{display:flex;gap:10px;align-items:center}
#visual{margin-top:10px;border-radius:20px;padding:20px;min-height:180px;color:white;text-align:center;font-size:1.3rem;display:flex;flex-direction:column;justify-content:center;position:relative;box-shadow:0 8px 20px rgba(0,0,0,.15);}
#countdown{font-size:2rem;font-weight:bold;background:rgba(255,255,255,0.3);border-radius:15px;padding:5px 15px;position:absolute;top:10px;right:10px;color:#fff;}
.bg-3pas{background:linear-gradient(to top,#30cfd0,#330867)}
.bg-surplace{background:linear-gradient(to top,#888,#444)}
.bg-multi{background:linear-gradient(to top,#f43b47,#453a94)}
#recap{margin-top:20px;background-image: linear-gradient(15deg, #13547a 0%, #80d0c7 100%);color:white;padding:15px;border-radius:15px;box-shadow:var(--shadow);}
#recap ul{list-style:none;padding-left:0;background-image: linear-gradient(-225deg, #FFFEFF 0%, #D7FFFE 100%);color:#333;border-radius:12px;margin:5px 0;padding:8px;}
#recap li{margin:5px 0;}
.examIcon{display:block;text-align:center;font-size:28px;margin-top:12px;}
  /* ===== BARRE DE BOUTONS KAWAII ===== */
.button-bar{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(160px,1fr));
  gap:10px;
  margin-top:10px;
}

/* Base commune */
.btn{
  display:flex;
  align-items:center;
  justify-content:flex-start;   /* â¬… alignement Ã  gauche */
  gap:10px;
  padding:12px 14px;
  font-size:0.95rem;
  font-weight:600;
  border:none;
  border-radius:14px;
  color:white;
  cursor:pointer;
  box-shadow:0 10px 20px rgba(255,120,180,.35);
  transition:transform .15s, box-shadow .15s;
}

.btn:hover{
  transform:translateY(-2px);
  box-shadow:0 14px 28px rgba(255,120,180,.45);
}

/* ===== DÃ©gradÃ© progressif ===== */
.btn-train{
  background-image:linear-gradient(135deg,#5f2c82,#9f5fff);
}
.btn-pause{
  background-image:linear-gradient(135deg,#6a3093,#a044ff);
}
.btn-stop{
  background-image:linear-gradient(135deg,#8e2de2,#ff416c);
}
.btn-present{
  background-image:linear-gradient(135deg,#ff416c,#ff4b2b);
}
.btn-exam{
  background-image:linear-gradient(135deg,#ff7a18,#ffb347);
}
.btn-reset{
  background-image:linear-gradient(135deg,#f83600,#f9d423);
}
@keyframes pulseSoft {
  0%   { box-shadow:0 0 0 0 rgba(255,255,255,.6); }
  70%  { box-shadow:0 0 0 14px rgba(255,255,255,0); }
  100% { box-shadow:0 0 0 0 rgba(255,255,255,0); }
}

.btn.active{
  animation:pulseSoft 1.6s infinite;
}

</style>
</head>

<body>
<main>
<div class="card">
<h1>ğŸ¥‹ Kihon Trainer ğŸŒ¸</h1>

<div class="controls">
<select id="mode">
  <option value="1">ğŸ² Exercice 1 â€“ AlÃ©atoire global</option>
  <option value="2">ğŸ¯ Exercice 2 â€“ Par catÃ©gorie</option>
  <option value="3">ğŸ“‚ Exercice 3 â€“ CatÃ©gorie choisie</option>
  <option value="exam">ğŸ“ Mode examen blanc</option>
</select>

<select id="categorie">
  <option value="3pas">3 pas</option>
  <option value="surplace">Sur place</option>
  <option value="multi">Multidirectionnel</option>
</select>

<input type="number" id="count" min="1" value="3" style="width:80px">
<input type="range" id="interval" min="30" max="240" value="60">
<span id="intervalVal">60s</span>

<div class="button-bar">

  <button id="start" class="btn btn-train">
    â–¶ï¸ Lancer lâ€™entraÃ®nement
  </button>

  <button id="pause" class="btn btn-pause">
    â¸ Pause
  </button>

  <button id="stop" class="btn btn-stop">
    â¹ Stop
  </button>

  <button id="presentationExam" class="btn btn-present hidden">
    ğŸ“¢ PrÃ©sentation examen
  </button>

  <button id="startExam" class="btn btn-exam hidden">
    ğŸ“ Lancer lâ€™examen
  </button>

  <button id="reset" class="btn btn-reset">
    ğŸ”„ RÃ©initialiser
  </button>

</div>


<div id="visual">
  <div id="text">PrÃªt ğŸŒ¸</div>
  <div id="countdown"></div>
</div>

<div id="recap"></div>
</div>
</main>

<script>
/* ================= DATA COMPLÃˆTES ================= */
const DATA={
"3pas":[
"Avancer en Soto Uke en Zenkutsu Dachi, Gyaku Tsuki Chudan, Mae Geri",
"Avancer en Shuto Uke Kokutsu Dachi, Nukite Chudan",
"Reculer Gedan Barai en Zenkutsu Dachi, Oi Tsuki, Mae Geri",
"Avancer Uchi Uke en Zenkutsu Dachi, Yoko Geri repose Kiba Dachi, Yoko Empi Uchi sur place",
"Avancer sur 3 pas en Zenkutsu Dachi, Jodan Age Uke, Haito Uchi, Tate Empi Uchi",
"Kiba Dachi Uraken Uchi, dÃ©placement jambe avant Gyaku Tsuki en Zenkutsu Dachi, retour Kiba Dachi",
"Avancer Mae Geri, poser Age Uke suivi de Gyaku Tsuki"
],
"surplace":[
"Sur place Ã  gauche et Ã  droite : Mae Geri jambe arriÃ¨re repose devant, Kizami Tsuki, Gyaku Tsuki",
"Sur place Ã  gauche et Ã  droite : sursaut arriÃ¨re Jodan Age Uke, Gyaku Tsuki, Mae Geri jambe arriÃ¨re repose arriÃ¨re",
"Sur place Ã  gauche et Ã  droite : sursaut arriÃ¨re Soto Uke, Gyaku Tsuki chudan, Mae Geri jambe arriÃ¨re repose arriÃ¨re",
"Sur place Ã  gauche et Ã  droite : sursaut Mae Geri jambe avant, Oi Tsuki, Gyaku Tsuki"
],
"multi":[
"Multidirectionnel : Mae Geri jambe arriÃ¨re pose devant, Gyaku Tsuki Chudan sur place",
"Multidirectionnel : Pas chassÃ© Gyaku Tsuki chudane, ressort pas chassÃ©",
"Multidirectionnel : Avancer Mae Geri, poser Age Uke suivi de Gyaku Tsuki"
]
};

const BG={"3pas":"bg-3pas","surplace":"bg-surplace","multi":"bg-multi"};

const modeSelect=document.getElementById("mode");
const catSelect=document.getElementById("categorie");
const countInput=document.getElementById("count");
const intervalInput=document.getElementById("interval");
const intervalVal=document.getElementById("intervalVal");

const startBtn=document.getElementById("start");
const pauseBtn=document.getElementById("pause");
const stopBtn=document.getElementById("stop");
const resetBtn=document.getElementById("reset");

const examControls=document.getElementById("examControls");
const presentationBtn=document.getElementById("presentation");
const startExamBtn=document.getElementById("startExam");

const text=document.getElementById("text");
const countdown=document.getElementById("countdown");
const visual=document.getElementById("visual");
const recapDiv=document.getElementById("recap");

let sequence=[], index=0, timer=null;
let paused=false, stopped=false, workedSeconds=0;
let examRecap=[], examMode=false;

function fmt(sec){const m=Math.floor(sec/60); const s=sec%60; return `${m}m ${s.toString().padStart(2,"0")}s`;}
async function speak(txt,rate=1){return new Promise(res=>{const u=new SpeechSynthesisUtterance(txt); u.lang="fr-FR"; u.rate=rate; u.onend=res; speechSynthesis.speak(u);});}
intervalInput.oninput=()=>{intervalVal.textContent=fmt(Number(intervalInput.value));};

modeSelect.onchange = () => {
  const exam = modeSelect.value === "exam";

  if (examControls) {
    examControls.classList.toggle("hidden", !exam);
  }

  if (startBtn) {
    startBtn.classList.toggle("hidden", exam);
  }

  if (catSelect) catSelect.disabled = exam;
  if (countInput) countInput.disabled = exam;
  if (intervalInput) intervalInput.disabled = exam;
};

/* ================= PrÃ©sentation examen ================= */
presentationBtn.onclick=async()=>{
  speechSynthesis.cancel();
  await speak("Vous avez choisi le mode examen blanc. La sÃ©ance comporte trois parties. PremiÃ¨re partie : enchaÃ®nements sur trois pas. DeuxiÃ¨me partie : enchaÃ®nement sur place, garde annoncÃ©e. TroisiÃ¨me partie : multidirectionnel, garde annoncÃ©e. La pause est autorisÃ©e.",0.7);
};

/* ================= Construire sÃ©quence examen ================= */
function buildExam(){
  examRecap=[]; const seq=[];
  // Exercice 1
  let p1 = [...DATA["3pas"]].sort(()=>Math.random()-.5).slice(0,3);
  examRecap.push({title:"Exercice 1 â€“ 3 pas", items:p1});
  p1.forEach((t,i)=>seq.push({cat:"3pas",text:t,time:60,announceNext:i<2}));

  // Exercice 2
  let p2 = DATA["surplace"].sort(()=>Math.random()-.5)[0];
  examRecap.push({title:"Exercice 2 â€“ Sur place", items:[p2]});
  seq.push({cat:"surplace",text:p2,time:30,garde:"gauche"});
  seq.push({cat:"surplace",text:"",time:30,garde:"droite"});

  // Exercice 3
  let p3 = DATA["multi"].sort(()=>Math.random()-.5)[0];
  examRecap.push({title:"Exercice 3 â€“ Multidirectionnel", items:[p3]});
  seq.push({cat:"multi",text:p3,time:45,garde:"gauche"});
  seq.push({cat:"multi",text:"",time:45,garde:"droite"});

  return seq;
}

/* ================= Run ================= */
async function run(){
  if(stopped) return;
  if(index>=sequence.length){
    if(examMode) await speak("Fin de l'examen",1);
    else alert("Fin de l'exercice. Temps travaillÃ©: "+fmt(workedSeconds));
    renderRecap();
    return;
  }
  const ex=sequence[index];
  visual.className=BG[ex.cat];
  text.textContent = ex.text || `Garde Ã  ${ex.garde}`;

  if(ex.garde) await speak("Garde Ã  "+ex.garde,1);
  if(ex.text && !ex.garde) await speak(ex.text,0.7);
  if(ex.text && !ex.garde) await speak(ex.text,0.7);
  await speak("HajimÃ©",1);

  let t=ex.time;
  countdown.textContent=fmt(t);

  timer=setInterval(async()=>{
    if(paused||stopped) return;
    t--; workedSeconds++;
    countdown.textContent=fmt(t);
    if(t<=0){
      clearInterval(timer);
      if(ex.announceNext) await speak("Exercice suivant",1);
      index++; run();
    }
  },1000);
}

/* ================= Recap ================= */
function renderRecap(){
  recapDiv.innerHTML="<h3>ğŸ“„ RÃ©capitulatif</h3>";
  examRecap.forEach(p=>{
    recapDiv.innerHTML+=`<strong>${p.title}</strong><ul>`+
      p.items.map(i=>`<li><button class="examBtn" style="background-image: linear-gradient(-225deg, #FFFEFF 0%, #D7FFFE 100%); color:#333;" onclick="speak('${i.replace(/'/g,"\\'")}',0.7)">${i}</button></li>`).join("")+
      "</ul>";
  });
}

/* ================= Events ================= */
startExamBtn.onclick = () => {
  setActiveButton(startExamBtn);
  // logique existante inchangÃ©e
};

  stopped=false; paused=false; index=0; workedSeconds=0;
  sequence=buildExam();
  run();

startBtn.onclick = () => {
  setActiveButton(startBtn);
  // logique existante inchangÃ©e
};

  stopped=false; paused=false; index=0; workedSeconds=0; sequence=[];
  const mode=modeSelect.value; const cat=catSelect.value; const qty=Number(countInput.value);
  if(mode==="1"){
    let all=[]; Object.entries(DATA).forEach(([c,l])=>l.forEach(t=>all.push({cat:c,text:t,time:Number(intervalInput.value)})));
    all = [...new Set(all.map(a=>JSON.stringify(a)))].map(a=>JSON.parse(a));
    sequence=all.sort(()=>Math.random()-.5).slice(0,qty);
  }
  if(mode==="2"){
    Object.entries(DATA).forEach(([c,l])=>{
      const t=l[Math.floor(Math.random()*l.length)];
      if(!sequence.find(e=>e.text===t)) sequence.push({cat:c,text:t,time:Number(intervalInput.value)});
    });
  }
  if(mode==="3"){
    sequence=DATA[cat].slice().sort(()=>Math.random()-.5).slice(0,qty).map(t=>({cat:cat,text:t,time:Number(intervalInput.value)}));
  }
  setTimeout(()=>{if(!stopped) run();},5000);

pauseBtn.onclick = () => {
  paused = !paused;
  setActiveButton(paused ? pauseBtn : startBtn);
  pauseBtn.textContent = paused ? "â–¶ Reprendre" : "â¸ Pause";
};

  paused=!paused;
  pauseBtn.textContent=paused?"â–¶ Reprendre":"â¸ Pause";

stopBtn.onclick = () => {
  setActiveButton(stopBtn);
  // logique existante inchangÃ©e
};

  stopped=true; clearInterval(timer); speechSynthesis.cancel();
  text.textContent="SÃ©ance arrÃªtÃ©e"; countdown.textContent="";

resetBtn.onclick = () => {
  setActiveButton(null);
  // logique existante inchangÃ©e
};

  stopped=true; paused=false; clearInterval(timer); speechSynthesis.cancel();
  text.textContent="PrÃªt ğŸŒ¸"; countdown.textContent=""; recapDiv.innerHTML="";

  function setActiveButton(btn){
  document.querySelectorAll(".btn").forEach(b=>b.classList.remove("active"));
  if(btn) btn.classList.add("active");
}

</script>
</body>
</html>
