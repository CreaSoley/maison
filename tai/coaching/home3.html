<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ğŸ¥‹ Kihon Trainer ğŸŒ¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
<style>
:root{
  --pink:#ff5fc1; --hot-pink:#ff1493; --bg:linear-gradient(180deg,#fff6fb,#ffeef6);
  --radius:22px; --shadow:0 12px 25px rgba(255,120,180,.25);
}
body{margin:0;font-family:'Fredoka',sans-serif;background:var(--bg);display:flex;justify-content:center;padding:20px;}
main{max-width:900px;width:100%}
.card{background:white;border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);}
h1{text-align:center;color:var(--hot-pink);}
.controls{display:grid;gap:10px;}
select,button,input{padding:10px;border-radius:12px;border:2px solid #ffd6ec;font-family:'Fredoka';}
button{background:var(--pink);color:white;cursor:pointer;}
button.stop{background:#ff4d6d;}
button.pause{background:#999;}
.hidden{display:none;}
#visual{margin-top:20px;border-radius:20px;padding:25px;min-height:160px;color:white;text-align:center;font-size:1.3rem;display:flex;flex-direction:column;justify-content:center;}
#countdown{font-size:2rem;margin-top:10px;}
.bg-3pas{background-image:linear-gradient(to top,#30cfd0,#330867);}
.bg-surplace{background:linear-gradient(to top,#888,#444);}
.bg-multi{background-image:linear-gradient(to top,#f43b47,#453a94);}
#recap{margin-top:20px;background:#fff;padding:15px;border-radius:15px;box-shadow:var(--shadow);}
</style>
</head>
<body>
<main>
<div class="card">
<h1>ğŸ¥‹ Kihon Trainer</h1>

<div class="controls">
<select id="mode">
  <option value="1">ğŸ² Exercice 1 â€“ AlÃ©atoire global</option>
  <option value="2">ğŸ¯ Exercice 2 â€“ Par catÃ©gorie</option>
  <option value="3">ğŸ“‚ Exercice 3 â€“ CatÃ©gorie choisie</option>
  <option value="exam">ğŸ“ Mode examen blanc</option>
</select>

<select id="categorie">
  <option value="3pas">3 pas</option>
  <option value="surplace">Sur place</option>
  <option value="multi">Multidirectionnel</option>
</select>

<input type="number" id="count" min="1" value="3">
<input type="range" id="interval" min="30" max="240" value="60">
<span id="intervalVal">60s</span>

<div id="examControls" class="hidden">
  <button id="presentation">ğŸ“¢ PrÃ©sentation de l'examen</button>
  <button id="startExam">â–¶ DÃ©marrer l'examen</button>
</div>

<button id="start">â–¶ Lancer</button>
<button id="pause" class="pause">â¸ Pause</button>
<button id="stop" class="stop">â¹ Stop</button>
<button id="reset" class="pause">ğŸ”„ RÃ©initialiser</button>
</div>

<div id="visual">
  <div id="text">PrÃªt ğŸŒ¸</div>
  <div id="countdown"></div>
</div>
<div id="recap"></div>
</div>
</main>

<script>
/* ===================== DATA ===================== */
const DATA = {
"3pas":[
"Avancer en Soto Uke en Zenkutsu Dachi, Gyaku Tsuki Chudan, Mae Geri",
"Avancer en Shuto Uke Kokutsu Dachi, Nukite Chudan",
"Reculer Gedan Barai en Zenkutsu Dachi, Oi Tsuki, Mae Geri",
"Avancer Mae Geri, poser Age Uke suivi de Gyaku Tsuki",
"Kiba Dachi Uraken Uchi, dÃ©placement jambe avant Gyaku Tsuki",
"Avancer sur 3 pas en Zenkutsu Dachi, Jodan Age Uke, HaÃ¯to Uchi, Tate Empi Uchi",
"Uchi Uke Zenkutsu Dachi, Yoko Geri repose Kiba Dachi, Yoko Empi Uchi"
],
"surplace":[
"Sur place : Mae Geri jambe arriÃ¨re, Kizami Tsuki, Gyaku Tsuki",
"Sur place : sursaut arriÃ¨re Soto Uke, Gyaku Tsuki, Mae Geri",
"Sur place : sursaut arriÃ¨re Jodan Age Uke, Gyaku Tsuki, Mae Geri",
"Sur place : sursaut Mae Geri jambe avant, Oi Tsuki, Gyaku Tsuki"
],
"multi":[
"Multidirectionnel : Mae Geri Jambe arriÃ¨re, Gyaku Tsuki Chudan",
"Multidirectionnel : Pas chassÃ© Gyaku Tsuki chudan, ressort pas chassÃ©",
"Multidirectionnel : Avancer Mae Geri, poser Age Uke suivi de Gyaku Tsuki"
]
};

const BG = {"3pas":"bg-3pas","surplace":"bg-surplace","multi":"bg-multi"};

/* ===================== DOM ===================== */
const modeSelect = document.getElementById("mode");
const catSelect = document.getElementById("categorie");
const countInput = document.getElementById("count");
const intervalInput = document.getElementById("interval");
const intervalVal = document.getElementById("intervalVal");

const startBtn = document.getElementById("start");
const pauseBtn = document.getElementById("pause");
const stopBtn = document.getElementById("stop");
const resetBtn = document.getElementById("reset");

const examControls = document.getElementById("examControls");
const presentationBtn = document.getElementById("presentation");
const startExamBtn = document.getElementById("startExam");

const text = document.getElementById("text");
const countdown = document.getElementById("countdown");
const visual = document.getElementById("visual");
const recapDiv = document.getElementById("recap");

/* ===================== STATE ===================== */
let sequence=[], index=0, timer=null;
let paused=false, stopped=false, workedSeconds=0;
let examRecap=[];

/* ===================== UTILS ===================== */
function fmt(sec){const m=Math.floor(sec/60); const s=sec%60; return `${m}m ${s.toString().padStart(2,"0")}s`;}
async function speak(txt, rate=1){return new Promise(resolve=>{const u=new SpeechSynthesisUtterance(txt); u.lang="fr-FR"; u.rate=rate; u.onend=resolve; speechSynthesis.speak(u);});}

/* ===================== RANGE DISPLAY ===================== */
intervalInput.oninput=()=>{intervalVal.textContent=fmt(Number(intervalInput.value));};

/* ===================== MODE SWITCH ===================== */
modeSelect.onchange=()=>{
  const exam = modeSelect.value==="exam";
  examControls.classList.toggle("hidden",!exam);
  startBtn.classList.toggle("hidden",exam);
  catSelect.disabled=exam;
  countInput.disabled=exam;
  intervalInput.disabled=exam;
};

/* ===================== PRESENTATION ===================== */
presentationBtn.onclick=async()=>{
  speechSynthesis.cancel();
  await speak(
    "Vous avez choisi le mode examen blanc. La sÃ©ance comporte trois parties. " +
    "PremiÃ¨re partie : enchaÃ®nement sur trois pas. Trois fois en avanÃ§ant puis trois fois en reculant. " +
    "DeuxiÃ¨me partie : enchaÃ®nement sur place. Le changement de garde sera annoncÃ©. " +
    "TroisiÃ¨me partie : enchaÃ®nement multidirectionnel. Le changement de garde sera annoncÃ©. " +
    "La pause est autorisÃ©e.",0.7);
};

/* ===================== BUILD EXAM ===================== */
function buildExam(){
  examRecap=[]; const seq=[];
  const p1 = [...DATA["3pas"]].sort(()=>Math.random()-.5).slice(0,3);
  examRecap.push({title:"Partie 1 â€“ 3 pas", items:p1});
  p1.forEach(t=>seq.push({cat:"3pas", text:t, time:60}));

  const p2 = DATA["surplace"][Math.floor(Math.random()*DATA["surplace"].length)];
  examRecap.push({title:"Partie 2 â€“ Sur place", items:[p2]});
  ["gauche","droite"].forEach(g=>seq.push({cat:"surplace", text:p2, time:60, garde:g}));

  const p3 = DATA["multi"][Math.floor(Math.random()*DATA["multi"].length)];
  examRecap.push({title:"Partie 3 â€“ Multidirectionnel", items:[p3]});
  ["gauche","droite"].forEach(g=>seq.push({cat:"multi", text:p3, time:120, garde:g}));

  return seq;
}

/* ===================== RUN SEQUENCE ===================== */
async function run(){
  if(stopped || index>=sequence.length){
    await speak("Fin de l'examen",1);
    renderRecap();
    return;
  }
  const ex=sequence[index];
  visual.className = BG[ex.cat];
  text.textContent = ex.text;

  if(ex.partAnnounce) await speak(ex.partAnnounce,0.7);
  if(ex.garde) await speak("Garde Ã  "+ex.garde,1);
  await speak(ex.text,0.7);
  await speak(ex.text,0.7);
  await speak("HajimÃ©",1);

  let t = ex.time;
  countdown.textContent = fmt(t);

  timer = setInterval(()=>{
    if(paused || stopped) return;
    t--; workedSeconds++;
    countdown.textContent = fmt(t);
    if(t<=0){clearInterval(timer); index++; run();}
  },1000);
}

/* ===================== RECAP ===================== */
function renderRecap(){
  recapDiv.innerHTML="<h3>ğŸ“„ RÃ©capitulatif</h3>";
  examRecap.forEach(p=>{
    recapDiv.innerHTML += `<strong>${p.title}</strong><ul>`+
      p.items.map(i=>`<li>${i}</li>`).join("")+"</ul>";
  });
}

/* ===================== EVENTS ===================== */
startExamBtn.onclick=()=>{
  stopped=false; paused=false; index=0; workedSeconds=0;
  sequence = buildExam();
  if(sequence[0]) sequence[0].partAnnounce="PremiÃ¨re partie : enchaÃ®nement sur trois pas";
  if(sequence[3]) sequence[3].partAnnounce="DeuxiÃ¨me partie : enchaÃ®nement sur place";
  if(sequence[5]) sequence[5].partAnnounce="TroisiÃ¨me partie : multidirectionnel";
  run();
};

startBtn.onclick=()=>{
  stopped=false; paused=false; index=0; workedSeconds=0;
  sequence=[];

  const mode = modeSelect.value;
  const cat = catSelect.value;
  const qty = Number(countInput.value);

  if(mode==="1"){ // AlÃ©atoire global
    let all=[];
    Object.entries(DATA).forEach(([c,l])=>l.forEach(t=>all.push({cat:c,text:t,time:Number(intervalInput.value)})));
    sequence = all.sort(()=>Math.random()-.5).slice(0,qty);
  }
  if(mode==="2"){ // Une par catÃ©gorie
    Object.entries(DATA).forEach(([c,l])=>{
      sequence.push({cat:c,text:l[Math.floor(Math.random()*l.length)],time:Number(intervalInput.value)});
    });
  }
  if(mode==="3"){ // CatÃ©gorie choisie
    sequence = DATA[cat].slice().sort(()=>Math.random()-.5).slice(0,qty).map(t=>({cat:cat,text:t,time:Number(intervalInput.value)}));
  }

  setTimeout(()=>{if(!stopped) run();},5000);
};

pauseBtn.onclick=()=>{
  paused=!paused;
  pauseBtn.textContent = paused?"â–¶ Reprendre":"â¸ Pause";
};
stopBtn.onclick=()=>{
  stopped=true; clearInterval(timer); speechSynthesis.cancel();
  text.textContent="SÃ©ance arrÃªtÃ©e"; countdown.textContent="";
};
resetBtn.onclick=()=>{
  stopped=true; paused=false; clearInterval(timer); speechSynthesis.cancel();
  text.textContent="PrÃªt ğŸŒ¸"; countdown.textContent=""; recapDiv.innerHTML="";
};
</script>
</body>
</html>
