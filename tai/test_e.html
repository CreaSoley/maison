<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu â€“ 2e Dan</title>

<style>
body{
  margin:0;font-family:'Segoe UI',system-ui;
  background:linear-gradient(to right,#ffecd2,#fcb69f);
}
h1,h2,h3{text-align:center}
.container{max-width:1000px;margin:auto;padding:1rem}
.uv{
  background:linear-gradient(120deg,#84fab0,#8fd3f4);
  border-radius:20px;padding:1rem;margin-bottom:1rem;
  box-shadow:0 10px 20px rgba(0,0,0,.15)
}
.exercise{
  background:#fff;border-radius:15px;
  padding:.5rem;margin:.3rem 0;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 4px 10px rgba(0,0,0,.1)
}
.exercise.done{text-decoration:line-through;opacity:.5}
.exercise.active{background:#ffe0f0}
button{
  border:none;border-radius:20px;
  padding:.4rem .8rem;margin:.1rem;
  cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.2)
}
.progress{
  width:100%;height:20px;border-radius:10px;
  background:#eee;overflow:hidden
}
.progress div{
  height:100%;background:#84fab0;width:0%
}
#fullscreen{
  display:none;position:fixed;inset:0;
  background:#000;color:#fff;
  align-items:center;justify-content:center;
  flex-direction:column;z-index:999
}
#fsTimer{font-size:4rem;margin:1rem}
</style>
</head>

<body>
<h1>ğŸ¥‹ Coach Tai Jitsu â€“ 2e Dan</h1>

<div class="container">

<h2>ğŸ“‹ Banque dâ€™exercices</h2>
<div id="bank"></div>

<h2>ğŸ§© SÃ©lection</h2>
<div id="selection"></div>
<button onclick="clearSelection()">ğŸ—‘ï¸ Vider la sÃ©lection</button>
<button onclick="validateSelection()">âœ… Valider la sÃ©lection</button>

<h2>â±ï¸ SÃ©ance</h2>
<div id="sequence"></div>

<div class="progress"><div id="sessionBar"></div></div>

<button onclick="start()">â–¶ï¸ Lecture</button>
<button onclick="pause()">â¸ Pause</button>
<button onclick="stop()">â¹ Stop</button>
<button onclick="openFullscreen()">ğŸ¥ Mode entraÃ®nement</button>

<h2>ğŸ¯ Objectif hebdomadaire</h2>
<div class="progress"><div id="goalBar"></div></div>
<p id="goalText"></p>

<h2>ğŸ“Š Historique</h2>
<div id="history"></div>

<h2>ğŸ“ Notes</h2>
<textarea id="note" rows="4" style="width:100%"></textarea>

</div>

<div id="fullscreen">
  <h2 id="fsName"></h2>
  <div id="fsTimer">00:00</div>
  <div class="progress"><div id="fsBar"></div></div>
  <button onclick="closeFullscreen()">â¬…ï¸ Quitter</button>
</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
const synth = speechSynthesis;
const bankData=[
 {uv:'ğŸ¥‹ UV1',items:['Kihon simple','EnchaÃ®nement','Cibles']},
 {uv:'ğŸŒ€ UV2',items:['Tai sabaki','Slow ippon','Ippon kumite']},
 {uv:'ğŸ“ UV3',items:['Slow kata','Kata nidan','BunkaÃ¯']},
 {uv:'âš™ï¸ UV4',items:['Shadow']},
 {uv:'ğŸ”¥ UV5&6',items:['Shadow randori']}
];

let selection=JSON.parse(localStorage.getItem('selection'))||[];
let sequence=JSON.parse(localStorage.getItem('sequence'))||[];
let history=JSON.parse(localStorage.getItem('history'))||[];
let note=localStorage.getItem('note')||'';

let idx=0,timer=null,remaining=0,totalTime=0,elapsed=0;

function render(){
 renderBank();renderSelection();renderSequence();
 renderHistory();renderGoal();
 document.getElementById('note').value=note;
}
function renderBank(){
 const b=document.getElementById('bank');b.innerHTML='';
 bankData.forEach(u=>{
  const d=document.createElement('div');d.className='uv';d.innerHTML=`<h3>${u.uv}</h3>`;
  u.items.forEach(n=>{
   d.innerHTML+=`<div class="exercise"><span>${n}</span>
   <button onclick="add('${n}','${u.uv}')">â•</button></div>`;
  });b.appendChild(d);
 });
}
function renderSelection(){
 const s=document.getElementById('selection');s.innerHTML='';
 selection.forEach((e,i)=>{
  s.innerHTML+=`<div class="exercise">${e.name}
  <div><button onclick="moveSel(${i},-1)">â¬†ï¸</button>
  <button onclick="moveSel(${i},1)">â¬‡ï¸</button>
  <button onclick="removeSel(${i})">âŒ</button></div></div>`;
 });
}
function renderSequence(){
 const s=document.getElementById('sequence');s.innerHTML='';
 totalTime=sequence.reduce((a,b)=>a+b.duration*60,0);
 sequence.forEach((e,i)=>{
  s.innerHTML+=`<div class="exercise ${e.done?'done':''} ${i===idx?'active':''}">
  ${e.name}
  <input type="range" min="1" max="60" value="${e.duration}"
  onchange="eDur(${i},this.value)"> ${e.duration} min</div>`;
 });
}
function renderHistory(){
 const h=document.getElementById('history');h.innerHTML='';
 history.slice(-7).forEach(s=>{
  h.innerHTML+=`<p>ğŸ“… ${s.date} â€“ ${Math.round(s.total/60)} min</p>`;
 });
}
function renderGoal(){
 const week=history.filter(h=>{
  const d=new Date(h.date);
  const now=new Date();
  return (now-d)<7*864e5;
 });
 const sum=week.reduce((a,b)=>a+b.total,0);
 const pct=Math.min(100,sum/9000*100);
 document.getElementById('goalBar').style.width=pct+'%';
 document.getElementById('goalText').textContent=
  pct<100?'ğŸ’ª Continue !':'ğŸ”¥ Objectif atteint !';
}

/* actions */
function add(n,uv){selection.push({name:n,uv});save()}
function moveSel(i,d){const n=i+d;if(n<0||n>=selection.length)return;
 [selection[i],selection[n]]=[selection[n],selection[i]];save()}
function removeSel(i){selection.splice(i,1);save()}
function clearSelection(){selection=[];save()}
function validateSelection(){
 sequence=selection.map(e=>({...e,duration:5,done:false}));
 selection=[];idx=0;elapsed=0;save()
}
function eDur(i,v){sequence[i].duration=+v;save()}

/* lecture */
function start(){
 if(timer||!sequence.length)return;
 speak('CommenÃ§ons la sÃ©ance');run()
}
function run(){
 if(idx>=sequence.length){
  speak('Fin de lâ€™entraÃ®nement');
  history.push({date:new Date().toLocaleDateString(),total:elapsed});
  save();return;
 }
 const e=sequence[idx];remaining=e.duration*60;
 document.getElementById('beep').play();
 speak(e.name);
 timer=setInterval(()=>{
  remaining--;elapsed++;
  updateBars();
  if(remaining<=0){
   clearInterval(timer);timer=null;
   document.getElementById('ding').play();
   e.done=true;idx++;render();run();
  }
 },1000);
}
function pause(){clearInterval(timer);timer=null}
function stop(){pause();idx=0;sequence.forEach(e=>e.done=false);elapsed=0;render()}

/* fullscreen */
function openFullscreen(){
 document.getElementById('fullscreen').style.display='flex';
}
function closeFullscreen(){
 document.getElementById('fullscreen').style.display='none';
}
function updateBars(){
 document.getElementById('fsName').textContent=sequence[idx]?.name||'';
 document.getElementById('fsTimer').textContent=
  Math.floor(remaining/60)+':'+String(remaining%60).padStart(2,'0');
 document.getElementById('fsBar').style.width=(elapsed/totalTime*100)+'%';
 document.getElementById('sessionBar').style.width=(elapsed/totalTime*100)+'%';
}

/* utils */
function speak(t){synth.cancel();synth.speak(new SpeechSynthesisUtterance(t))}
function save(){
 localStorage.setItem('selection',JSON.stringify(selection));
 localStorage.setItem('sequence',JSON.stringify(sequence));
 localStorage.setItem('history',JSON.stringify(history));
 localStorage.setItem('note',note=document.getElementById('note').value);
 render();
}
render();
</script>
</body>
</html>
