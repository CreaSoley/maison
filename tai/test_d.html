<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu ‚Äì 2e Dan</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',system-ui;
  background-image:linear-gradient(to right,#ffecd2 0%,#fcb69f 100%);
}
h1,h2,h3{
  text-align:center;
}
.container{
  max-width:1000px;
  margin:auto;
  padding:1rem;
}
.uv{
  background-image:linear-gradient(120deg,#84fab0 0%,#8fd3f4 100%);
  border-radius:20px;
  padding:1rem;
  margin-bottom:1rem;
  box-shadow:0 10px 20px rgba(0,0,0,.15);
}
.exercise{
  background:#fff;
  border-radius:15px;
  padding:.5rem;
  margin:.4rem 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.exercise.done{
  text-decoration:line-through;
  opacity:.5;
}
.exercise.active{
  background:#ffe0f0;
}
button{
  border:none;
  border-radius:20px;
  padding:.4rem .8rem;
  cursor:pointer;
  margin:.1rem;
  box-shadow:0 4px 8px rgba(0,0,0,.2);
}
.controls button.active{
  background:#84fab0;
}
textarea{
  width:100%;
  border-radius:15px;
  padding:.5rem;
  border:none;
}
input[type=range]{width:100px}
</style>
</head>

<body>
<h1>ü•ã Coach Tai Jitsu ‚Äì Passage 2e Dan</h1>

<div class="container">

<h2>üìã Banque d‚Äôexercices</h2>
<div id="bank"></div>

<h2>üß© S√©lection de s√©ance</h2>
<div id="selection"></div>
<button onclick="validateSelection()">‚úÖ Valider la s√©lection</button>

<h2>‚è±Ô∏è S√©ance valid√©e</h2>
<div id="sequence"></div>

<h2>üéÆ Commandes</h2>
<div class="controls">
  <button id="playBtn" onclick="start()">‚ñ∂Ô∏è Lecture</button>
  <button onclick="pause()">‚è∏ Pause</button>
  <button onclick="stop()">‚èπ Stop</button>
</div>

<h2>‚≠ê √âvaluation du jour</h2>
<div id="evaluation"></div>

<h2>üìù Carnet de notes</h2>
<textarea id="note" rows="4" placeholder="Ressenti du jour..."></textarea>

</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
/* ===== DONN√âES ===== */
const synth = window.speechSynthesis;

const bankData = [
 {uv:'ü•ã UV 1 ‚Äì Kihon', criteria:['Kime','Zanshin','Pr√©cision'], items:[
  'Kihon simple','Encha√Ænement kihon','Cibles']},
 {uv:'üåÄ UV 2 ‚Äì D√©placements', criteria:['Maai','Fluidit√©','R√©activit√©'], items:[
  'Tai sabaki','Slow ippon','Ippon kumite']},
 {uv:'üìê UV 3 ‚Äì Kata', criteria:['Rythme','Stabilit√©','Intention'], items:[
  'Slow kata','Kata nidan','Bunka√Ø']},
 {uv:'‚öôÔ∏è UV 4 ‚Äì Technique de base', criteria:['Structure','Rel√¢chement'], items:[
  'Shadow']},
 {uv:'üî• UV 5 & 6 ‚Äì Randori', criteria:['Adaptation','Endurance'], items:[
  'Shadow randori']}
];

let selection = JSON.parse(localStorage.getItem('selection')) || [];
let sequence = JSON.parse(localStorage.getItem('sequence')) || [];
let note = localStorage.getItem('note') || '';

let current = 0;
let timer = null;
let remaining = 0;

/* ===== RENDER ===== */
function render(){
  renderBank();
  renderSelection();
  renderSequence();
  renderEvaluation();
  document.getElementById('note').value = note;
}
function renderBank(){
  const bank = document.getElementById('bank');
  bank.innerHTML='';
  bankData.forEach(uv=>{
    const div=document.createElement('div');
    div.className='uv';
    div.innerHTML=`<h3>${uv.uv}</h3>`;
    uv.items.forEach(name=>{
      const e=document.createElement('div');
      e.className='exercise';
      e.innerHTML=`<span>${name}</span>
      <button onclick="addExercise('${name}','${uv.uv}')">‚ûï</button>`;
      div.appendChild(e);
    });
    bank.appendChild(div);
  });
}
function renderSelection(){
  const sel=document.getElementById('selection');
  sel.innerHTML='';
  selection.forEach((ex,i)=>{
    const d=document.createElement('div');
    d.className='exercise';
    d.innerHTML=`
      <span>${ex.name}</span>
      <div>
        <button onclick="moveSel(${i},-1)">‚¨ÜÔ∏è</button>
        <button onclick="moveSel(${i},1)">‚¨áÔ∏è</button>
        <button onclick="removeSel(${i})">‚ùå</button>
      </div>`;
    sel.appendChild(d);
  });
}
function renderSequence(){
  const seq=document.getElementById('sequence');
  seq.innerHTML='';
  sequence.forEach((ex,i)=>{
    const d=document.createElement('div');
    d.className='exercise '+(ex.done?'done':'')+(i===current?' active':'');
    d.innerHTML=`
      <span>${ex.name}</span>
      <div>
        <input type="range" min="1" max="60" value="${ex.duration}"
          onchange="updateDuration(${i},this.value)">
        <span>${ex.duration} min</span>
      </div>`;
    seq.appendChild(d);
  });
}
function renderEvaluation(){
  const evalDiv=document.getElementById('evaluation');
  evalDiv.innerHTML='';
  const uvs=[...new Set(sequence.map(s=>s.uv))];
  uvs.forEach(uv=>{
    const u=bankData.find(b=>b.uv===uv);
    if(!u) return;
    const block=document.createElement('div');
    block.className='uv';
    block.innerHTML=`<h3>${uv}</h3>`;
    u.criteria.forEach(c=>{
      block.innerHTML+=`${c} 
      <input type="range" min="1" max="5"><br>`;
    });
    evalDiv.appendChild(block);
  });
}

/* ===== ACTIONS ===== */
function addExercise(name,uv){
  selection.push({name,uv});
  save();
}
function moveSel(i,d){
  const n=i+d;
  if(n<0||n>=selection.length)return;
  [selection[i],selection[n]]=[selection[n],selection[i]];
  save();
}
function removeSel(i){
  selection.splice(i,1);
  save();
}
function validateSelection(){
  sequence = selection.map(e=>({...e,duration:5,done:false}));
  selection=[];
  current=0;
  speak('Commen√ßons la s√©ance');
  save();
}
function updateDuration(i,v){
  sequence[i].duration=Number(v);
  save();
}

/* ===== LECTURE ===== */
function start(){
  if(!sequence.length)return;
  if(timer)return;
  run();
}
function run(){
  if(current>=sequence.length){
    speak('Fin de l‚Äôentra√Ænement, √† bient√¥t');
    return;
  }
  const ex=sequence[current];
  ex.done=true;
  remaining=ex.duration*60;
  document.getElementById('beep').play();
  speak(`Exercice ${current+1} ${ex.name}`);
  timer=setInterval(()=>{
    remaining--;
    if(remaining<=0){
      clearInterval(timer); timer=null;
      document.getElementById('ding').play();
      current++;
      render();
      run();
    }
  },1000);
}
function pause(){
  clearInterval(timer); timer=null;
}
function stop(){
  clearInterval(timer); timer=null;
  current=0;
  sequence.forEach(e=>e.done=false);
  render();
}

/* ===== UTILS ===== */
function speak(t){
  synth.cancel();
  synth.speak(new SpeechSynthesisUtterance(t));
}
function save(){
  localStorage.setItem('selection',JSON.stringify(selection));
  localStorage.setItem('sequence',JSON.stringify(sequence));
  localStorage.setItem('note',document.getElementById('note').value);
  render();
}

document.getElementById('note').addEventListener('blur',save);
render();
</script>
</body>
</html>
