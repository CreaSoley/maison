<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu â€“ 2e Dan</title>

<style>
body{margin:0;font-family:'Segoe UI',system-ui;background:linear-gradient(to right,#ffecd2,#fcb69f)}
h1,h2,h3{text-align:center}
.container{max-width:1200px;margin:auto;padding:1rem}
.uv{background:linear-gradient(120deg,#84fab0,#8fd3f4);border-radius:20px;padding:1rem;margin-bottom:1rem;box-shadow:0 8px 18px rgba(0,0,0,.15)}
.exercise{background:#fff;border-radius:14px;padding:.6rem;margin:.3rem 0;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,.12)}
.exercise.active{background:#ffe0f0}
.exercise.done{text-decoration:line-through;opacity:.55}
button{border:none;border-radius:18px;padding:.4rem .9rem;margin:.15rem;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.2)}
.progress{width:100%;height:14px;background:#eee;border-radius:10px;overflow:hidden;margin:.4rem 0}
.progress div{height:100%;background:#84fab0;width:0%}
input[type=range]{width:120px}
input[type=text]{padding:.4rem;border-radius:10px;border:none}
#fullscreen{display:none;position:fixed;inset:0;background:#000;color:#fff;z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center}
#fsName{font-size:2rem}
#fsTimer{font-size:5rem;margin:1rem}
</style>
</head>
<body>
<h1>ğŸ¥‹ Coach Tai Jitsu â€“ Passage 2e Dan</h1>

<div class="container">

<h2>ğŸ·ï¸ SÃ©ances</h2>
<input id="sessionName" placeholder="Nom de la sÃ©ance">
<button onclick="saveSession()">ğŸ’¾ Sauvegarder</button>
<select id="sessionSelect" onchange="loadSession()">
<option value="">Charger une sÃ©ance</option>
</select>
<button onclick="deleteSession()">ğŸ—‘ï¸ Supprimer</button>

<h2>ğŸ“‹ Banque dâ€™exercices</h2>
<div id="bank"></div>

<h2>ğŸ§© SÃ©lection</h2>
<div id="selection"></div>
<button onclick="clearSelection()">ğŸ—‘ï¸ Vider</button>
<button onclick="validateSelection()">âœ… Valider la sÃ©ance</button>

<h2>â±ï¸ SÃ©ance active</h2>
<div id="sequence"></div>
<div class="progress"><div id="sessionBar"></div></div>

<h2>ğŸ® Commandes</h2>
<button onclick="startSequence()">â–¶ï¸ Lecture</button>
<button onclick="pauseSequence()">â¸ Pause</button>
<button onclick="stopSequence()">â¹ Stop</button>
<button onclick="openFullscreen()">ğŸ“± Plein Ã©cran</button>

<h2>ğŸ¯ Objectifs par exercice</h2>
<div id="goals"></div>

<h2>ğŸ“Š Historique par exercice</h2>
<div id="history"></div>

<h2>â­ Ã‰valuation de fin de sÃ©ance</h2>
<div id="evaluation"></div>
<button id="evalBtn" style="display:none" onclick="renderEvaluation()">ğŸ“ Ã‰valuer la sÃ©ance</button>

</div>

<div id="fullscreen">
<div id="fsName"></div>
<div id="fsTimer">00:00</div>
<div class="progress" style="width:80%"><div id="fsBar"></div></div>
<button onclick="closeFullscreen()">â¬…ï¸ Quitter</button>
</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
const synth = speechSynthesis;
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function speak(t){synth.cancel();synth.speak(new SpeechSynthesisUtterance(t));}

const bankData=[
 {uv:'ğŸ¥‹ UV1 â€“ Kihon',items:['Kihon simple','EnchaÃ®nement kihon','Cibles'],criteria:['Kime','Zanshin','RÃ©activitÃ©']},
 {uv:'ğŸŒ€ UV2 â€“ DÃ©placements',items:['Tai sabaki','Slow ippon','Ippon kumite'],criteria:['Posture','Vitesse','ContrÃ´le']},
 {uv:'ğŸ“ UV3 â€“ Kata',items:['Slow kata','Kata nidan','BunkaÃ¯'],criteria:['PrÃ©cision','FluiditÃ©','Timing']},
 {uv:'âš™ï¸ UV4 â€“ Technique',items:['Shadow'],criteria:['RÃ©alisme','Zanshin','Protection']},
 {uv:'ğŸ”¥ UV5-6 â€“ Randori',items:['Shadow randori'],criteria:['RÃ©alisme','Zanshin','Protection']}
];

let selection=[];
let activeSession=null;
let sessions=JSON.parse(localStorage.getItem('sessions'))||{};
let goals=JSON.parse(localStorage.getItem('goals'))||{};
let history=JSON.parse(localStorage.getItem('history'))||{};
let index=0,paused=false,stopFlag=false,elapsed=0,totalTime=0;

function render(){renderBank();renderSelection();renderSequence();renderSessions();renderGoals();renderHistory();}

function renderBank(){const b=document.getElementById('bank');b.innerHTML='';bankData.forEach(u=>{const d=document.createElement('div');d.className='uv';d.innerHTML=`<h3>${u.uv}</h3>`;u.items.forEach(n=>{d.innerHTML+=`<div class="exercise">${n}<button onclick="addExercise('${n}','${u.uv}')">â•</button></div>`});b.appendChild(d);});}

function renderSelection(){const s=document.getElementById('selection');s.innerHTML='';selection.forEach((e,i)=>{s.innerHTML+=`<div class="exercise">${e.name}<div><button onclick="moveSel(${i},-1)">â¬†ï¸</button><button onclick="moveSel(${i},1)">â¬‡ï¸</button><button onclick="removeSel(${i})">âŒ</button></div></div>`});}

function renderSequence(){const s=document.getElementById('sequence');s.innerHTML='';if(!activeSession) return;totalTime=activeSession.sequence.reduce((a,b)=>a+b.duration*60,0);activeSession.sequence.forEach((e,i)=>{s.innerHTML+=`<div class="exercise ${i===index?'active':''} ${e.done?'done':''}">${e.name}<input type="range" min="1" max="60" value="${e.duration}" onchange="setDuration(${i},this.value)">${e.duration} min</div>`});}

function renderSessions(){const sel=document.getElementById('sessionSelect');sel.innerHTML='<option value="">Charger une sÃ©ance</option>';Object.keys(sessions).forEach(n=>sel.innerHTML+=`<option>${n}</option>`);}

function renderGoals(){const g=document.getElementById('goals');g.innerHTML='';Object.keys(goals).forEach(n=>{const p=Math.min(100,goals[n].done/goals[n].target*100||0);g.innerHTML+=`<div class="exercise">${n} (${goals[n].done}/${goals[n].target} min)<input type="number" value="${goals[n].target}" onchange="setGoal('${n}',this.value)"><div class="progress"><div style="width:${p}%"></div></div></div>`});}

function renderHistory(){const h=document.getElementById('history');h.innerHTML='';Object.keys(history).forEach(n=>h.innerHTML+=`<p>${n} : ${history[n]} min</p>`);}

function renderEvaluation(){const e=document.getElementById('evaluation');e.innerHTML='';if(!activeSession) return;activeSession.sequence.forEach(ex=>{const uv=bankData.find(u=>u.items.includes(ex.name));e.innerHTML+=`<h4>${ex.name}</h4>`;uv.criteria.forEach(c=>{e.innerHTML+=`${c}<input type="range" min="1" max="5" value="3"><br>`});});}

function addExercise(n,uv){selection.push({name:n,uv});renderSelection();}
function moveSel(i,d){const n=i+d;if(n<0||n>=selection.length)return;[selection[i],selection[n]]=[selection[n],selection[i]];renderSelection();}
function removeSel(i){selection.splice(i,1);renderSelection();}
function clearSelection(){selection=[];renderSelection();}

function validateSelection(){if(!activeSession)return;activeSession.sequence=selection.map(e=>({name:e.name,uv:e.uv,duration:5,done:false}));selection=[];index=0;elapsed=0;save();render();}

function saveSession(){const n=document.getElementById('sessionName').value;if(!n)return;sessions[n]={sequence:[]};activeSession=sessions[n];save();render();}
function loadSession(){const n=document.getElementById('sessionSelect').value;if(!sessions[n])return;activeSession=sessions[n];index=0;elapsed=0;render();}
function deleteSession(){if(!activeSession)return;const k=Object.keys(sessions).find(k=>sessions[k]===activeSession);if(k){delete sessions[k];activeSession=null;save();render();}}

function setDuration(i,v){activeSession.sequence[i].duration=+v;save();}
function setGoal(n,v){if(!goals[n])goals[n]={target:60,done:0};goals[n].target=+v;save();}

async function startSequence(){if(!activeSession||!activeSession.sequence.length)return;paused=false;stopFlag=false;if(index===0){speak('CommenÃ§ons l\'entraÃ®nement');await sleep(1000);}for(;index<activeSession.sequence.length;index++){while(paused)await sleep(200);const ex=activeSession.sequence[index];speak(`Exercice ${index+1} : ${ex.name}`);await sleep(2000);document.getElementById('beep').play();let r=ex.duration*60;while(r>0){if(stopFlag)return;while(paused)await sleep(200);r--;elapsed++;updateBars(ex.name,r);await sleep(1000);}document.getElementById('ding').play();speak('Fin de l\'exercice');ex.done=true;await sleep(1000);}speak('EntraÃ®nement terminÃ©, Ã  bientÃ´t !');document.getElementById('evalBtn').style.display='inline-block';activeSession.sequence.forEach(ex=>{history[ex.name]=(history[ex.name]||0)+ex.duration;if(!goals[ex.name])goals[ex.name]={target:60,done:0};goals[ex.name].done+=ex.duration;});index=0;elapsed=0;save();render();}

function pauseSequence(){paused=true}
function stopSequence(){stopFlag=true;paused=false;index=0;elapsed=0;if(activeSession)activeSession.sequence.forEach(e=>e.done=false);render();}

function updateBars(n,r){document.getElementById('fsName').textContent=n;document.getElementById('fsTimer').textContent=Math.floor(r/60)+':'+String(r%60).padStart(2,'0');const p=totalTime?elapsed/totalTime*100:0;document.getElementById('fsBar').style.width=p+'%';document.getElementById('sessionBar').style.width=p+'%';}

function openFullscreen(){document.getElementById('fullscreen').style.display='flex'}
function closeFullscreen(){document.getElementById('fullscreen').style.display='none'}

function save(){localStorage.setItem('sessions',JSON.stringify(sessions));localStorage.setItem('goals',JSON.stringify(goals));localStorage.setItem('history',JSON.stringify(history));}

render();
</script>
</body>
</html>
