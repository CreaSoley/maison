<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu â€“ 2e Dan</title>
<style>
body{margin:0;font-family:'Segoe UI',system-ui;background:linear-gradient(to right,#ffecd2,#fcb69f)}
h1,h2,h3{text-align:center}
.container{max-width:1100px;margin:auto;padding:1rem}
.uv{background:linear-gradient(120deg,#84fab0,#8fd3f4);border-radius:20px;padding:1rem;margin-bottom:1rem;box-shadow:0 10px 20px rgba(0,0,0,.15)}
.exercise{background:#fff;border-radius:15px;padding:.5rem;margin:.3rem 0;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.exercise.done{text-decoration:line-through;opacity:.5}
.exercise.active{background:#ffe0f0}
button{border:none;border-radius:20px;padding:.4rem .8rem;margin:.1rem;cursor:pointer;box-shadow:0 4px 8px rgba(0,0,0,.2)}
.progress{width:100%;height:18px;background:#eee;border-radius:10px;overflow:hidden;margin-top:4px}
.progress div{height:100%;background:#84fab0;width:0%}
#fullscreen{display:none;position:fixed;inset:0;background:#000;color:#fff;z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center}
#fsName{font-size:2rem}
#fsTimer{font-size:5rem;margin:1rem}
.criteria{margin:.5rem 0}
.criteria label{margin-right:1rem}
input[type=range]{vertical-align:middle}
input[type=number]{width:60px;margin-left:10px}
</style>
</head>
<body>
<h1>ğŸ¥‹ Coach Tai Jitsu â€“ 2e Dan</h1>

<div class="container">
<h2>ğŸ·ï¸ SÃ©ances nommÃ©es</h2>
<input id="sessionName" placeholder="Nom de la sÃ©ance">
<button onclick="saveSession()">ğŸ’¾ Sauvegarder</button>
<select id="sessionSelect" onchange="loadSession()">
  <option value="">Charger une sÃ©ance</option>
</select>

<h2>ğŸ“‹ Banque dâ€™exercices</h2>
<div id="bank"></div>

<h2>ğŸ§© SÃ©lection</h2>
<div id="selection"></div>
<button onclick="clearSelection()">ğŸ—‘ï¸ Vider</button>
<button onclick="validateSelection()">âœ… Valider</button>

<h2>â±ï¸ SÃ©ance</h2>
<div id="sequence"></div>
<div class="progress"><div id="sessionBar"></div></div>

<h2>ğŸ® Commandes</h2>
<button onclick="start()">â–¶ï¸ Lecture</button>
<button onclick="pause()">â¸ Pause</button>
<button onclick="stop()">â¹ Stop</button>
<button onclick="openFullscreen()">ğŸ“± Plein Ã©cran</button>

<h2>ğŸ¯ Objectifs par exercice</h2>
<div id="goals"></div>

<h2>ğŸ“Š Historique par exercice</h2>
<div id="history"></div>

<h2>â­ Ã‰valuation de lâ€™exercice courant</h2>
<div id="criteria"></div>
</div>

<div id="fullscreen">
  <div id="fsName"></div>
  <div id="fsTimer">00:00</div>
  <div class="progress" style="width:80%">
    <div id="fsBar"></div>
  </div>
  <button onclick="closeFullscreen()">â¬…ï¸ Quitter</button>
</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
const synth = speechSynthesis;

// ===== DATA =====
const bankData=[
 {uv:'ğŸ¥‹ UV1 â€“ Kihon',items:['Kihon simple','EnchaÃ®nement','Cibles']},
 {uv:'ğŸŒ€ UV2 â€“ DÃ©placements',items:['Tai sabaki','Slow ippon','Ippon kumite']},
 {uv:'ğŸ“ UV3 â€“ Kata',items:['Slow kata','Kata nidan','BunkaÃ¯']},
 {uv:'âš™ï¸ UV4 â€“ Technique',items:['Shadow']},
 {uv:'ğŸ”¥ UV5&6 â€“ Randori',items:['Shadow randori']}
];

let selection=JSON.parse(localStorage.getItem('selection'))||[];
let sequence=JSON.parse(localStorage.getItem('sequence'))||[];
let sessions=JSON.parse(localStorage.getItem('sessions'))||{};
let history=JSON.parse(localStorage.getItem('history'))||{};
let goals=JSON.parse(localStorage.getItem('goals'))||{};
let evaluations=JSON.parse(localStorage.getItem('evaluations'))||{};

let idx=0,timer=null,remaining=0,totalTime=0,elapsed=0;

// ===== RENDER =====
function render(){
 renderBank();
 renderSelection();
 renderSequence();
 renderSessions();
 renderGoals();
 renderHistory();
 renderCriteria();
}

function renderBank(){
 const b=document.getElementById('bank'); b.innerHTML='';
 bankData.forEach(u=>{
   const d=document.createElement('div'); d.className='uv'; d.innerHTML=`<h3>${u.uv}</h3>`;
   u.items.forEach(n=>{
     d.innerHTML+=`<div class="exercise">${n}<button onclick="add('${n}','${u.uv}')">â•</button></div>`;
   }); b.appendChild(d);
 });
}

function renderSelection(){
 const s=document.getElementById('selection'); s.innerHTML='';
 selection.forEach((e,i)=>{
   s.innerHTML+=`<div class="exercise">${e.name}<div>
     <button onclick="moveSel(${i},-1)">â¬†ï¸</button>
     <button onclick="moveSel(${i},1)">â¬‡ï¸</button>
     <button onclick="removeSel(${i})">âŒ</button>
   </div></div>`;
 });
}

function renderSequence(){
 const s=document.getElementById('sequence'); s.innerHTML='';
 totalTime = sequence.reduce((a,b)=>a+b.duration*60,0);
 sequence.forEach((e,i)=>{
   s.innerHTML+=`<div class="exercise ${e.done?'done':''} ${i===idx?'active':''}">
     ${e.name}
     <input type="range" min="1" max="60" value="${e.duration}" onchange="setDur(${i},this.value)"> ${e.duration} min
   </div>`;
 });
}

function renderSessions(){
 const sel=document.getElementById('sessionSelect');
 sel.innerHTML='<option value="">Charger une sÃ©ance</option>';
 Object.keys(sessions).forEach(n=>{ sel.innerHTML+=`<option>${n}</option>`; });
}

// ===== OBJECTIFS MODIFIABLES =====
function renderGoals(){
  const g = document.getElementById('goals'); 
  g.innerHTML = '';
  Object.keys(goals).forEach(n => {
    if(!goals[n].target) goals[n].target = 60; // valeur par dÃ©faut
    const pct = Math.min(100,goals[n].done / goals[n].target * 100);
    g.innerHTML += `
      <div class="exercise">
        <span>${n} (${goals[n].done}/${goals[n].target} min)</span>
        <input type="number" min="1" max="300" value="${goals[n].target}" 
          onchange="setGoal('${n}', this.value)"> min
        <div class="progress"><div style="width:${pct}%"></div></div>
      </div>
    `;
  });
}

function setGoal(name, value){
  if(!goals[name]) goals[name] = {target:60, done:0};
  goals[name].target = parseInt(value) || 1;
  save();
}

// ===== HISTORIQUE =====
function renderHistory(){
 const h=document.getElementById('history'); h.innerHTML='';
 Object.keys(history).forEach(n=>{ h.innerHTML+=`<p>${n} : ${history[n]} min</p>`; });
}

// ===== Ã‰VALUATION DYNAMIQUE =====
function renderCriteria(){
 const c=document.getElementById('criteria'); c.innerHTML='';
 const e=sequence[idx]; if(!e) return;
 const crit=getCriteriaForExercise(e.name);
 c.innerHTML='<p>'+e.name+'</p>';
 crit.forEach(k=>{
   const val=evaluations[e.name]?(evaluations[e.name][k]||3):3;
   c.innerHTML+=`<div class="criteria"><label>${k}</label>
   <input type="range" min="1" max="5" value="${val}" onchange="setEval('${e.name}','${k}',this.value)"></div>`;
 });
}

function getCriteriaForExercise(name){
 if(['Kihon simple','EnchaÃ®nement','Cibles'].includes(name)) return ['Kime ğŸ’¥','Zanshin ğŸ‘€','RÃ©activitÃ© âš¡'];
 if(['Tai sabaki','Slow ippon','Ippon kumite'].includes(name)) return ['Vitesse âš¡','Posture ğŸ¥‹','ContrÃ´le âœ‹'];
 if(['Slow kata','Kata nidan','BunkaÃ¯'].includes(name)) return ['PrÃ©cision ğŸ¯','FluiditÃ© ğŸŒŠ','Timing â±ï¸'];
 if(['Shadow'].includes(name)) return ['RÃ©alisme','Zanshin','Protection']; // UV4
 if(['Shadow randori'].includes(name)) return ['RÃ©alisme','Zanshin','Protection']; // UV5&6
 return ['Performance'];
}

// ===== ACTIONS =====
function add(n,uv){ selection.push({name:n,uv}); save(); }
function moveSel(i,d){ const n=i+d; if(n<0||n>=selection.length) return; [selection[i],selection[n]]=[selection[n],selection[i]]; save(); }
function removeSel(i){ selection.splice(i,1); save(); }
function clearSelection(){ selection=[]; save(); }
function validateSelection(){ sequence = selection.map(e=>({...e,duration:5,done:false})); selection=[]; idx=0; elapsed=0; save(); }
function setDur(i,v){ sequence[i].duration=+v; save(); }
function setEval(ex,k,v){ if(!evaluations[ex]) evaluations[ex]={}; evaluations[ex][k]=+v; save(); }

// ===== SESSIONS =====
function saveSession(){ const n=document.getElementById('sessionName').value; if(!n) return; sessions[n]=sequence; save(); }
function loadSession(){ const n=document.getElementById('sessionSelect').value; if(sessions[n]){ sequence=JSON.parse(JSON.stringify(sessions[n])); idx=0; elapsed=0; save(); } }

// ===== LECTURE =====
function start(){ if(timer||!sequence.length) return; speak('CommenÃ§ons la sÃ©ance'); run(); }
function run(){ if(idx>=sequence.length){ speak('Fin de lâ€™entraÃ®nement'); saveHistory(); return; }
 const e=sequence[idx]; remaining=e.duration*60; document.getElementById('beep').play(); speak(e.name);
 timer=setInterval(()=>{ remaining--; elapsed++; updateBars(); if(remaining<=0){ clearInterval(timer); timer=null; e.done=true; idx++; render(); run(); } },1000); }
function pause(){ clearInterval(timer); timer=null; }
function stop(){ pause(); idx=0; elapsed=0; sequence.forEach(e=>e.done=false); render(); }

// ===== FULLSCREEN =====
function openFullscreen(){ document.getElementById('fullscreen').style.display='flex'; }
function closeFullscreen(){ document.getElementById('fullscreen').style.display='none'; }
function updateBars(){ document.getElementById('fsName').textContent=sequence[idx]?.name||''; document.getElementById('fsTimer').textContent=Math.floor(remaining/60)+':'+String(remaining%60).padStart(2,'0'); const pct=totalTime?elapsed/totalTime*100:0; document.getElementById('fsBar').style.width=pct+'%'; document.getElementById('sessionBar').style.width=pct+'%'; }

// ===== HISTORIQUE & OBJECTIFS =====
function saveHistory(){
 sequence.forEach(e=>{
   history[e.name]=(history[e.name]||0)+e.duration;
   if(!goals[e.name]) goals[e.name]={target:60,done:0};
   goals[e.name].done+=e.duration;
 });
 save();
}

// ===== UTILS =====
function speak(t){ synth.cancel(); synth.speak(new SpeechSynthesisUtterance(t)); }
function save(){
 localStorage.setItem('selection',JSON.stringify(selection));
 localStorage.setItem('sequence',JSON.stringify(sequence));
 localStorage.setItem('sessions',JSON.stringify(sessions));
 localStorage.setItem('history',JSON.stringify(history));
 localStorage.setItem('goals',JSON.stringify(goals));
 localStorage.setItem('evaluations',JSON.stringify(evaluations));
 render();
}

render();
</script>
</body>
</html>
