<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu</title>

<style>
body{font-family:system-ui;margin:0;background:linear-gradient(to right,#ffecd2,#fcb69f)}
h1{text-align:center;padding:1rem}
.container{max-width:1100px;margin:auto;padding:1rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.panel{background:#fff;border-radius:16px;padding:1rem;box-shadow:0 6px 14px rgba(0,0,0,.15)}
.exercise{background:#f5f5f5;border-radius:10px;padding:.5rem;margin:.3rem 0}
.exercise.active{background:#ffe8b3}
.exercise.done{text-decoration:line-through;opacity:.6}
.controls{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.4rem}
button{border:none;border-radius:8px;padding:.4rem .7rem;cursor:pointer}
input[type=range]{width:120px}
progress{width:100%}

/* Overlay */
#overlay{display:none;position:fixed;inset:0;background:#84fab0;z-index:999;
flex-direction:column;justify-content:center;align-items:center}
#timer{font-size:3rem;margin:1rem}

/* Modal */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
justify-content:center;align-items:center;z-index:1000}
.modal>div{background:#fff;padding:1rem;border-radius:12px;width:90%;max-width:400px}

@media(max-width:768px){
.container{grid-template-columns:1fr}
}
</style>
</head>

<body>
<h1>ğŸ¥‹ Coach Tai Jitsu</h1>

<div class="container">

<div class="panel">
<h2>ğŸ“š Banque</h2>
<div id="bank"></div>
</div>

<div class="panel">
<h2>ğŸ“ SÃ©ance</h2>
<input id="sessionName" placeholder="Nom de la sÃ©ance">

<div id="selection"></div>

<label>Carnet de notes</label>
<textarea id="notes"></textarea>

<h3>ğŸ“Š Ã‰valuation</h3>
<div id="evaluation"></div>

<div class="controls">
<button onclick="startSession()">â–¶ï¸ DÃ©marrer / Reprendre</button>
<button onclick="openGoals()">ğŸ¯ Objectifs</button>
<button onclick="clearSelection()">ğŸ§¹ Vider</button>
</div>

<progress id="progress" value="0" max="100"></progress>
</div>
</div>

<!-- Plein Ã©cran -->
<div id="overlay">
<h1 id="exerciseName"></h1>
<div id="timer">00:00</div>
<progress id="sessionProgress" value="0" max="100"></progress>
<div class="controls">
<button onclick="pauseResume()">â¸ï¸ Pause</button>
<button onclick="toggleOverlay()">âŒ Abandon</button>
</div>
</div>

<!-- Modal Objectifs -->
<div class="modal" id="goalModal">
<div>
<h3>ğŸ¯ Objectifs (minutes / semaine)</h3>
<div id="goalEditor"></div>
<div class="controls">
<button onclick="saveGoals()">ğŸ’¾ Sauvegarder</button>
<button onclick="closeGoals()">Annuler</button>
</div>
</div>
</div>

<script>
/* ===== DATA ===== */
const bankData=[
{uv:'UV1',items:['Kihon','EnchaÃ®nement'],criteria:['PrÃ©cision','Posture']},
{uv:'UV2',items:['TaÃ¯ sabaki','Ippon'],criteria:['FluiditÃ©','Ã‰quilibre']},
{uv:'UV3',items:['Kata','BunkaÃ¯'],criteria:['Exactitude','Kime']}
];

let selection=JSON.parse(localStorage.getItem('sel'))||[];
let goals=JSON.parse(localStorage.getItem('goals'))||{};
let sessions=JSON.parse(localStorage.getItem('sessions'))||{};
let seq=0,timer=null,paused=false,remaining=0,currentSession=null;

/* ===== UTILS ===== */
function speak(t){const u=new SpeechSynthesisUtterance(t);u.lang='fr-FR';speechSynthesis.speak(u)}
function fmt(s){return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0')}

/* ===== BANQUE ===== */
function renderBank(){
const b=document.getElementById('bank');b.innerHTML='';
bankData.forEach(u=>{
b.innerHTML+=`<h4>${u.uv}</h4>`;
u.items.forEach(i=>{
b.innerHTML+=`<div class="exercise">${i}
<button onclick="addEx('${u.uv}','${i}')">â•</button></div>`;
});
});
}

/* ===== SELECTION ===== */
function renderSelection(){
const s=document.getElementById('selection');s.innerHTML='';
selection.forEach((e,i)=>{
s.innerHTML+=`
<div class="exercise ${i<seq?'done':''} ${i===seq?'active':''}">
${e.name}
<input type="range" min="1" max="60" value="${e.duration}"
oninput="setDur(${i},this.value)"> ${e.duration} min
<button onclick="up(${i})">â¬†ï¸</button>
<button onclick="down(${i})">â¬‡ï¸</button>
<button onclick="del(${i})">âŒ</button>
</div>`;
});
renderEval();
renderProgress();
}

/* ===== ACTIONS ===== */
function addEx(uv,name){
selection.push({uv,name,duration:5});
saveSel();
}
function setDur(i,v){selection[i].duration=parseInt(v);saveSel()}
function up(i){if(i>0)[selection[i-1],selection[i]]=[selection[i],selection[i-1]];saveSel()}
function down(i){if(i<selection.length-1)[selection[i+1],selection[i]]=[selection[i],selection[i+1]];saveSel()}
function del(i){selection.splice(i,1);saveSel()}
function saveSel(){localStorage.setItem('sel',JSON.stringify(selection));renderSelection()}
function clearSelection(){selection=[];seq=0;saveSel()}

/* ===== Ã‰VALUATION ===== */
function renderEval(){
const e=document.getElementById('evaluation');e.innerHTML='';
selection.forEach((x,i)=>{
const crit=bankData.find(u=>u.uv===x.uv).criteria;
let html=`<strong>${x.name}</strong><br>`;
crit.forEach(c=>{
html+=`${c}: <input type="range" min="0" max="5" value="0"
oninput="this.nextSibling.textContent=this.value">
<span>0</span><br>`;
});
e.innerHTML+=html;
});
}

/* ===== OBJECTIFS ===== */
function openGoals(){
const g=document.getElementById('goalEditor');g.innerHTML='';
selection.forEach(e=>{
if(!goals[e.name])goals[e.name]=30;
g.innerHTML+=`${e.name} <input type="number" value="${goals[e.name]}"
onchange="goals['${e.name}']=this.value"><br>`;
});
document.getElementById('goalModal').style.display='flex';
}
function closeGoals(){document.getElementById('goalModal').style.display='none'}
function saveGoals(){localStorage.setItem('goals',JSON.stringify(goals));closeGoals()}

/* ===== SESSION ===== */
function startSession(){
if(!currentSession){
currentSession=document.getElementById('sessionName').value||Date.now();
sessions[currentSession]={exercises:selection.map(e=>({...e,done:0}))};
}
next();
}
function next(){
if(seq>=selection.length){toggleOverlay();speak("SÃ©ance terminÃ©e");return}
const ex=selection[seq];
remaining=ex.duration*60;
document.getElementById('exerciseName').textContent=ex.name;
toggleOverlay(true);
speak(`Exercice ${ex.name}`);
clearInterval(timer);
timer=setInterval(()=>{
if(paused)return;
remaining--;
document.getElementById('timer').textContent=fmt(remaining);
renderProgress();
if(remaining<=0){
clearInterval(timer);
sessions[currentSession].exercises[seq].done=ex.duration;
seq++;
next();
}
},1000);
renderSelection();
}

/* ===== UI ===== */
function pauseResume(){paused=!paused}
function toggleOverlay(force){
document.getElementById('overlay').style.display=
(force!==undefined?force:document.getElementById('overlay').style.display==='none')?'flex':'none';
}
function renderProgress(){
document.getElementById('progress').value=(seq/selection.length)*100;
document.getElementById('sessionProgress').value=(seq/selection.length)*100;
}

/* ===== INIT ===== */
renderBank();
renderSelection();
</script>
</body>
</html>
