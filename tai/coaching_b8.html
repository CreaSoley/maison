<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach Tai Jitsu â€“ SÃ©ance + Ã‰valuation</title>

<style>
body{font-family:system-ui,sans-serif;margin:0;background:linear-gradient(to right,#ffecd2,#fcb69f)}
h1{text-align:center;padding:1rem}
.container{max-width:1100px;margin:auto;padding:1rem;display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.panel{background:#fff;border-radius:16px;padding:1rem;box-shadow:0 6px 14px rgba(0,0,0,.15)}
.exercise{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border-radius:10px;margin:.3rem 0;background:#f5f5f5}
.exercise.active{background:#ffe8b3}
.exercise.done{text-decoration:line-through;opacity:.6}
.controls{display:flex;gap:.4rem;flex-wrap:wrap}
button{border:none;border-radius:8px;padding:.4rem .7rem;cursor:pointer}
input[type=text],textarea{width:100%;padding:.6rem;border-radius:10px;border:1px solid #ccc}
input[type=range]{width:120px}
progress{width:100%}

/* Overlay */
#trainingOverlay{
display:none;position:fixed;inset:0;
background:linear-gradient(to right,#84fab0,#8fd3f4);
z-index:999;flex-direction:column;justify-content:center;align-items:center
}
#timer{font-size:4rem;margin:1rem}

/* Modal */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);
justify-content:center;align-items:center;z-index:1000}
.modal>div{background:#fff;border-radius:16px;padding:1rem;max-width:600px;width:100%}

@media(max-width:768px){
.container{grid-template-columns:1fr}
}
</style>
</head>

<body>
<h1>ğŸ¥‹ Coach Tai Jitsu</h1>

<div class="container">

<div class="panel">
<h2>ğŸ“š Banque</h2>
<div id="bank"></div>
</div>

<div class="panel">
<h2>ğŸ“ SÃ©ance</h2>
<input id="sessionName" placeholder="Nom de la sÃ©ance">

<div id="selection"></div>

<label>Carnet de notes</label>
<textarea id="notes"></textarea>

<h3>ğŸ“Š Ã‰valuation</h3>
<div id="evaluation"></div>

<div class="controls">
<button onclick="startSession()">â–¶ï¸ DÃ©marrer / Reprendre</button>
<button onclick="openGoals()">ğŸ¯ Objectifs</button>
<button onclick="showHistory()">ğŸ“Š Historique</button>
<button onclick="clearSelection()">ğŸ§¹ Vider</button>
</div>

<progress id="progress" value="0" max="100"></progress>
<div id="goals"></div>
</div>
</div>

<!-- Plein Ã©cran -->
<div id="trainingOverlay">
<h1 id="exerciseName"></h1>
<div id="timer">00:00</div>
<progress id="sessionProgress" value="0" max="100"></progress>
<div class="controls">
<button onclick="pauseSession()">â¸ï¸ Pause</button>
<button onclick="resumeSession()">â–¶ï¸ Reprendre</button>
<button onclick="toggleFullscreen()">âŒ Quitter</button>
</div>
</div>

<!-- Modal Objectifs -->
<div class="modal" id="goalModal">
<div>
<h2>ğŸ¯ Ã‰diter les objectifs</h2>
<div id="goalEditor"></div>
<div class="controls">
<button onclick="saveGoals()">ğŸ’¾ Sauvegarder</button>
<button onclick="closeGoals()">Annuler</button>
</div>
</div>
</div>

<!-- Modal Historique -->
<div class="modal" id="historyModal">
<div>
<h2>ğŸ“‹ Historique</h2>
<div id="historyList"></div>
<button onclick="closeHistory()">âŒ Fermer</button>
</div>
</div>

<audio id="beep" src="beep.mp3"></audio>
<audio id="ding" src="ding.mp3"></audio>

<script>
/* ===== DONNÃ‰ES ===== */
const bankData=[
{uv:'UV1',items:['Kihon','EnchaÃ®nement'],criteria:['PrÃ©cision','Posture']},
{uv:'UV2',items:['TaÃ¯ sabaki','Ippon'],criteria:['FluiditÃ©','Ã‰quilibre']},
{uv:'UV3',items:['Kata','BunkaÃ¯'],criteria:['Exactitude','Kime']}
];

/* ===== Ã‰TAT ===== */
let selection=JSON.parse(localStorage.getItem('selection'))||[];
let sessions=JSON.parse(localStorage.getItem('sessions'))||{};
let goals=JSON.parse(localStorage.getItem('goals'))||{};
let seqIndex=0,timer=null,paused=false,remaining=0;
let currentSession=null,fullscreen=false;

/* ===== UTIL ===== */
function speak(t,cb){
const u=new SpeechSynthesisUtterance(t);
u.lang='fr-FR';
u.onend=cb;
speechSynthesis.speak(u);
}
function fmt(s){return String(Math.floor(s/60)).padStart(2,'0')+":"+String(s%60).padStart(2,'0')}

/* ===== BANQUE ===== */
function renderBank(){
const b=document.getElementById('bank');b.innerHTML='';
bankData.forEach(u=>{
b.innerHTML+=`<h4>${u.uv}</h4>`;
u.items.forEach(i=>{
b.innerHTML+=`<div class="exercise">${i}
<button onclick="addExercise('${u.uv}','${i}')">â•</button></div>`;
});
});
}

/* ===== SÃ‰LECTION ===== */
function renderSelection(){
const s=document.getElementById('selection');s.innerHTML='';
selection.forEach((e,i)=>{
s.innerHTML+=`
<div class="exercise ${i<seqIndex?'done':''} ${i===seqIndex?'active':''}">
${e.name}
<input type="range" min="1" max="60" value="${e.duration}"
oninput="setDuration(${i},this.value)"> ${e.duration} min
<button onclick="moveUp(${i})">â¬†ï¸</button>
<button onclick="moveDown(${i})">â¬‡ï¸</button>
<button onclick="removeExercise(${i})">âŒ</button>
</div>`;
});
renderEvaluation();
renderGoals();
updateProgress();
}

/* ===== ACTIONS ===== */
function addExercise(uv,name){selection.push({uv,name,duration:5});save()}
function setDuration(i,v){selection[i].duration=parseInt(v);save()}
function moveUp(i){if(i>0)[selection[i-1],selection[i]]=[selection[i],selection[i-1]];save()}
function moveDown(i){if(i<selection.length-1)[selection[i+1],selection[i]]=[selection[i],selection[i+1]];save()}
function removeExercise(i){selection.splice(i,1);save()}
function save(){localStorage.setItem('selection',JSON.stringify(selection));renderSelection()}
function clearSelection(){selection=[];seqIndex=0;save()}

/* ===== Ã‰VALUATION ===== */
function renderEvaluation(){
const e=document.getElementById('evaluation');e.innerHTML='';
selection.forEach((x,i)=>{
const crit=bankData.find(u=>u.uv===x.uv).criteria;
let html=`<strong>${x.name}</strong><br>`;
crit.forEach(c=>{
html+=`${c}: <input type="range" min="0" max="5" value="0"
oninput="this.nextSibling.textContent=this.value">
<span>0</span><br>`;
});
e.innerHTML+=html;
});
}

/* ===== OBJECTIFS ===== */
function renderGoals(){
const g=document.getElementById('goals');g.innerHTML='';
selection.forEach(e=>{
if(!goals[e.name])goals[e.name]=30;
let done=0;
Object.values(sessions).forEach(s=>{
s.exercises?.forEach(x=>{if(x.name===e.name)done+=x.done});
});
const pct=Math.min(100,Math.round(done/goals[e.name]*100));
g.innerHTML+=`<strong>${e.name}</strong>
<progress value="${pct}" max="100"></progress>${pct}%`;
});
}
function openGoals(){
const g=document.getElementById('goalEditor');g.innerHTML='';
selection.forEach(e=>{
g.innerHTML+=`${e.name} :
<input type="number" value="${goals[e.name]||30}"
onchange="goals['${e.name}']=this.value"><br>`;
});
document.getElementById('goalModal').style.display='flex';
}
function closeGoals(){document.getElementById('goalModal').style.display='none'}
function saveGoals(){localStorage.setItem('goals',JSON.stringify(goals));closeGoals();renderGoals()}

/* ===== ENTRAÃNEMENT ===== */
function startSession(){
if(!currentSession){
currentSession=document.getElementById('sessionName').value||Date.now();
sessions[currentSession]={exercises:selection.map(e=>({...e,done:0})),notes:document.getElementById('notes').value};
speak("CommenÃ§ons l'entraÃ®nement",nextExercise);
}else nextExercise();
}
function nextExercise(){
if(seqIndex>=selection.length){
speak("EntraÃ®nement terminÃ©");
toggleFullscreen(false);
return;
}
const ex=selection[seqIndex];
document.getElementById('exerciseName').textContent=ex.name;
remaining=ex.duration*60;
toggleFullscreen(true);
speak(`Exercice ${seqIndex+1} : ${ex.name}`,()=>{
document.getElementById('beep').play();
timer=setInterval(()=>{
if(paused)return;
remaining--;
document.getElementById('timer').textContent=fmt(remaining);
updateProgress();
if(remaining<=0){
clearInterval(timer);
document.getElementById('ding').play();
sessions[currentSession].exercises[seqIndex].done=ex.duration;
seqIndex++;
nextExercise();
}
},1000);
});
}

/* ===== CONTROLES ===== */
function pauseSession(){paused=true}
function resumeSession(){paused=false}
function toggleFullscreen(force){
fullscreen=force!==undefined?force:!fullscreen;
document.getElementById('trainingOverlay').style.display=fullscreen?'flex':'none';
}
function updateProgress(){
document.getElementById('progress').value=(seqIndex/selection.length)*100;
document.getElementById('sessionProgress').value=(seqIndex/selection.length)*100;
}

/* ===== HISTORIQUE ===== */
function showHistory(){
const h=document.getElementById('historyList');h.innerHTML='';
Object.keys(sessions).forEach(n=>{
const s=sessions[n];
h.innerHTML+=`<strong>${n}</strong><br>`;
s.exercises.forEach(e=>h.innerHTML+=`- ${e.name}: ${e.done} min<br>`);
h.innerHTML+='<br>';
});
document.getElementById('historyModal').style.display='flex';
}
function closeHistory(){document.getElementById('historyModal').style.display='none'}

/* ===== INIT ===== */
renderBank();
renderSelection();
</script>
</body>
</html>
