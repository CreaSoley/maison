<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>Ippon Kumite ‚Äì Tai Jitsu</title>

  <!-- CSS principal -->
  <link rel="stylesheet" href="style-ippon.css">

  <!-- banni√®re -->
  <link rel="stylesheet" href="../banner.css">

  <!-- Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- police Shanghai -->
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">

  <!-- kawaii + responsive -->
  <style>

  /* ---------------------- BANNI√àRE ------------------------ */

  .header-text .title{
    font-size:2.4rem;
  }

  @media(max-width:600px){
    .header-text .title{
      font-size:1.4rem;
      line-height:1.2;
    }
  }

  .header-text .subtitle{
    font-family:"Ma Shan Zheng", cursive;
  }

  /* ---------------------- LAYOUT ------------------------ */

  body{
    background:#fff5fb;
    margin:0;
    font-family:Arial, sans-serif;
  }

  .layout{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
    padding:16px;
  }

  @media(max-width:900px){
    .layout{
      grid-template-columns:1fr;
    }
  }

  /* ---------------------- CARD KAWAII ------------------------ */

  .card{
    background:#fff2fb;
    border-radius:22px;
    padding:18px;
    border:2px solid #ffbde9;
    box-shadow:0 10px 18px rgba(255,126,190,.25);
  }

  .card h2{
    margin-top:0;
    color:#ff2f9a;
    text-shadow:0 2px 4px rgba(255,0,120,.2);
  }

  select,
  input,
  button{
    border-radius:999px;
    border:2px solid #ffc9ef;
    background:#fff7fd;
    padding:8px 12px;
  }

  button{
    background:#ffbde9;
    font-weight:bold;
    cursor:pointer;
  }

  /* ---------------------- VIDEO RESPONSIVE ------------------------ */

  .video-wrapper{
    position:relative;
    width:100%;
    padding-top:56.25%;
  }

  .video-wrapper iframe{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    border:none;
  }

  /* ---------------------- ACCORD√âON ------------------------ */

  .accordion-item{
    background:white;
    border-radius:18px;
    margin:8px 0;
    border:2px solid #ffd2f0;
  }

  .accordion-header{
    padding:10px 14px;
    font-weight:bold;
    cursor:pointer;
  }

  .accordion-content{
    display:none;
    padding:10px 14px;
  }

  </style>

</head>

<body data-title="Ippon Kumite ‚Äì Entra√Ænement">

<!-- banni√®re charg√©e -->
<div id="bannerContainer"></div>

<script>
fetch("../banner.html")
.then(r=>r.text())
.then(html=>{
  document.getElementById("bannerContainer").innerHTML = html;

  let pageTitle =
    document.body.dataset.title ||
    document.querySelector("h1")?.textContent ||
    document.querySelector("title")?.textContent || "";

  const target=document.querySelector(".header-text .title");
  if(target) target.textContent=pageTitle;
});
</script>

<!-- ‚≠ê BOUTONS FICHES PDF -->
<section class="top-banner card">
  <h2>üìö Fiches d'entra√Ænement</h2>

  <button onclick="window.open('../F1.pdf')">Fiche 1</button>
  <button onclick="window.open('../F2.pdf')">Fiche 2</button>
  <button onclick="window.open('../F3.pdf')">Fiche 3</button>
  <button onclick="window.open('../F4.pdf')">Fiche 4</button>
  <button onclick="window.open('../F5.pdf')">Fiche 5</button>
  <button onclick="window.open('../F6.pdf')">Fiche 6</button>
</section>

<!-- ===================== 4 ENCARTS ====================== -->

<main class="layout">

<!-- 1) ACCORD√âON TECHNIQUES PAR C√îT√â -->
<section class="card">
  <h2>ü•ã Techniques par c√¥t√©</h2>

  <select id="selectSerieAccordion">
    <option value="">Choisir une s√©rie</option>
  </select>

  <select id="filterSideAccordion">
    <option value="">Choisir un c√¥t√©</option>
    <option value="droite">Droite</option>
    <option value="gauche">Gauche</option>
  </select>

  <div id="accordionList"></div>
</section>

<!-- 2) FICHE TECHNIQUE -->
<section class="card">
  <h2>üí´ Fiche technique</h2>

  <select id="selectSerie">
    <option value="">Choisir une s√©rie</option>
  </select>

  <select id="selectAttack">
    <option value="">Choisir une attaque</option>
  </select>

  <select id="selectSide">
    <option value="">Choisir un c√¥t√©</option>
    <option value="droite">Droite</option>
    <option value="gauche">Gauche</option>
  </select>

  <div id="resultCard"></div>
</section>

<!-- 3) ACCORD√âON PNG FICHES -->
<section class="card">
  <h2>üßæ Fiches de travail (images)</h2>

  <select id="imageSide">
    <option value="">Choisir un c√¥t√©</option>
    <option value="droite">Droite</option>
    <option value="gauche">Gauche</option>
  </select>

  <div id="imageAccordion"></div>
</section>

<!-- 4) ENTRA√éNEMENT VOCAL -->
<section class="card">
  <h2>üé§ Entra√Ænement vocal al√©atoire</h2>

  <label>‚è±Ô∏è Intervalle (secondes)</label>
  <input type="range" id="rangeTime" min="3" max="60" value="10">
  <span id="timeValue">10s</span>

  <br><br>

  <button id="start">üöÄ Lancer</button>
  <button id="stop">üõë Stop</button>
</section>

</main>

<!-- ================= SCRIPTS =================== -->

<script>
/* ===== JSON SIMPLIFI√â (tu remplaces par fetch plus tard si tu veux) ===== */
const data = [
  {"serie":1,"attaque":"Oi Tsuki Jodan","cote":"droite","tai sabaki":"ext√©rieur","blocage":"age uke","defense":"empi","video":"https://www.youtube.com/embed/Rp1drfqOMKY"},
  {"serie":1,"attaque":"Oi Tsuki Jodan","cote":"gauche","tai sabaki":"esquive","blocage":"age uke","defense":"mae geri","video":"https://www.youtube.com/embed/W1C3zZQ4KtQ"}
];

/* ---------- remplir selects s√©rie ---------- */
let series=[...new Set(data.map(x=>x.serie))];
for(let s of series){
  document.querySelectorAll("#selectSerie,#selectSerieAccordion").forEach(sel=>{
    const o=document.createElement("option");
    o.value=s;o.textContent="S√©rie "+s;
    sel.appendChild(o);
  });
}

/* ---------- ACCORD√âON 1 ---------- */
document.getElementById("selectSerieAccordion").onchange =
document.getElementById("filterSideAccordion").onchange = function(){
  const serie = document.getElementById("selectSerieAccordion").value;
  const side = document.getElementById("filterSideAccordion").value;

  let list = data.filter(x=>(!serie||x.serie==serie)&&(!side||x.cote==side));

  const container=document.getElementById("accordionList");
  container.innerHTML="";

  list.forEach(item=>{
    const wrap=document.createElement("div");
    wrap.className="accordion-item";

    wrap.innerHTML=`
      <div class="accordion-header">${item.attaque} (${item.cote})</div>
      <div class="accordion-content">
        Tai sabaki : ${item["tai sabaki"]}<br>
        Blocage : ${item.blocage}<br>
        D√©fense : ${item.defense}
        <div class="video-wrapper"><iframe src="${item.video}"></iframe></div>
      </div>
    `;

    wrap.querySelector(".accordion-header").onclick=()=>{
      const c = wrap.querySelector(".accordion-content");
      c.style.display = c.style.display==="block" ? "none":"block";
    };

    container.appendChild(wrap);
  });
};

/* ---------- FICHE TECHNIQUE ---------- */
document.getElementById("selectSerie").onchange = function(){
  const s=this.value;
  const attacks=[...new Set(data.filter(x=>x.serie==s).map(x=>x.attaque))];
  const sel=document.getElementById("selectAttack");
  sel.innerHTML=`<option value="">Choisir une attaque</option>`;
  attacks.forEach(a=>{
    const o=document.createElement("option");
    o.value=a;o.textContent=a;sel.appendChild(o);
  });
};

document.querySelectorAll("#selectAttack,#selectSide").forEach(el=>{
  el.onchange=function(){
    const serie=document.getElementById("selectSerie").value;
    const atk=document.getElementById("selectAttack").value;
    const side=document.getElementById("selectSide").value;

    let res=data.find(x=>x.serie==serie&&x.attaque==atk&&x.cote==side);
    if(!res){document.getElementById("resultCard").innerHTML="";return;}

    document.getElementById("resultCard").innerHTML=`
      <p>${res.attaque} ‚Äî ${res.cote}</p>
      <p><b>Tai sabaki :</b> ${res["tai sabaki"]}</p>
      <p><b>Blocage :</b> ${res.blocage}</p>
      <p><b>D√©fense :</b> ${res.defense}</p>
      <div class="video-wrapper"><iframe src="${res.video}"></iframe></div>
    `;
  };
});

/* ---------- ACCORD√âON IMAGES PNG ---------- */
const imageTechniques = [
  {name:"Oi tsuki jodan", file:"otjd.png", cote:"droite"},
];

document.getElementById("imageSide").onchange=function(){
  let side=this.value;
  const cont=document.getElementById("imageAccordion");
  cont.innerHTML="";

  imageTechniques
    .filter(x=>!side||x.cote==side)
    .forEach(img=>{
      const div=document.createElement("div");
      div.className="accordion-item";
      div.innerHTML=`
        <div class="accordion-header">${img.name}</div>
        <div class="accordion-content">
          <img src="../${img.file}" style="width:100%;border-radius:18px">
        </div>`;
      div.querySelector(".accordion-header").onclick=()=>{
        const c=div.querySelector(".accordion-content");
        c.style.display=c.style.display==="block"?"none":"block";
      };
      cont.appendChild(div);
    });
};

/* ---------- ENTRA√éNEMENT VOCAL ---------- */
const synth=window.speechSynthesis;
let interval=null;

const techniques = [
 "Oi tsuki jodan",
 "Oi tsuki chudan",
 "Gyaku tsuki",
 "Mae geri",
 "Mawashi geri",
 "Yoko geri",
 "Uchi uke",
 "Soto uke",
 "Age uke",
 "Gedan barai"
];

document.getElementById("rangeTime").oninput=function(){
  document.getElementById("timeValue").textContent=this.value+"s";
};

document.getElementById("start").onclick=function(){
  if(interval) return;
  setTimeout(()=>{
    interval=setInterval(()=>{
      let t=techniques[Math.floor(Math.random()*techniques.length)];
      let u=new SpeechSynthesisUtterance(t);
      u.lang="fr-FR";
      synth.speak(u);
    }, document.getElementById("rangeTime").value*1000);
  },5000);
};

document.getElementById("stop").onclick=function(){
  clearInterval(interval);
  interval=null;
  synth.cancel();
};
</script>

</body>
</html>
