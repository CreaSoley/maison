<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ippon Kumite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FONTS -->
<style>
@font-face {
  font-family:"Spicy";
  src:url("../Spicy Sale.ttf") format("truetype");
}
@font-face {
  font-family:"Shanghai";
  src:url("../Shanghai.ttf") format("truetype");
}
@font-face {
  font-family:"SuperMeatball";
  src:url("../SuperMeatball.ttf") format("truetype");
}

body{
  font-family:"Fredoka", Arial, sans-serif;
  background:#fff3fc;
  margin:0;
}

/* ---------------------- BANNI√àRE ------------------------- */

.appbar{
  background:black;
  color:white;
  padding:20px 10px;
  text-align:center;
}

.appbar img{
  width:110px;
}

.title{
  font-family:"Spicy", cursive;
  font-size:2.2rem;
  color:#ffd6ec;
}

.subtitle{
  font-family:"Shanghai", cursive;
  font-size:1.4rem;
  color:#ffd0ec;
}

@media(max-width:600px){
  .title{font-size:1.6rem;}
  .subtitle{font-size:1.1rem;}
}

/* ---------------------- LAYOUT ------------------------- */

.container{
  max-width:1100px;
  margin:auto;
  padding:10px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}

@media(max-width:800px){
  .grid{grid-template-columns:1fr;}
}

/* ---------------------- CARDS -------------------------- */

.card{
  background:white;
  border-radius:22px;
  padding:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}

.card h3{
  color:#ff5fa2;
  margin-top:0;
  font-family:"SuperMeatball", cursive;
}

/* ---------------------- ACCORDEON ---------------------- */

.accordion-item{
  background:#ffe3f5;
  padding:10px;
  border-radius:18px;
  margin:7px 0;
}

.accordion-title{
  font-weight:bold;
  cursor:pointer;
}

.accordion-content{
  display:none;
  padding-top:8px;
}

/* ---------------------- FORM & BUTTONS ------------------ */

button{
  border:none;
  padding:10px 18px;
  border-radius:20px;
  background:#ff7cbc;
  color:white;
  cursor:pointer;
}

button:hover{background:#ff9fd0;}

input[type=number],
select{
  border-radius:18px;
  padding:6px 10px;
  border:1px solid #ffc5e9;
}

input[type=range]{width:100%;}

.output{
  background:#fff7fd;
  border-radius:14px;
  padding:10px;
  min-height:60px;
  margin-top:10px;
}

.badge{
  background:#ffd9f4;
  padding:3px 7px;
  border-radius:10px;
  font-size:.8rem;
}

/* ------ images fiches ------ */
.fiche-img{
  width:100%;
  border-radius:18px;
}
</style>
</head>

<body>

<!-- ================= BANNI√àRE ================= -->
<header class="appbar">
  <a href="../index.html">
    <img src="../logo.png" alt="logo">
  </a>
  <div class="title">IPPON KUMITE</div>
  <div class="subtitle">Entra√Ænement interactif</div>
</header>

<div class="container">

<div class="grid">

<!-- ================= ENCARt 1 ================= -->
<div class="card">
  <h3>üìö Techniques d√©taill√©es (JSON)</h3>
  <div id="encart1"></div>
</div>

<!-- ================= ENCARt 2 ================= -->
<div class="card">
  <h3>üé§ Entra√Ænement vocal par s√©rie</h3>

  S√©rie :
  <select id="serieSelect"></select><br><br>

  R√©p√©ter la s√©rie :
  <input type="number" id="repeatCount" value="1" min="1" max="20"><br><br>

  ‚è±Ô∏è Temps entre lectues :
  <input type="range" id="tempo" min="5" max="60" value="10">
  <span id="tempoValue">10</span> s<br><br>

  üéôÔ∏è Voix :
  <select id="voiceType">
    <option value="female">F√©minine</option>
    <option value="male">Masculine</option>
  </select><br><br>

  <label>
    <input type="checkbox" id="kawaiiSound"> üéµ sons kawaii
  </label><br><br>

  <button id="startBtn">‚ñ∂Ô∏è Lancer</button>
  <button id="pauseBtn">‚è∏Ô∏è Pause</button>
  <button id="stopBtn">‚õî Stop</button>

  <div class="output" id="displayText"></div>
</div>

<!-- ================= ENCARt 3 ================= -->
<div class="card">
  <h3>üñºÔ∏è Fiches de travail (accord√©on)</h3>

  Filtrer par c√¥t√© :
  <select id="filterSide">
    <option value="all">Tous</option>
    <option value="gauche">Gauche</option>
    <option value="droite">Droite</option>
  </select>

  <div id="ficheZone"></div>
</div>

<!-- ================= ENCARt 4 ================= -->
<div class="card">
  <h3>üéß Entra√Ænement al√©atoire continu</h3>

  ‚è±Ô∏è rythme :
  <input type="range" id="randTempo" min="3" max="60" value="6">
  <span id="randTempoValue">6</span> s<br><br>

  <button id="randStart">üöÄ D√©marrer</button>
  <button id="randStop">üõë Arr√™ter</button>

  <div class="output" id="randDisplay"></div>
</div>

</div>
</div>

<!-- ================= JAVASCRIPT ================= -->
<script>

/* ---------- UTIL VOIX ---------- */
function speak(text, lang, gender="female"){
  let u=new SpeechSynthesisUtterance(text);
  u.lang=lang;

  // choix simple masculin/f√©minin
  let voices=speechSynthesis.getVoices();
  let voice = voices.find(v=>
     gender==="female" ? v.name.toLowerCase().includes("f") :
                         v.name.toLowerCase().includes("m")
  );
  if(voice) u.voice=voice;
  speechSynthesis.speak(u);
}

/* ---------- ENCARt 1 ---------- */

fetch("ippon/ippon.json")
.then(r=>r.json())
.then(data=>{
  const zone=document.getElementById("encart1");
  let html="";
  data.forEach(t=>{
    html+=`
      <div class="accordion-item">
        <div class="accordion-title">${t.attaque} ‚Äî <span class="badge">${t.cote}</span></div>
        <div class="accordion-content">
          Tai sabaki : ${t["tai sabaki"]}<br>
          Blocage : ${t.blocage}<br>
          D√©fense : ${t.defense}<br>
          <iframe width="100%" height="180" src="${t.video}" allowfullscreen></iframe>
        </div>
      </div>
    `;
  });
  zone.innerHTML=html;

  document.querySelectorAll(".accordion-title").forEach(t=>{
    t.onclick=()=>{
      let c=t.nextElementSibling;
      c.style.display=c.style.display==="block"?"none":"block";
    }
  });
});

/* ---------- ENCARt 3 : FICHES PNG ---------- */

const fiches = [
  {nom:"Oi tsuki jodan", cote:"gauche", img:"otjd.png"},
];

function buildFiches(){
  const f=document.getElementById("filterSide").value;
  const zone=document.getElementById("ficheZone");
  zone.innerHTML="";
  fiches.forEach(x=>{
    if(f!=="all" && x.cote!==f) return;
    zone.innerHTML+=`
      <div class="accordion-item">
        <div class="accordion-title">${x.nom} ‚Äî ${x.cote}</div>
        <div class="accordion-content">
          <img class="fiche-img" src="ippon/${x.img}">
        </div>
      </div>`;
  });
  document.querySelectorAll("#ficheZone .accordion-title").forEach(t=>{
    t.onclick=()=>{
      let c=t.nextElementSibling;
      c.style.display=c.style.display==="block"?"none":"block";
    };
  });
}
buildFiches();
document.getElementById("filterSide").onchange=buildFiches;

/* ---------- ENCARt 2 : ENTRA√éNEMENT PAR S√âRIE ---------- */

let vocalData=[];
let playing=false;
let paused=false;
let timeoutId;

fetch("ippon/ipponvocal.json")
.then(r=>r.json())
.then(data=>{
  vocalData=data;
  const select=document.getElementById("serieSelect");
  [...new Set(data.map(x=>x["S√©rie"]))].forEach(s=>{
    let o=document.createElement("option");
    o.value=s;
    o.textContent="S√©rie "+s;
    select.appendChild(o);
  });
});

document.getElementById("tempo").oninput=e=>{
  document.getElementById("tempoValue").innerText=e.target.value;
};

document.getElementById("startBtn").onclick=()=>{

  if(playing) return;

  playing=true;
  paused=false;

  const serie=parseInt(serieSelect.value);
  const repeat=parseInt(repeatCount.value);
  const tempo=parseInt(tempo.value)*1000;
  const gender=voiceType.value;

  const L=vocalData.filter(x=>x["S√©rie"]===serie && x["C√¥t√©"]==="gauche");
  const R=vocalData.filter(x=>x["S√©rie"]===serie && x["C√¥t√©"]==="droite");

  let seq=[];

  for(let n=0;n<repeat;n++){
    seq.push(["fr","Commen√ßons l'entra√Ænement"]);
    seq.push(["fr","c√¥t√© gauche"]);
    L.forEach(t=>{
      seq.push(["ja",t.Assaut]);
      seq.push(["fr","intitul√© blocage"]);
      seq.push(["ja",t.blocage]);
      seq.push(["fr","intitul√© contre"]);
      seq.push(["ja",t.contre]);
    });
    seq.push(["fr","c√¥t√© droit"]);
    R.forEach(t=>{
      seq.push(["ja",t.Assaut]);
      seq.push(["fr","intitul√© blocage"]);
      seq.push(["ja",t.blocage]);
      seq.push(["fr","intitul√© contre"]);
      seq.push(["ja",t.contre]);
    });
  }

  seq.push(["fr","fin de l'entra√Ænement"]);

  let i=0;

  function step(){
    if(!playing) return;
    if(paused){timeoutId=setTimeout(step,400);return;}

    const [lang,text]=seq[i++];
    document.getElementById("displayText").innerText=text;

    if(lang==="ja") speak(text,"ja-JP",gender);
    else speak(text,"fr-FR",gender);

    if(i<seq.length) timeoutId=setTimeout(step,tempo);
    else playing=false;
  }

  setTimeout(step,2000);
};

document.getElementById("pauseBtn").onclick=()=>{
  paused=!paused;
  paused? speechSynthesis.pause():speechSynthesis.resume();
};

document.getElementById("stopBtn").onclick=()=>{
  playing=false;
  paused=false;
  clearTimeout(timeoutId);
  speechSynthesis.cancel();
  displayText.innerText="";
};

/* ---------- ENCARt 4 ALEATOIRE ---------- */

document.getElementById("randTempo").oninput=e=>{
  randTempoValue.innerText=e.target.value;
};

let randRun=false;

document.getElementById("randStart").onclick=()=>{
  randRun=true;
  speak("Pr√©pare toi","fr-FR");
  setTimeout(loop,5000);

  function loop(){
    if(!randRun) return;
    const tech=["Oi tsuki","Mae geri","Mawashi geri","Gyaku tsuki"];
    const t=tech[Math.floor(Math.random()*tech.length)];
    randDisplay.innerText=t;
    speak(t,"ja-JP");
    setTimeout(loop,parseInt(randTempo.value)*1000);
  }
};

document.getElementById("randStop").onclick=()=>{
  randRun=false;
  randDisplay.innerText="";
  speechSynthesis.cancel();
};

</script>

</body>
</html>
