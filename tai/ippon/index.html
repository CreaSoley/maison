<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Ippon Kumite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FONTS -->
<style>
@font-face {
  font-family:"Shanghai";
  src:url("../shanghai.ttf") format("truetype");
}

@font-face {
  font-family:"Spicy";
  src:url("../Spicy Sale.ttf") format("truetype");
}

@font-face {
  font-family:"SuperMeatball";
  src:url("../SuperMeatball.ttf") format("truetype");
}

body{
  font-family:"Fredoka", Arial, sans-serif;
  background:#fff3fc;
  margin:0;
}

/* ---------------------- BANNIERE ---------------------- */
.appbar{
  background:black;
  color:white;
  padding:20px 10px;
  text-align:center;
}

.appbar img{
  width:110px;
}

.title{
  font-family:"Spicy";
  font-size:2.4rem;
  color:#ffd6ec;
}

.subtitle{
  font-family:"Shanghai";
  font-size:1.5rem;
  color:#ffd0ec;
}

@media(max-width:600px){
  .title{font-size:1.6rem;}
  .subtitle{font-size:1.1rem;}
}

/* ---------------------- LAYOUT ---------------------- */
.container{
  max-width:1400px;            
  margin:auto;
  padding:15px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

@media(max-width:800px){
  .grid{grid-template-columns:1fr;}
}

/* ---------------------- CARDS ---------------------- */
.card{
  background:white;
  border-radius:22px;
  padding:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}

.card h3{
  color:#ff5fa2;
  margin-top:0;
  font-family:"SuperMeatball";
}

/* ---------------------- ACCORDEON ---------------------- */
.accordion-item{
  background:#ffe3f5;
  padding:10px;
  border-radius:18px;
  margin:7px 0;
}

.accordion-title{
  font-weight:bold;
  cursor:pointer;
}

.accordion-content{
  display:none;
  padding-top:8px;
}

/* ---------------------- FORM / STATE ---------------------- */
.state{
  padding:8px 10px;
  background:#fff0fb;
  border-radius:15px;
  margin-top:8px;
  font-size:.9rem;
}

button{
  border:none;
  padding:10px 18px;
  border-radius:22px;
  background:#ff7cbc;
  color:white;
  cursor:pointer;
  margin:4px 2px;
}

button:hover{background:#ff9fd0;}

input, select{
  border-radius:18px;
  padding:6px 10px;
  border:1px solid #ffb7e3;
}

input[type=range]{width:100%;}

/* fiches PNG */
.fiche-img{
  width:100%;
  border-radius:16px;
  margin-top:8px;
}

/* MOBILE FILTRES */
@media(max-width:600px){
  .card select, .card input{
    display:block;
    margin-bottom:8px;
  }
}
</style>
</head>

<body>

<header class="appbar">
  <a href="../index.html"><img src="../logo.png" alt="logo"></a>
  <div class="title">IPPON KUMITE</div>
  <div class="subtitle">Entra√Ænement interactif</div>
</header>

<!-- FICHES PDF SOUS BANNIERE -->
<div class="container">
  <div style="margin:15px 0; text-align:center;">
    <button onclick="window.open('tai/fiche1.pdf','_blank')">Fiche 1</button>
    <button onclick="window.open('tai/fiche2.pdf','_blank')">Fiche 2</button>
    <button onclick="window.open('tai/fiche3.pdf','_blank')">Fiche 3</button>
    <button onclick="window.open('tai/fiche4.pdf','_blank')">Fiche 4</button>
    <button onclick="window.open('tai/fiche5.pdf','_blank')">Fiche 5</button>
  </div>
</div>

<div class="container">

<div class="grid">

<!-- ============ ENCARt 1 ================= -->
<div class="card">
  <h3>üìö Techniques d√©taill√©es</h3>

  S√©rie :
  <select id="fSerie"></select>

  C√¥t√© :
  <select id="fCote">
    <option value="">Tous</option>
    <option value="gauche">Gauche</option>
    <option value="droite">Droite</option>
  </select>

  <div id="encart1note" class="state">
    üîé Choisis une s√©rie et/ou un c√¥t√©
  </div>

  <div id="encart1"></div>
</div>

<!-- ============ ENCARt 2 ================= -->
<div class="card">
  <h3>üé§ Entra√Ænement vocal (s√©ries compl√®tes)</h3>

  S√©rie :
  <select id="serieSelect"></select><br><br>

  R√©p√©ter :
  <input type="number" id="repeatCount" value="1" min="1" max="20"><br><br>

  ‚è±Ô∏è D√©lai entre assauts :
  <input type="range" id="tempo" min="5" max="60" value="8">
  <span id="tempoValue">8</span>s<br><br>

  Voix :
  <select id="voiceType">
    <option value="female">F√©minine</option>
    <option value="male">Masculine</option>
  </select><br><br>

  <button id="startBtn">‚ñ∂Ô∏è Lancer</button>
  <button id="pauseBtn">‚è∏Ô∏è Pause</button>
  <button id="stopBtn">‚õî Stop</button>

  <div id="vocalState" class="state">‚õî En attente</div>

  <div class="output" id="displayText"></div>
</div>

<!-- ============ ENCARt 3 ================= -->
<div class="card">
  <h3>üñºÔ∏è Fiches PNG</h3>

  C√¥t√© :
  <select id="filterSide">
    <option value="all">Tous</option>
    <option value="gauche">Gauche</option>
    <option value="droite">Droite</option>
  </select>

  Technique :
  <select id="filterTechnique">
    <option value="all">Toutes</option>
  </select>

  <div id="ficheZone"></div>
</div>

<!-- ============ ENCARt 4 ================= -->
<div class="card">
  <h3>üéß Entra√Ænement al√©atoire continu</h3>

  Rythme :
  <input type="range" id="randTempo" min="3" max="60" value="6">
  <span id="randTempoValue">6</span>s<br><br>

  <button id="randStart">üöÄ D√©marrer</button>
  <button id="randStop">üõë Arr√™ter</button>

  <div id="randState" class="state">‚õî arr√™t</div>

  <div class="output" id="randDisplay"></div>
</div>

</div>
</div>

<script>
/* ---------------- SPEECH HELP ---------------- */
function speak(text, lang="fr-FR", gender="female"){
  const u=new SpeechSynthesisUtterance(text);
  u.lang=lang;

  const voices=speechSynthesis.getVoices();
  if(voices.length>0){
    const found=voices.find(v=>
      gender==="female"
        ? v.name.toLowerCase().includes("f")
        : v.name.toLowerCase().includes("m")
    );
    if(found) u.voice=found;
  }
  speechSynthesis.speak(u);
}

/* ------------ ENCARt 1 -------------------- */
let baseData=[];
fetch("ippon.json")
.then(r=>r.json())
.then(data=>{
  baseData=data;

  const s=[...new Set(data.map(x=>x.serie))];
  const sel=document.getElementById("fSerie");
  sel.innerHTML=`<option value="">Toutes</option>`;
  s.forEach(v=>{
    sel.innerHTML+=`<option value="${v}">S√©rie ${v}</option>`;
  });

  const techSet=new Set(data.map(x=>x.attaque));
  const fTech=document.getElementById("filterTechnique");
  techSet.forEach(t=>fTech.innerHTML+=`<option value="${t}">${t}</option>`);
});

function refreshEncart1(){
  const serie=document.getElementById("fSerie").value;
  const cote=document.getElementById("fCote").value;
  const zone=document.getElementById("encart1");
  zone.innerHTML="";

  let list=baseData;

  if(serie) list=list.filter(x=>x.serie==serie);
  if(cote) list=list.filter(x=>x.cote==cote);

  if(list.length===0){
    encart1note.innerText="ü©∑ Aucun r√©sultat";
    return;
  }

  encart1note.innerText="‚úîÔ∏è r√©sultats affich√©s";

  list.forEach(t=>{
    zone.innerHTML+=`
      <div class="accordion-item">
        <div class="accordion-title">${t.attaque} ‚Äî ${t.cote}</div>
        <div class="accordion-content">
          Tai sabaki : ${t["tai sabaki"]}<br>
          Blocage : ${t.blocage}<br>
          D√©fense : ${t.defense}<br>
          <iframe width="100%" height="190" src="${t.video}" allowfullscreen></iframe>
        </div>
      </div>`;
  });

  document.querySelectorAll("#encart1 .accordion-title")
  .forEach(t=>{
    t.onclick=()=>{
      let c=t.nextElementSibling;
      c.style.display=c.style.display==="block"?"none":"block";
    };
  });
}
document.getElementById("fSerie").onchange=refreshEncart1;
document.getElementById("fCote").onchange=refreshEncart1;

/* ------------ ENCARt 2 VOCAL -------------------- */
let vocalData=[];
let playing=false, paused=false, timerId=null;

fetch("ipponvocal.json")
.then(r=>r.json())
.then(data=>{
  vocalData=data;
  const s=[...new Set(data.map(x=>x["S√©rie"]))];
  s.forEach(v=>serieSelect.innerHTML+=`<option value="${v}">S√©rie ${v}</option>`);
});

tempo.oninput=e=>tempoValue.innerText=e.target.value;

startBtn.onclick=()=>{
  if(!serieSelect.value) return alert("Choisis une s√©rie");
  vocalState.innerText="‚ñ∂Ô∏è lecture en cours"; playing=true; paused=false;
  const serie=parseInt(serieSelect.value);
  const delay=parseInt(tempo.value)*1000;
  const repeat=parseInt(repeatCount.value);
  const gender=voiceType.value;

  const G=vocalData.filter(x=>x["S√©rie"]===serie && x["C√¥t√©"]==="gauche");
  const D=vocalData.filter(x=>x["S√©rie"]===serie && x["C√¥t√©"]==="droite");

  let seq=[];
  for(let n=0;n<repeat;n++){
    seq.push(["fr","Commen√ßons l'entra√Ænement"]);
    seq.push(["fr","c√¥t√© gauche"]);
    G.forEach(t=>{
      seq.push(["ja",t.Assaut]);
      seq.push(["fr","blocage"]);
      seq.push(["ja",t.blocage]);
      seq.push(["fr","contre"]);
      seq.push(["ja",t.contre]);
    });
    seq.push(["fr","c√¥t√© droit"]);
    D.forEach(t=>{
      seq.push(["ja",t.Assaut]);
      seq.push(["fr","blocage"]);
      seq.push(["ja",t.blocage]);
      seq.push(["fr","contre"]);
      seq.push(["ja",t.contre]);
    });
  }
  seq.push(["fr","fin de l'entra√Ænement"]);

  let i=0;
  function step(){
    if(!playing) return;
    if(paused){timerId=setTimeout(step,300); return;}
    const [lang,txt]=seq[i++];
    displayText.innerText=txt;
    if(lang==="ja") speak(txt,"ja-JP",gender); else speak(txt,"fr-FR",gender);
    if(i<seq.length) timerId=setTimeout(step,delay); else{ playing=false; vocalState.innerText="‚úîÔ∏è termin√©"; }
  }
  setTimeout(step,2000);
};

pauseBtn.onclick=()=>{
  if(!playing) return;
  paused=!paused;
  paused?(vocalState.innerText="‚è∏Ô∏è en pause", speechSynthesis.pause())
        :(vocalState.innerText="‚ñ∂Ô∏è lecture en cours", speechSynthesis.resume());
};

stopBtn.onclick=()=>{
  playing=false; paused=false; clearTimeout(timerId); speechSynthesis.cancel(); vocalState.innerText="‚õî arr√™t√©"; displayText.innerText="";
};

/* ------------ ENCARt 3 -------------------- */
const pngTechniques=[
  {Assaut:"O√Ø tsuki jodan",C√¥t√©:"gauche",img:"construction.jpg"},
  {Assaut:"O√Ø tsuki chudan",C√¥t√©:"gauche",img:"construction.jpg"},
  {Assaut:"Mae geri",C√¥t√©:"gauche",img:"construction.jpg"},
  {Assaut:"Mawashi geri",C√¥t√©:"gauche",img:"construction.jpg"},
  {Assaut:"Yoko geri",C√¥t√©:"gauche",img:"construction.jpg"},
  {Assaut:"O√Ø tsuki jodan",C√¥t√©:"droite",img:"construction.jpg"},
  {Assaut:"O√Ø tsuki chudan",C√¥t√©:"droite",img:"construction.jpg"},
  {Assaut:"Mae geri",C√¥t√©:"droite",img:"construction.jpg"},
  {Assaut:"Mawashi geri",C√¥t√©:"droite",img:"construction.jpg"},
  {Assaut:"Yoko geri",C√¥t√©:"droite",img:"construction.jpg"}
];

const fSide=document.getElementById("filterSide");
const fTech=document.getElementById("filterTechnique");
function refreshEncart3(){
  const side=fSide.value;
  const tech=fTech.value;
  const zone=document.getElementById("ficheZone");
  zone.innerHTML="";
  let list=pngTechniques;
  if(side!=="all") list=list.filter(x=>x.C√¥t√©===side);
  if(tech!=="all") list=list.filter(x=>x.Assaut===tech);
  if(list.length===0){ zone.innerHTML="ü©∑ Aucun r√©sultat"; return;}
  list.forEach(t=>{
    zone.innerHTML+=`<div class="accordion-item">
      <div class="accordion-title">${t.Assaut} ‚Äî ${t.C√¥t√©}</div>
      <div class="accordion-content"><img src="${t.img}" class="fiche-img"></div>
    </div>`;
  });
  document.querySelectorAll("#ficheZone .accordion-title").forEach(t=>{
    t.onclick=()=>{
      let c=t.nextElementSibling;
      c.style.display=c.style.display==="block"?"none":"block";
    };
  });
}
fSide.onchange=refreshEncart3;
fTech.onchange=refreshEncart3;

/* ------------ ENCARt 4 ALEATOIRE -------------------- */
randTempo.oninput=e=>randTempoValue.innerText=e.target.value;

let run=false;

randStart.onclick=()=>{
  run=true;
  randState.innerText="‚ñ∂Ô∏è en cours";
  function loop(){
    if(!run) return;
    const tech=["Oi tsuki","Mae geri","Mawashi geri","Gyaku tsuki"];
    const t=tech[Math.floor(Math.random()*tech.length)];
    randDisplay.innerText=t;
    speak(t,"fr-FR");
    setTimeout(loop,randTempo.value*1000);
  }
  setTimeout(loop,1000);
};

randStop.onclick=()=>{
  run=false;
  randDisplay.innerText="";
  randState.innerText="‚õî arr√™t";
  speechSynthesis.cancel();
};
</script>

</body>
</html>
