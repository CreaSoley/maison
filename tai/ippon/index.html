<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ippon Kumite ‚Äì Tai Jitsu</title>

<!-- CSS Externe -->
<link rel="stylesheet" href="style-ippon.css">
<link rel="stylesheet" href="../banner.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* ================= FONTS ================= */
@font-face {
  font-family: "Shanghai";
  src: url("../tai/shanghai.ttf") format("truetype");
}
@font-face {
  font-family: "Fredoka";
  src: url("../tai/Fredoka-Regular.ttf") format("truetype");
}
@font-face {
  font-family: "Spicy";
  src: url("../tai/Spicy Sale.ttf") format("truetype");
}
@font-face {
  font-family: "SuperMeatball";
  src: url("../tai/SuperMeatball.ttf") format("truetype");
}

/* ================= BANDEAU ================= */
.appbar {
  background: black;
  color: white;
  padding: 25px 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
}
.logo-big { width: 110px; margin-bottom: 15px; }
.header-text .title { font-size: 2.5rem; letter-spacing: 2px; color: #ffd6ec; }
.header-text .subtitle { font-size: 1.7rem; margin-top: 18px; letter-spacing: 2px; color: #ffd0ea; font-family: "Shanghai", cursive; }

/* ================= FICHES BANNIERE ================= */
.top-banner { display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin-bottom:20px; }
.fiche-btn { background:#ffb6d9; color:white; border:none; padding:10px 18px; border-radius:12px; cursor:pointer; font-weight:bold; display:flex; align-items:center; gap:6px; transition:0.2s; }
.fiche-btn:hover { background:#ff8ac0; transform:translateY(-2px); }

/* ================= ENCARTE GLOBAL ================= */
.card-block { background:#fff0f8; padding:18px; border-radius:15px; box-shadow:0 4px 10px rgba(0,0,0,0.15); margin-bottom:20px; color:#ff66aa; width:48%; min-width:300px; box-sizing:border-box; }
.layout-desktop { display:flex; flex-wrap:wrap; justify-content:space-between; gap:20px; }
.spicy { font-family:"Spicy", cursive; }
.shanghai { font-family:"Shanghai", cursive; }
.fredoka { font-family:"Fredoka", Arial, sans-serif; }

/* ================= RESPONSIVE ================= */
@media(max-width:900px){ .card-block{ width:100%; } .header-text .title{ font-size:2rem; } .header-text .subtitle{ font-size:1.4rem; } }
@media(max-width:500px){ .header-text .title{ font-size:1.5rem; } .header-text .subtitle{ font-size:1.2rem; } }

/* ================= ACCORDION ================= */
.accordion-item { background:#fff0f8; border-radius:10px; margin-bottom:10px; overflow:hidden; }
.accordion-header { padding:10px 15px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; font-weight:bold; }
.accordion-content { display:none; padding:10px 15px; background:#ffe6f0; border-top:1px solid #ffb6d9; }

/* ================= ENCARTE 4 ================= */
.encart4 input, .encart4 select { border-radius:10px; padding:8px 12px; border:1px solid #ffb6d9; margin-right:10px; margin-bottom:10px; }
.encart4 button { background:#ffb6d9; color:white; border:none; padding:8px 14px; border-radius:12px; cursor:pointer; margin-right:8px; }
.encart4 button:hover { background:#ff8ac0; }

/* ================= ETAT BOUTONS ================= */
.status { font-weight:bold; margin-left:10px; }
</style>

</head>
<body data-title="Ippon Kumite ‚Äì Entra√Ænement">

<!-- ================= BANNIERE ================= -->
<header class="appbar">
  <a href="../index.html"><img src="logo.png" alt="logo" class="logo-big"></a>
  <div class="header-text">
    <div class="title shanghai" id="pageTitle"></div>
    <div class="subtitle shanghai">Ta√Ø-Jitsu</div>
  </div>
</header>

<!-- ================= FICHES ================= -->
<section class="top-banner">
  <button class="fiche-btn" onclick="window.open('tai/fiche1.pdf','_blank')">Fiche 1</button>
  <button class="fiche-btn" onclick="window.open('tai/fiche2.pdf','_blank')">Fiche 2</button>
  <button class="fiche-btn" onclick="window.open('tai/fiche3.pdf','_blank')">Fiche 3</button>
  <button class="fiche-btn" onclick="window.open('tai/fiche4.pdf','_blank')">Fiche 4</button>
  <button class="fiche-btn" onclick="window.open('tai/fiche5.pdf','_blank')">Fiche 5</button>
  <button class="fiche-btn" onclick="window.open('tai/fiche6.pdf','_blank')">Fiche 6</button>
</section>

<!-- ================= ENCARTE 1 √Ä 4 ================= -->
<main class="layout-desktop">

  <!-- ENCARTE 1 : TECHNIQUES PAR COTE -->
  <section class="card-block" id="encart1">
    <h2 class="spicy section-title">ü•ã Techniques par c√¥t√©</h2>
    <div>
      <select id="selectSerie1"><option value="">Choisir une s√©rie</option></select>
      <select id="selectCote1"><option value="">Choisir un c√¥t√©</option><option value="droite">Droite</option><option value="gauche">Gauche</option></select>
    </div>
    <div id="accordionTech"></div>
  </section>

  <!-- ENCARTE 2 : ENTRAINEMENT VOCAL -->
  <section class="card-block" id="encart2">
    <h2 class="spicy section-title">üé§ Entra√Ænement vocal</h2>
    <div>
      <select id="selectSerie2"><option value="">Choisir s√©rie</option></select>
      <label>Intervalle (s) : <span id="intervalValue">10</span></label>
      <input type="range" id="intervalRanger" min="5" max="60" value="10">
      <select id="voiceChoice"><option value="female">F√©minin</option><option value="male">Masculin</option></select>
      <input type="number" id="repeatSeries" min="1" max="10" value="1" style="width:60px;"> üîÅ
    </div>
    <div>
      <button id="startVocal">‚ñ∂Ô∏è D√©marrer</button>
      <button id="pauseVocal">‚è∏Ô∏è Pause</button>
      <span class="status" id="statusVocal">Arr√™t√©</span>
    </div>
    <div id="textVocal"></div>
  </section>

  <!-- ENCARTE 3 : FICHES TRAVAIL -->
  <section class="card-block" id="encart3">
    <h2 class="spicy section-title">üìÑ Fiches de travail</h2>
    <select id="selectCote3"><option value="">Choisir c√¥t√©</option><option value="droite">Droite</option><option value="gauche">Gauche</option></select>
    <div id="accordionFiches"></div>
  </section>

  <!-- ENCARTE 4 : ENTRAINEMENT SPECIALE -->
  <section class="card-block encart4" id="encart4">
    <h2 class="spicy section-title">üí´ Entra√Ænement sp√©cial</h2>
    <div>
      <input type="number" id="interval4" min="3" max="60" value="10"> secondes intervalle<br>
      <select id="voice4"><option value="female">F√©minin</option><option value="male">Masculin</option></select>
      <input type="number" id="repeat4" min="1" max="10" value="1"> üîÅ r√©p√©titions
    </div>
    <div>
      <button id="start4">‚ñ∂Ô∏è D√©marrer</button>
      <button id="pause4">‚è∏Ô∏è Pause</button>
      <span class="status" id="status4">Arr√™t√©</span>
    </div>
    <div id="text4"></div>
  </section>

</main>

<!-- ================= SCRIPTS ================= -->
<script>
// ================= BANNIERE =================
document.getElementById("pageTitle").textContent = document.body.dataset.title || "";

// ================= ENCARTE 1 =================
let ipponData = [];
fetch('ippon/ippon.json').then(r=>r.json()).then(data=>{
  ipponData=data;
  let series = [...new Set(data.map(e=>e.serie))];
  let selectS = document.getElementById('selectSerie1');
  series.forEach(s=>selectS.innerHTML+=`<option value="${s}">${s}</option>`);
});
document.getElementById('selectSerie1').addEventListener('change',updateAccordion1);
document.getElementById('selectCote1').addEventListener('change',updateAccordion1);

function updateAccordion1(){
  let s = document.getElementById('selectSerie1').value;
  let c = document.getElementById('selectCote1').value;
  let html='';
  if(!s || !c) { document.getElementById('accordionTech').innerHTML=''; return; }
  ipponData.filter(e=>e.serie==s && e.cote==c).forEach((e,i)=>{
    html+=`<div class="accordion-item">
      <div class="accordion-header">${e.attaque} <span>‚ñº</span></div>
      <div class="accordion-content">
        Tai sabaki: ${e["tai sabaki"]}<br>
        Blocage: ${e.blocage}<br>
        D√©fense: ${e.defense}<br>
        <iframe src="${e.video}" style="width:100%;height:200px;border:none;"></iframe>
      </div>
    </div>`;
  });
  document.getElementById('accordionTech').innerHTML=html;
  document.querySelectorAll('.accordion-header').forEach(h=>{
    h.onclick=()=>h.nextElementSibling.style.display=h.nextElementSibling.style.display==='block'?'none':'block';
  });
}

// ================= ENCARTE 2 =================
let ipponVocalData=[];
fetch('ippon/ipponvocal.json').then(r=>r.json()).then(data=>{
  ipponVocalData=data;
  let series=[...new Set(data.map(e=>e.S√©rie))];
  let selectS2=document.getElementById('selectSerie2');
  series.forEach(s=>selectS2.innerHTML+=`<option value="${s}">${s}</option>`);
});

let vocalStatus=document.getElementById('statusVocal');
let vocalInterval=parseInt(document.getElementById('intervalRanger').value)*1000;
let repeatSeries=document.getElementById('repeatSeries').value;
let synth=new SpeechSynthesisUtterance();
let isPlaying=false, pauseFlag=false;
document.getElementById('intervalRanger').addEventListener('input',e=>{document.getElementById('intervalValue').textContent=e.target.value; vocalInterval=e.target.value*1000;});
document.getElementById('startVocal').addEventListener('click',()=>{if(!isPlaying){startVocal();}});
document.getElementById('pauseVocal').addEventListener('click',()=>{pauseFlag=!pauseFlag; vocalStatus.textContent=pauseFlag?'En pause':'En lecture'; speechSynthesis.pause();});

function startVocal(){
  let s=document.getElementById('selectSerie2').value;
  if(!s) return alert('S√©lectionner une s√©rie');
  let voiceChoice=document.getElementById('voiceChoice').value;
  let repeats=parseInt(document.getElementById('repeatSeries').value)||1;
  let list=ipponVocalData.filter(e=>e.S√©rie==s);
  let sides=['gauche','droite'];
  let idx=0, repCount=0;
  isPlaying=true; pauseFlag=false; vocalStatus.textContent='En lecture';
  document.getElementById('textVocal').innerHTML='';
  function speakNext(){
    if(repCount>=repeats){ vocalStatus.textContent='Arr√™t√©'; isPlaying=false; return; }
    if(idx>=list.length){ idx=0; repCount++; }
    if(!isPlaying) return;
    let item=list[idx++];
    let texts=[item.Assaut,item.blocage,item.contre];
    let side=item.C√¥t√©;
    let i=0;
    function say(){
      if(i>=texts.length){ setTimeout(speakNext,vocalInterval); return; }
      document.getElementById('textVocal').innerHTML=texts[i];
      synth.text=texts[i];
      synth.lang=i==0?'ja-JP':'ja-JP';
      synth.rate=1; synth.pitch=1;
      synth.voice=speechSynthesis.getVoices().find(v=>voiceChoice=='female'?v.name.includes('F') : v.name.includes('M')) || null;
      speechSynthesis.speak(synth);
      i++;
      setTimeout(say,2000);
    }
    say();
  }
  speakNext();
}

// ================= ENCARTE 3 =================
let fiches3=[{Assaut:"O√Ø tsuki jodan",C√¥t√©:"gauche",img:"construction.jpg"},{Assaut:"O√Ø tsuki chudan",C√¥t√©:"gauche",img:"construction.jpg"},{Assaut:"Mae geri",C√¥t√©:"gauche",img:"construction.jpg"},{Assaut:"Mawashi geri",C√¥t√©:"gauche",img:"construction.jpg"},{Assaut:"Yoko geri",C√¥t√©:"gauche",img:"construction.jpg"},{Assaut:"O√Ø tsuki jodan",C√¥t√©:"droite",img:"construction.jpg"},{Assaut:"O√Ø tsuki chudan",C√¥t√©:"droite",img:"construction.jpg"},{Assaut:"Mae geri",C√¥t√©:"droite",img:"construction.jpg"},{Assaut:"Mawashi geri",C√¥t√©:"droite",img:"construction.jpg"},{Assaut:"Yoko geri",C√¥t√©:"droite",img:"construction.jpg"}];
let selectCote3=document.getElementById('selectCote3');
selectCote3.addEventListener('change',updateFiches3);
function updateFiches3(){
  let c=selectCote3.value; let html=''; if(!c){document.getElementById('accordionFiches').innerHTML=''; return;}
  fiches3.filter(f=>f.C√¥t√©==c).forEach((f,i)=>{
    html+=`<div class="accordion-item">
      <div class="accordion-header">${f.Assaut} <span>‚ñº</span></div>
      <div class="accordion-content"><img src="${f.img}" style="width:100%;border-radius:10px;"></div>
    </div>`;
  });
  document.getElementById('accordionFiches').innerHTML=html;
  document.querySelectorAll('#accordionFiches .accordion-header').forEach(h=>{h.onclick=()=>h.nextElementSibling.style.display=h.nextElementSibling.style.display==='block'?'none':'block';});
}

// ================= ENCARTE 4 =================
let start4=document.getElementById('start4'), pause4=document.getElementById('pause4'), status4=document.getElementById('status4'), text4=document.getElementById('text4');
let interval4=document.getElementById('interval4'), voice4=document.getElementById('voice4'), repeat4=document.getElementById('repeat4');
let synth4=new SpeechSynthesisUtterance(); let isPlaying4=false; let pauseFlag4=false;
start4.addEventListener('click',()=>{if(!isPlaying4) play4();});
pause4.addEventListener('click',()=>{pauseFlag4=!pauseFlag4; status4.textContent=pauseFlag4?'En pause':'En lecture'; speechSynthesis.pause();});

function play4(){
  let repeats=parseInt(repeat4.value)||1;
  let interv=parseInt(interval4.value)*1000;
  let voiceChoice=voice4.value;
  let items=["Assaut 1","Assaut 2","Assaut 3","Assaut 4","Assaut 5","Assaut 6","Assaut 7","Assaut 8","Assaut 9","Assaut 10"];
  let idx=0, repCount=0; isPlaying4=true; pauseFlag4=false; status4.textContent='En lecture'; text4.innerHTML='';
  function next(){
    if(repCount>=repeats){ status4.textContent='Arr√™t√©'; isPlaying4=false; return;}
    if(idx>=items.length){ idx=0; repCount++; }
    if(!isPlaying4) return;
    let t=items[idx++];
    text4.innerHTML=t;
    synth4.text=t; synth4.lang='fr-FR'; synth4.rate=1; synth4.pitch=1;
    synth4.voice=speechSynthesis.getVoices().find(v=>voiceChoice=='female'?v.name.includes('F'):v.name.includes('M')) || null;
    speechSynthesis.speak(synth4);
    setTimeout(next,interv);
  }
  next();
}

</script>
</body>
</html>
