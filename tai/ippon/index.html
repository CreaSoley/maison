<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ippon Kumite ‚Äì Tai Jitsu</title>

  <!-- CSS principal -->
  <link rel="stylesheet" href="style-ippon.css">
  <link rel="stylesheet" href="../banner.css">

  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Polices locales -->
  <style>
    @font-face {
      font-family: "Spicy";
      src: url("Spicy Sale.ttf") format("truetype");
    }
    @font-face {
      font-family: "Shangha√Ø";
      src: url("shanghai.ttf") format("truetype");
    }
    @font-face {
      font-family: "Fredoka";
      src: url("Fredoka.ttf") format("truetype");
    }

    .spicy { font-family: "Spicy", cursive; }
    .shanghai { font-family: "Shangha√Ø", cursive; }
    .fredoka { font-family: "Fredoka", Arial, sans-serif; }

    /* Layout 2 colonnes desktop, 1 colonne mobile */
    .layout-4cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }

    .card-block {
      background: #f7f7f7;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .card-block h2 {
      margin-top: 0;
      margin-bottom: 10px;
    }

    .controls {
      margin-bottom: 10px;
    }

    .accordion-item {
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
    }

    .accordion-header {
      background: #ddd;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .accordion-content {
      display: none;
      padding: 10px;
      background: #fff;
    }

    img.fiche-img {
      width: 100%;
      max-width: 400px;
      display: block;
      margin: 0 auto;
    }

    /* Styles entrainement */
    #trainingControls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #trainingControls input[type=range] {
      width: 100%;
    }

    #trainingOutput {
      margin-top: 15px;
      font-size: 1.2rem;
      text-align: center;
      min-height: 2em;
    }
  </style>
</head>

<body data-title="Ippon kumite ‚Äì Entra√Ænement">

  <!-- BANNI√àRE -->
  <div id="bannerContainer"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch("../banner.html")
        .then(r => r.text())
        .then(html => {
          document.getElementById("bannerContainer").innerHTML = html;
          let pageTitle =
            document.body.dataset.title ||
            document.querySelector("h1")?.textContent ||
            document.querySelector("title")?.textContent || "";
          const target = document.querySelector(".header-text .title");
          if (target && pageTitle) target.textContent = pageTitle;
        })
        .catch(err => console.error("Erreur chargement banni√®re :", err));
    });
  </script>

  <section class="top-banner">
  <div class="controls">
    <button onclick="window.open('F1.pdf','_blank')">Fiche 1</button>
    <button onclick="window.open('F2.pdf','_blank')">Fiche 2</button>
    <button onclick="window.open('F3.pdf','_blank')">Fiche 3</button>
    <button onclick="window.open('F4.pdf','_blank')">Fiche 4</button>
    <button onclick="window.open('F5.pdf','_blank')">Fiche 5</button>
    <button onclick="window.open('F6.pdf','_blank')">Fiche 6</button>
  </div>
</section>

  <!-- 4 ENCARTS -->
  <main class="layout-4cards">

    <!-- ENCADR√â 1 : Techniques par c√¥t√© -->
    <section class="card-block" id="script1">
      <h2 class="spicy section-title">ü•ã Techniques par c√¥t√©</h2>
      <div class="controls controls-column">
        <select id="selectSerieAccordion">
          <option value="">Choisir une s√©rie</option>
        </select>
        <select id="filterSideAccordion">
          <option value="">Choisir un c√¥t√©</option>
          <option value="droite">Droite</option>
          <option value="gauche">Gauche</option>
        </select>
      </div>
      <div id="accordionList"></div>
    </section>

    <!-- ENCADR√â 2 : Fiche technique -->
    <section class="card-block" id="script2">
      <h2 class="spicy section-title">üí´ Fiche technique</h2>
      <div class="controls controls-column">
        <select id="selectSerie">
          <option value="">Choisir une s√©rie</option>
        </select>
        <select id="selectAttack">
          <option value="">Choisir une attaque</option>
        </select>
        <select id="selectSide">
          <option value="">Choisir un c√¥t√©</option>
          <option value="droite">Droite</option>
          <option value="gauche">Gauche</option>
        </select>
      </div>
      <div id="resultCard"></div>
    </section>

    <!-- ENCADR√â 3 : Fiches de travail en PNG -->
    <section class="card-block" id="script3">
      <h2 class="spicy section-title">üñºÔ∏è Fiches de travail</h2>
      <div class="controls">
        <select id="filterSidePng">
          <option value="">Choisir un c√¥t√©</option>
          <option value="droite">Droite</option>
          <option value="gauche">Gauche</option>
        </select>
      </div>
      <div id="accordionPng"></div>
    </section>

    <!-- ENCADR√â 4 : Entra√Ænement al√©atoire -->
    <section class="card-block" id="script4">
      <h2 class="spicy section-title">‚ö° Entra√Ænement vocal al√©atoire</h2>
      <div id="trainingControls">
        <button id="startTraining">D√©marrer l'entra√Ænement</button>
        <button id="stopTraining">Arr√™ter</button>
        <label>Intervalle entre techniques : <span id="intervalValue">5</span> secondes</label>
        <input type="range" id="intervalRange" min="3" max="60" value="5">
      </div>
      <div id="trainingOutput"></div>
    </section>

  </main>
<script>
let data = [];

// Charger JSON
fetch("ippon.json")
  .then(r => r.json())
  .then(json => {
    data = json;
    buildSerieSelectors();
    buildAccordionTechniques();
  });

/* --------- ENCADR√â 1 : ACCORD√âON TECHNIQUES PAR C√îT√â --------- */

function buildAccordionTechniques() {
  const container = document.getElementById("accordionList");
  const serie = document.getElementById("selectSerieAccordion").value;
  const side = document.getElementById("filterSideAccordion").value;

  const filtered = data.filter(item =>
    (!serie || item.serie == serie) &&
    (!side || item.cote === side)
  );

  container.innerHTML = "";

  filtered.forEach(item => {
    const block = document.createElement("div");
    block.className = "accordion-item";

    const head = document.createElement("div");
    head.className = "accordion-header";
    head.textContent = `${item.attaque} ‚Äî ${item.cote}`;

    const content = document.createElement("div");
    content.className = "accordion-content";
    content.innerHTML = `
      <p><b>Tai sabaki :</b> ${item["tai sabaki"]}</p>
      <p><b>Blocage :</b> ${item.blocage}</p>
      <p><b>D√©fense :</b> ${item.defense}</p>
      <iframe width="300" height="180" src="${item.video}" allowfullscreen></iframe>
    `;

    head.onclick = () => {
      head.classList.toggle("open");
      content.style.display =
        content.style.display === "block" ? "none" : "block";
    };

    block.appendChild(head);
    block.appendChild(content);
    container.appendChild(block);
  });
}

document.getElementById("selectSerieAccordion").onchange = buildAccordionTechniques;
document.getElementById("filterSideAccordion").onchange = buildAccordionTechniques;

/* Remplit les listes s√©ries */
function buildSerieSelectors() {
  const selects = [
    document.getElementById("selectSerieAccordion"),
    document.getElementById("selectSerie")
  ];

  const series = [...new Set(data.map(x => x.serie))];

  selects.forEach(sel => {
    series.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = `S√©rie ${s}`;
      sel.appendChild(opt);
    });
  });
}

/* --------- ENCADR√â 2 : FICHE TECHNIQUE --------- */

document.getElementById("selectSerie").onchange = updateCard;
document.getElementById("selectAttack").onchange = updateCard;
document.getElementById("selectSide").onchange = updateCard;

function updateCard() {
  const serie = selectSerie.value;
  const atk = selectAttack.value;
  const side = selectSide.value;

  const card = data.find(x =>
    x.serie == serie &&
    (!atk || x.attaque === atk) &&
    (!side || x.cote === side)
  );

  const target = document.getElementById("resultCard");

  if (!card) {
    target.innerHTML = "<i>Aucune fiche trouv√©e</i>";
    return;
  }

  target.innerHTML = `
    <p><b>Attaque :</b> ${card.attaque}</p>
    <p><b>C√¥t√© :</b> ${card.cote}</p>
    <p><b>Tai sabaki :</b> ${card["tai sabaki"]}</p>
    <p><b>Blocage :</b> ${card.blocage}</p>
    <p><b>D√©fense :</b> ${card.defense}</p>
    <iframe width="320" height="200" src="${card.video}" allowfullscreen></iframe>
  `;

  // remplir attaques dynamiquement
  const attacks = [...new Set(data
    .filter(x => x.serie == serie)
    .map(x => x.attaque))];

  selectAttack.innerHTML = `<option value="">Choisir une attaque</option>`;
  attacks.forEach(a => {
    const o = document.createElement("option");
    o.textContent = a;
    o.value = a;
    selectAttack.appendChild(o);
  });
}

const fichesPng = [
  { name: "O√Ø tsuki jodan", file: "otjd.png", side: "droite" },
  { name: "O√Ø tsuki jodan", file: "otjd.png", side: "gauche" }
];

function buildAccordionPngKawaii(side="") {
  const container = document.getElementById("accordionPng");
  container.innerHTML = "";

  fichesPng
    .filter(f => !side || f.side === side)
    .forEach(f => {
      const item = document.createElement("div");
      item.className = "accordion-item";

      const head = document.createElement("div");
      head.className = "accordion-header";
      head.textContent = `${f.name} ‚Äî ${f.side}`;

      const content = document.createElement("div");
      content.className = "accordion-content";
      content.innerHTML =
        `<img src="${f.file}" class="fiche-img">`;

      head.onclick = () => {
        head.classList.toggle("open");
        content.style.display =
          content.style.display === "block" ? "none" : "block";
      };

      item.appendChild(head);
      item.appendChild(content);
      container.appendChild(item);
    });
}

document.getElementById("filterSidePng").onchange =
  e => buildAccordionPngKawaii(e.target.value);

buildAccordionPngKawaii();

const techs = [
  "Oi tsuki jodan",
  "Oi tsuki chudan",
  "Mae geri",
  "Yoko geri",
  "Gyaku tsuki",
  "Kizami tsuki",
  "Soto uke",
  "Uchi uke",
  "Ura mawashi geri",
  "Shuto uke"
];

let timer = null;
const synth = window.speechSynthesis;

intervalRange.oninput = () =>
  intervalValue.textContent = intervalRange.value;

startTraining.onclick = () => {
  trainingOutput.textContent = "‚è≥ Pr√©paration‚Ä¶";
  setTimeout(() => {
    timer = setInterval(() => {
      const t = techs[Math.floor(Math.random() * techs.length)];
      trainingOutput.textContent = "üî• " + t;

      const u = new SpeechSynthesisUtterance(t);
      u.lang = "fr-FR";
      synth.speak(u);
    }, intervalRange.value * 1000);
  }, 5000);
};

stopTraining.onclick = () => {
  clearInterval(timer);
  synth.cancel();
  trainingOutput.textContent = "üõë entra√Ænement arr√™t√©";
};
</script>


</body>
</html>
