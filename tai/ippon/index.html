<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Ippon Kumite ‚Äì Tai Jitsu</title>

<!-- Banner CSS -->
<link rel="stylesheet" href="../banner.css">

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* ---------------------- FONTS ------------------------ */

@font-face{
  font-family:"Spicy";
  src:url("Spicy Sale.ttf");
}

@font-face{
  font-family:"Shanghai";
  src:url("Shanghai.ttf");
}

/* fallback si introuvable */
.kawaii-title{
  font-family:"Shanghai","Spicy","Comic Sans MS",cursive;
}

/* ---------------------- LAYOUT ------------------------ */

body{
  background:#fff5fc;
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
}

.container{
  max-width:1400px;
  margin:auto;
  padding:10px;
}

/* desktop grid : plus large qu'avant */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}

/* mobile */
@media(max-width:900px){
  .grid{
    grid-template-columns:1fr;
  }
}

/* ---------------------- CARDS ------------------------ */

.card{
  background:white;
  border-radius:20px;
  padding:15px;
  box-shadow:0 10px 20px rgba(0,0,0,.1);
}

.card h2{
  text-align:center;
  font-family:"Spicy",cursive;
  margin-top:5px;
}

/* kawaii controls  */
button,
select,
input{
  border-radius:25px;
  border:2px solid #ffb7e5;
  padding:6px 10px;
}

button{
  cursor:pointer;
  background:#ffe2f4;
}

button:hover{
  background:#ffd2ef;
}

/* ---------------------- ACCORDION ------------------------ */

.accordion-item{
  background:#fff0fb;
  border-radius:16px;
  margin-bottom:8px;
  padding:8px 12px;
  cursor:pointer;
}

.accordion-content{
  display:none;
  padding:6px 10px;
}

/* ---------------------- STATUS ------------------------ */

.status{
  text-align:center;
  font-weight:bold;
  margin-top:10px;
}

.status.play{ color:#2e7d32; }
.status.pause{ color:#ff6f00; }
.status.stop{ color:#c62828; }
</style>
</head>

<body data-title="Ippon kumite ‚Äì Entra√Ænement">

<!-- injected banner -->
<div id="bannerContainer"></div>

<script>
fetch("../banner.html")
.then(r=>r.text())
.then(html=>{
  document.getElementById("bannerContainer").innerHTML=html;
  const t=document.querySelector(".header-text .title");
  if(t) t.textContent=document.body.dataset.title || "Ippon kumite";
});
</script>

<div class="container">

<div class="grid">

<!-- ========================================================= -->
<!-- ======================= ENCARt 1 ======================== -->
<!-- ========================================================= -->

<div class="card">
<h2>ü•ã Accord√©on ‚Äì techniques par c√¥t√©</h2>

<select id="fSerie">
<option value="">Choisir une s√©rie</option>
</select>

<select id="fCote">
<option value="">Choisir un c√¥t√©</option>
<option value="gauche">gauche</option>
<option value="droite">droite</option>
</select>

<div id="accordion1"></div>
</div>

<!-- ========================================================= -->
<!-- ======================= ENCARt 2 ======================== -->
<!-- ========================================================= -->

<div class="card">
<h2>üó£Ô∏è Entra√Ænement vocal guid√©</h2>

<select id="serieVocale">
<option value="">Choisir une s√©rie</option>
</select>

<label>‚è±Ô∏è intervalle assaut ‚Üí assaut :
<span id="intervalValue">10s</span></label>
<input id="intervalRange" type="range" min="5" max="60" value="10">

<div style="text-align:center;margin-top:10px;">
<button id="btnStart">‚ñ∂Ô∏è Lancer</button>
<button id="btnPause">‚è∏Ô∏è Pause</button>
<button id="btnStop">‚èπÔ∏è Stop</button>
</div>

<div class="status" id="vocalStatus">‚èπÔ∏è arr√™t√©</div>

<div id="vocalDisplay" style="text-align:center;font-size:1.3em;margin-top:10px;"></div>
</div>

<!-- ========================================================= -->
<!-- ======================= ENCARt 3 ======================== -->
<!-- ========================================================= -->

<div class="card">
<h2>üìÑ Fiches d‚Äôentra√Ænement (PNG)</h2>

<select id="fichesCote">
<option value="">Choisir un c√¥t√©</option>
<option value="gauche">gauche</option>
<option value="droit">droit</option>
</select>

<div id="accordion3"></div>
</div>

<!-- ========================================================= -->
<!-- ======================= ENCARt 4 ======================== -->
<!-- ========================================================= -->

<div class="card">
<h2>üé≤ Entra√Ænement al√©atoire</h2>

<button id="randStart">D√©marrer</button>
<button id="randStop">Arr√™ter</button>

<div id="randText" style="text-align:center;margin-top:10px;"></div>
</div>

</div>
</div>

<!-- ============================ SCRIPTS =============================== -->

<script>
/* ================= ENCARt 1 : ippon.json ================== */

let ipponData=[];

fetch("ippon.json")
.then(r=>r.json())
.then(data=>{
  ipponData=data;
  const series=[...new Set(data.map(d=>d.serie||d.S√©rie))];
  const s1=document.getElementById("fSerie");
  const s2=document.getElementById("serieVocale");

  series.forEach(n=>{
    const o=document.createElement("option");
    o.value=n;o.textContent="S√©rie "+n;
    s1.appendChild(o.cloneNode(true));
    s2.appendChild(o.cloneNode(true));
  });
});

document.getElementById("fSerie").addEventListener("change",renderAcc1);
document.getElementById("fCote").addEventListener("change",renderAcc1);

function renderAcc1(){
  const serie=document.getElementById("fSerie").value;
  const cote=document.getElementById("fCote").value;
  const cont=document.getElementById("accordion1");
  cont.innerHTML="";

  if(!serie && !cote) return;

  ipponData
  .filter(d=>(!serie||d.serie==serie||d.S√©rie==serie)
              &&(!cote||d.cote==cote||d.C√¥t√©==cote))
  .forEach(item=>{
    const wrap=document.createElement("div");
    wrap.className="accordion-item";
    wrap.textContent=item.attaque||item.Assaut;

    const content=document.createElement("div");
    content.className="accordion-content";
    content.innerHTML=
      "<b>Tai sabaki :</b> "+(item["tai sabaki"]||"‚Äî")+"<br>"+
      "<b>Blocage :</b> "+(item.blocage||"‚Äî")+"<br>"+
      "<b>D√©fense :</b> "+(item.defense||item.contre||"‚Äî")+"<br>";

    wrap.addEventListener("click",()=>{
      content.style.display=
        content.style.display=="block"?"none":"block";
    });

    cont.appendChild(wrap);
    cont.appendChild(content);
  });
}

/* ================= ENCARt 2 : ipponvocal.json ================== */

let vocalData=[];
let vocalTimer=null;
let paused=false;
let queue=[];
let intervalAssaut=10;

fetch("ipponvocal.json")
.then(r=>r.json())
.then(d=>vocalData=d);

const synth=window.speechSynthesis;

function speak(txt,lang="fr-FR"){
  const u=new SpeechSynthesisUtterance(txt);
  u.lang=lang;
  synth.speak(u);
}

document.getElementById("intervalRange").oninput=e=>{
  intervalAssaut=parseInt(e.target.value);
  document.getElementById("intervalValue").textContent=intervalAssaut+"s";
};

function setStatus(t,c){
  const s=document.getElementById("vocalStatus");
  s.textContent=t;
  s.className="status "+c;
}

document.getElementById("btnStart").onclick=()=>{
  const serie=document.getElementById("serieVocale").value;
  if(!serie) return;

  paused=false;
  synth.cancel();
  setStatus("‚ñ∂Ô∏è lecture","play");

  const list=vocalData.filter(x=>x.S√©rie==serie);

  queue=[];

  queue.push(()=>speak("Commen√ßons l'entra√Ænement"));
  queue.push(()=>speak("c√¥t√© gauche"));

  list.filter(x=>x.C√¥t√©=="gauche").forEach(x=>{
    queue.push(()=>sequenceAssaut(x));
  });

  queue.push(()=>speak("c√¥t√© droit"));

  list.filter(x=>x.C√¥t√©=="droit"||x.C√¥t√©=="droite").forEach(x=>{
    queue.push(()=>sequenceAssaut(x));
  });

  queue.push(()=>{
    speak("Fin de l'entra√Ænement");
    setStatus("‚èπÔ∏è termin√©","stop");
  });

  runQueue();
};

document.getElementById("btnPause").onclick=()=>{
  paused=!paused;
  if(paused){
    synth.pause();
    setStatus("‚è∏Ô∏è pause","pause");
  }else{
    synth.resume();
    setStatus("‚ñ∂Ô∏è lecture","play");
  }
};

document.getElementById("btnStop").onclick=()=>{
  synth.cancel();
  queue=[];
  setStatus("‚èπÔ∏è arr√™t√©","stop");
};

function sequenceAssaut(x){
  const disp=document.getElementById("vocalDisplay");

  // assaut
  disp.textContent=x.Assaut;
  speak(x.Assaut,"ja-JP");

  setTimeout(()=>{
    disp.textContent=x.blocage;
    speak(x.blocage,"ja-JP");
  },2000);

  setTimeout(()=>{
    disp.textContent=x.contre;
    speak(x.contre,"ja-JP");
  },4000);
}

function runQueue(){
  if(queue.length===0) return;

  const step=queue.shift();
  step();

  // enforce minimal interval >=6 to fit 2+2+2
  const wait=Math.max(intervalAssaut*1000,6000);

  setTimeout(()=>{
    if(!paused) runQueue();
    else queue.unshift(step);
  },wait);
}

/* ================= ENCARt 3 : fiches ================== */

const ficheList=[
"O√Ø tsuki jodan gauche",
"O√Ø tsuki chudan gauche",
"Mae geri gauche",
"Mawashi geri gauche",
"Yoko geri gauche",
"O√Ø tsuki jodan droit",
"O√Ø tsuki chudan droit",
"Mae geri droit",
"Mawashi geri droit",
"Yoko geri droit"
];

document.getElementById("fichesCote").onchange=renderFiches;

function renderFiches(){
  const cont=document.getElementById("accordion3");
  cont.innerHTML="";
  ficheList.forEach(f=>{
    const item=document.createElement("div");
    item.className="accordion-item";
    item.textContent=f;

    const img=document.createElement("div");
    img.className="accordion-content";
    img.innerHTML=`<img src="construction.jpg" style="max-width:100%;">`;

    item.onclick=()=>{
      img.style.display=img.style.display=="block"?"none":"block";
    };

    cont.appendChild(item);
    cont.appendChild(img);
  });
}

/* ================= ENCARt 4 ================== */

let randInterval=null;

document.getElementById("randStart").onclick=()=>{
  const disp=document.getElementById("randText");
  randInterval=setInterval(()=>{
    const r=Math.floor(Math.random()*ficheList.length);
    disp.textContent=ficheList[r];
  },3000);
};

document.getElementById("randStop").onclick=()=>{
  clearInterval(randInterval);
};
</script>

</body>
</html>
