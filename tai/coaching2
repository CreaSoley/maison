<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¥‹ Coach KaratÃ© Kawaii</title>

<style>
:root {
  --grad1: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);
  --grad2: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
}
body {
  margin:0;font-family:sans-serif;
  background:var(--grad1);
}
header{text-align:center;padding:20px;background:var(--grad2);}
.container{max-width:900px;margin:auto;padding:20px;}
button{
  padding:10px 18px;border:none;border-radius:25px;
  margin:5px;cursor:pointer;
  box-shadow:0 6px 12px rgba(0,0,0,.2);
}
ul{list-style:none;padding:0}
li{background:#fff;margin:10px 0;padding:12px;border-radius:18px}
li.active{border:3px solid #84fab0}
.progress{height:8px;background:#eee;border-radius:10px;overflow:hidden}
.progress div{height:100%;background:var(--grad2);width:0}
.timeline{height:14px;background:#eee;border-radius:10px;overflow:hidden}
.timeline div{height:100%;background:var(--grad2);width:0}
.fullscreen{
  position:fixed;inset:0;
  background:var(--grad2);
  display:none;align-items:center;justify-content:center;
  font-size:72px;font-weight:bold;color:#333;
}
.badge{display:inline-block;padding:6px 12px;border-radius:12px;background:#ffd86f;margin:4px}
</style>
</head>

<body>

<header>
<h1>ğŸ¥‹ Coach KaratÃ© Kawaii ğŸŒ¸</h1>
<p>Focus â€¢ Progression â€¢ Discipline</p>
</header>

<div class="container">

<button onclick="start()">â–¶ Lancer / Reprendre</button>
<button onclick="pause()">â¸ Pause</button>
<button onclick="stop()">â¹ Stop</button>
<button onclick="toggleFullscreen()">â± Mode Focus</button>
<button onclick="exportCSV()">ğŸ“¤ CSV</button>
<button onclick="exportPDF()">ğŸ–¨ PDF</button>

<h3>Progression globale</h3>
<div class="timeline"><div id="global"></div></div>

<ul id="program"></ul>

<h3>ğŸ“Š Temps hebdomadaire par exercice</h3>
<div id="weekly"></div>

<h3>ğŸ… Badges</h3>
<div id="badges"></div>

</div>

<div class="fullscreen" id="focusTimer"></div>
<audio id="ding" src="ding.mp3"></audio>

<script>
const ding=document.getElementById("ding");
const synth=window.speechSynthesis;
let interval,remaining;
let currentIndex=0;

let exercises=[
 {label:"ğŸ¥‹ Kihon",speech:"Kihon",duration:15,progress:0,done:false,time:0},
 {label:"ğŸ¯ Cibles",speech:"Cibles",duration:10,progress:0,done:false,time:0},
 {label:"âš¡ Ippon",speech:"Ippon kumite",duration:10,progress:0,done:false,time:0},
 {label:"ğŸ§˜ Kata",speech:"Kata",duration:10,progress:0,done:false,time:0},
 {label:"ğŸ”¥ Randori",speech:"Randori",duration:10,progress:0,done:false,time:0}
];

load();
render();

function speak(t){
 const u=new SpeechSynthesisUtterance(t);
 u.lang="fr-FR";synth.speak(u);
}

function start(){
 const next=exercises.findIndex(e=>!e.done);
 if(next!==-1) currentIndex=next;
 play();
}

function play(){
 if(currentIndex>=exercises.length){
  speak("Fin de l'entraÃ®nement");
  saveSession();
  return;
 }
 const ex=exercises[currentIndex];
 speak(ex.speech);
 setTimeout(()=>ding.play(),2000);
 remaining=(ex.duration*60)-(ex.progress/100*ex.duration*60);
 interval=setInterval(()=>{
  remaining--;
  ex.time++;
  ex.progress=100-(remaining/(ex.duration*60))*100;
  update();
  document.getElementById("focusTimer").textContent=
    Math.floor(remaining/60)+":"+String(remaining%60).padStart(2,"0");
  if(remaining<=0){
   clearInterval(interval);
   ding.play();
   if(navigator.vibrate) navigator.vibrate([300,100,300]);
   ex.done=true;currentIndex++;play();
  }
 },1000);
}

function pause(){clearInterval(interval);save();}
function stop(){clearInterval(interval);currentIndex=0;save();}

function render(){
 const ul=document.getElementById("program");
 ul.innerHTML="";
 exercises.forEach((e,i)=>{
  const li=document.createElement("li");
  if(i===currentIndex) li.classList.add("active");
  li.innerHTML=`
   ${e.label}
   <div class="progress"><div style="width:${e.progress}%"></div></div>
  `;
  li.onclick=()=>{currentIndex=i;save()};
  ul.appendChild(li);
 });
 update();
}

function update(){
 renderGlobal();
 renderWeekly();
 renderBadges();
 save();
}

function renderGlobal(){
 const total=exercises.reduce((a,e)=>a+e.duration,0);
 const done=exercises.reduce((a,e)=>a+(e.progress/100*e.duration),0);
 document.getElementById("global").style.width=(done/total*100)+"%";
}

function renderWeekly(){
 const div=document.getElementById("weekly");
 let html="";
 exercises.forEach(e=>{
  html+=`${e.label} : ${Math.floor(e.time/60)} min<br>`;
 });
 div.innerHTML=html;
}

function saveSession(){
 const d=new Date().toISOString().slice(0,10);
 const stats=JSON.parse(localStorage.getItem("stats")||"{}");
 stats[d]=(stats[d]||0)+1;
 localStorage.setItem("stats",JSON.stringify(stats));
}

function renderBadges(){
 const stats=JSON.parse(localStorage.getItem("stats")||"{}");
 const days=Object.keys(stats).sort();
 let streak=1;
 for(let i=days.length-1;i>0;i--){
  if(new Date(days[i])-new Date(days[i-1])===86400000) streak++;
  else break;
 }
 let html="";
 if(streak>=7) html+='<span class="badge">ğŸ”¥ 7 jours</span>';
 const totalSessions=Object.values(stats).reduce((a,b)=>a+b,0);
 if(totalSessions>=10) html+='<span class="badge">ğŸ’ª 10 sÃ©ances</span>';
 document.getElementById("badges").innerHTML=html||"Aucun badge encore";
}

function exportCSV(){
 let csv="Date,Exercice,Minutes\n";
 exercises.forEach(e=>{
  csv+=`${new Date().toISOString().slice(0,10)},${e.speech},${Math.floor(e.time/60)}\n`;
 });
 const blob=new Blob([csv],{type:"text/csv"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="suivi.csv";
 a.click();
}

function exportPDF(){
 window.print();
}

function toggleFullscreen(){
 const fs=document.getElementById("focusTimer");
 fs.style.display=fs.style.display==="flex"?"none":"flex";
 if(fs.requestFullscreen) fs.requestFullscreen();
}

function save(){
 localStorage.setItem("state",JSON.stringify({exercises,currentIndex}));
}
function load(){
 const s=localStorage.getItem("state");
 if(s){const d=JSON.parse(s);exercises=d.exercises;currentIndex=d.currentIndex;}
}
</script>

</body>
</html>
