<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Recettes de famille</title>

<link rel="stylesheet" href="../css/style.css">

<!-- Police Spicy -->
<style>
@font-face {
    font-family: "Spicy";
    src: url("../assets/fonts/Spicy Sale.ttf");
}

:root{
  --card-bg: #ffffff;
  --grad-rose: linear-gradient(120deg,#f6d1f7 0%,#fcd6d6 100%);
  --grad-bleu: linear-gradient(120deg,#84fab0 0%,#8fd3f4 100%);
  --text: #2f3e34;
}

body{
  font-family: Arial, sans-serif;
  background: #f7f7f7;
  margin: 0;
  padding: 20px;
}

.container{
  max-width: 1100px;
  margin: 0 auto;
}

/* HEADER */
.header-inline{
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 5px;
}

.header-logo{
  width: 80px;
  cursor: pointer;
}

.title-spicy{
  font-family: "Spicy";
  font-size: 2.6rem;
  margin: 0;
}

.header-sub{
  text-align: center;
  font-size: 1.2rem;
  margin-top: -5px;
  margin-bottom: 25px;
  color: #555;
}

/* Toolbar */
.toolbar{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:20px;
}

input[type="text"], select{
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ddd;
  height:44px;
  font-size:15px;
}

/* Cartes */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:18px;
  margin-top:14px;
}

.card{
  background:var(--card-bg);
  border-radius:14px;
  padding:16px;
  border:1px solid #ececec;
  box-shadow:0 3px 8px rgba(0,0,0,0.05);
  transition:transform .2s;
}
.card:hover{ transform:translateY(-4px); }

.card h3{
  margin:6px 0 10px 0;
  font-size:20px;
  color:#333;
  text-align:center;
}

/* Photo */
.img-box{
  width:100%;
  height:200px;
  border-radius:12px;
  overflow:hidden;
  margin-bottom:12px;
}
.img-box img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* Infos */
.tag-box{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-bottom:12px;
}

.tag{
  padding:10px;
  border-radius:10px;
  background:#fafafa;
  border:1px solid #e3e3e3;
  font-size:14px;
}

/* Boutons */
.btn, .btn-small{
  padding:10px 16px;
  border-radius:12px;
  background:var(--grad-bleu);
  border:0;
  cursor:pointer;
  font-size:15px;
  color:#000;
  display:inline-flex;
  align-items:center;
  gap:8px;
}

.buttons-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:10px;
}

/* Bouton WhatsApp kawaii */
.whatsapp-btn{
  background:var(--grad-rose);
  border:0;
  padding:8px 14px;
  border-radius:12px;
  cursor:pointer;
  font-size:14px;
}

/* RESPONSIVE */
@media (max-width:600px){
  .header-inline{
    flex-direction:column;
  }
  .header-logo{ width:90px; }
  .title-spicy{ font-size:2.2rem; }
}

</style>
</head>
<body>

<div class="container">

  <!-- HEADER -->
  <div class="header-inline">
      <a href="../index.html"><img src="../assets/images/logo.png" class="header-logo"></a>
      <h1 class="title-spicy">Recettes de famille</h1>
  </div>

  <p class="header-sub">cuisin√© avec amour üíï</p>

  <!-- Toolbar -->
  <div class="toolbar">
      <input id="searchInput" type="text" placeholder="Recherche rapide (nom ou ingr√©dient)..." oninput="doSearch()">

      <select id="catSelect" onchange="doSearch()">
        <option value="">Cat√©gorie‚Ä¶</option>
        <option>Dessert</option>
        <option>Plat</option>
        <option>Go√ªter</option>
        <option>Petit-d√©jeuner</option>
        <option>Boisson</option>
        <option>L√©ger</option>
        <option>Hiver</option>
      </select>

      <button class="btn" onclick="randomRecipe()">üé≤ Recette surprise</button>
  </div>

  <main id="mainArea">
    <p style="color:#777;">Chargement des recettes‚Ä¶</p>
  </main>

</div>

<script>
let RECETTES = [];

/* Lecture CSV */
async function loadCSV(){
  try{
    const res = await fetch("../data/recettes.csv",{cache:"no-store"});
    const text = await res.text();
    RECETTES = parseCSV(text);
    renderCards(RECETTES);
  }catch(e){
    document.getElementById("mainArea").innerHTML = "<p>Impossible de charger le fichier CSV.</p>";
  }
}

function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
  const head = lines.shift().split(",");

  return lines.map(line=>{
    const cells = parseLine(line);
    return {
      nom: cells[0]||"",
      categorie: cells[1]||"",
      personnes: cells[2]||"",
      ingredients: (cells[3]||"").replace(/\\n/g,"\n"),
      recette: (cells[4]||"").replace(/\\n/g,"\n"),
      photo: cells[5]||""
    };
  });
}

function parseLine(l){
  const out=[]; let cur=""; let q=false;
  for(let c of l){
    if(c=='"') q=!q;
    else if(c=="," && !q){ out.push(cur); cur=""; }
    else cur+=c;
  }
  out.push(cur);
  return out;
}

/* Rendu cartes */
function renderCards(list){
  const main = document.getElementById("mainArea");
  main.innerHTML = "";

  if(list.length===0){
    main.innerHTML = "<p>Aucune recette trouv√©e.</p>";
    return;
  }

  const grid = document.createElement("div");
  grid.className = "cards";

  list.forEach(r=>{
    const card = document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <h3>${r.nom}</h3>

      <div class="img-box">
        <img src="${r.photo}" alt="">
      </div>

      <div class="tag-box">
        <div class="tag">üë®‚Äçüë©‚Äçüëß Portions : ${r.personnes}</div>
        <div class="tag">üìÇ Cat√©gorie : ${r.categorie}</div>

        <div class="tag"><b>ü•£ Ingr√©dients :</b><br>${r.ingredients.replace(/\n/g,"<br>")}</div>

        <div class="tag"><b>üç≥ Pr√©paration :</b><br>${r.recette.replace(/\n/g,"<br>")}</div>
      </div>

      <div class="buttons-row">
        <button class="btn-small" onclick="printOne('${encodeURIComponent(r.nom)}')">üñ®Ô∏è Imprimer</button>

        <button class="whatsapp-btn" onclick="shareWA('${encodeURIComponent(r.nom)}')">
          üíö WhatsApp
        </button>
      </div>
    `;

    grid.appendChild(card);
  });

  main.appendChild(grid);
}

/* Recherche */
function doSearch(){
  const q = document.getElementById("searchInput").value.toLowerCase();
  const cat = document.getElementById("catSelect").value;

  let res = RECETTES.filter(r =>{
    const matchText =
      r.nom.toLowerCase().includes(q) ||
      r.ingredients.toLowerCase().includes(q);

    const matchCat = !cat || r.categorie === cat;

    return matchText && matchCat;
  });

  renderCards(res);
}

/* Recette surprise */
function randomRecipe(){
  if(RECETTES.length===0) return;
  const r = RECETTES[Math.floor(Math.random()*RECETTES.length)];
  renderCards([r]);
}

/* Impression */
function printOne(nom){
  window.open(`print.html?nom=${nom}`,"_blank");
}

/* WhatsApp */
function shareWA(nom){
  const url = `print.html?nom=${nom}`;
  const txt = "üçΩÔ∏è Essaie cette recette : " + location.origin + "/" + url;
  window.open("https://wa.me/?text="+encodeURIComponent(txt));
}

loadCSV();
</script>

</body>
</html>
